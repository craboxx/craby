/*! For license information please see main.f9d921be.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{e.exports=n(202)},153:(e,t,n)=>{var r=n(43),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:s,_owner:a.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},202:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function v(){}function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var w=_.prototype=new v;w.constructor=_,m(w,y.prototype),w.isPureReactComponent=!0;var b=Array.isArray,C=Object.prototype.hasOwnProperty,S={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,r){var i,s={},o=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)C.call(t,i)&&!E.hasOwnProperty(i)&&(s[i]=t[i]);var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===s[i]&&(s[i]=l[i]);return{$$typeof:n,type:e,key:o,ref:a,props:s,_owner:S.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function x(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function N(e,t,i,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return o=o(l=e),e=""===s?"."+x(l,0):s,b(o)?(i="",null!=e&&(i=e.replace(I,"$&/")+"/"),N(o,t,i,"",function(e){return e})):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(I,"$&/")+"/")+e)),t.push(o)),1;if(l=0,s=""===s?".":s+":",b(e))for(var c=0;c<e.length;c++){var u=s+x(a=e[c],c);l+=N(a,t,i,u,o)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=N(a=a.value,t,i,u=s+x(a,c++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function R(e,t,n){if(null==e)return e;var r=[],i=0;return N(e,r,"","",function(e){return t.call(n,e,i++)}),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A={current:null},D={transition:null},O={ReactCurrentDispatcher:A,ReactCurrentBatchConfig:D,ReactCurrentOwner:S};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:R,forEach:function(e,t,n){R(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return R(e,function(){t++}),t},toArray:function(e){return R(e,function(e){return e})||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=o,t.PureComponent=_,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),s=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=S.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)C.call(t,c)&&!E.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:s,ref:o,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return A.current.useCallback(e,t)},t.useContext=function(e){return A.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return A.current.useDeferredValue(e)},t.useEffect=function(e,t){return A.current.useEffect(e,t)},t.useId=function(){return A.current.useId()},t.useImperativeHandle=function(e,t,n){return A.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return A.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return A.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return A.current.useMemo(e,t)},t.useReducer=function(e,t,n){return A.current.useReducer(e,t,n)},t.useRef=function(e){return A.current.useRef(e)},t.useState=function(e){return A.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return A.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return A.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<s(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var a=2*(r+1)-1,l=e[a],c=a+1,u=e[c];if(0>s(l,n))c<i&&0>s(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else{if(!(c<i&&0>s(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function b(e){if(g=!1,w(e),!m)if(null!==r(c))m=!0,D(C);else{var t=r(u);null!==t&&O(b,t.startTime-e)}}function C(e,n){m=!1,g&&(g=!1,v(T),T=-1),p=!0;var s=f;try{for(w(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!N());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var a=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?d.callback=a:d===r(c)&&i(c),w(n)}else i(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&O(b,h.startTime-n),l=!1}return l}finally{d=null,f=s,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,E=!1,k=null,T=-1,I=5,x=-1;function N(){return!(t.unstable_now()-x<I)}function R(){if(null!==k){var e=t.unstable_now();x=e;var n=!0;try{n=k(!0,e)}finally{n?S():(E=!1,k=null)}}else E=!1}if("function"===typeof _)S=function(){_(R)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,A=P.port2;P.port1.onmessage=R,S=function(){A.postMessage(null)}}else S=function(){y(R,0)};function D(e){k=e,E||(E=!0,S())}function O(e,n){T=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,D(C))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,s){var o=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(e.sortIndex=s,n(u,e),null===r(c)&&e===r(u)&&(g?(v(T),T=-1):g=!0,O(b,s-o))):(e.sortIndex=a,n(c,e),m||p||(m=!0,D(C))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},391:(e,t,n)=>{var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},579:(e,t,n)=>{e.exports=n(153)},730:(e,t,n)=>{var r=n(43),i=n(853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,r,i,s,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function _(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),C=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),I=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var M,j=Object.assign;function F(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var U=!1;function V(e,t){if(!e||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),s=r.stack.split("\n"),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(1!==o||1!==a)do{if(o--,0>--a||i[o]!==s[a]){var l="\n"+i[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=a);break}}}finally{U=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function z(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function q(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case C:return"Portal";case k:return"Profiler";case E:return"StrictMode";case N:return"Suspense";case R:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case x:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case P:return null!==(t=e.displayName||null)?t:q(e.type)||"Memo";case A:t=e._payload,e=e._init;try{return q(e(t))}catch(n){}}return null}function B(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return j({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function $(e,t){J(e,t);var n=W(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return j({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function se(e,t){var n=W(t.value),r=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ye=j({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ce=null,Se=null,Ee=null;function ke(e){if(e=bi(e)){if("function"!==typeof Ce)throw Error(s(280));var t=e.stateNode;t&&(t=Si(t),Ce(e.stateNode,e.type,t))}}function Te(e){Se?Ee?Ee.push(e):Ee=[e]:Se=e}function Ie(){if(Se){var e=Se,t=Ee;if(Ee=Se=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function xe(e,t){return e(t)}function Ne(){}var Re=!1;function Pe(e,t,n){if(Re)return e(t,n);Re=!0;try{return xe(e,t,n)}finally{Re=!1,(null!==Se||null!==Ee)&&(Ne(),Ie())}}function Ae(e,t){var n=e.stateNode;if(null===n)return null;var r=Si(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var De=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){De=!1}function Le(e,t,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Me=!1,je=null,Fe=!1,Ue=null,Ve={onError:function(e){Me=!0,je=e}};function ze(e,t,n,r,i,s,o,a,l){Me=!1,je=null,Le.apply(Ve,arguments)}function qe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Be(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(qe(e)!==e)throw Error(s(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return We(i),e;if(o===r)return We(i),t;o=o.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=o;break}if(l===r){a=!0,r=i,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,r=i;break}if(l===r){a=!0,r=o,n=i;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ke=i.unstable_scheduleCallback,Qe=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,Xe=i.unstable_requestPaint,Je=i.unstable_now,$e=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,st=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,o=268435455&n;if(0!==o){var a=o&~i;0!==a?r=ht(a):0!==(s&=o)&&(r=ht(s))}else 0!==(o=n&~i)?r=ht(o):0!==s&&(r=ht(s));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(s=t&-t)||16===i&&0!==(4194240&s)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var _t=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,Ct,St,Et,kt,Tt=!1,It=[],xt=null,Nt=null,Rt=null,Pt=new Map,At=new Map,Dt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":xt=null;break;case"dragenter":case"dragleave":Nt=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":Pt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":At.delete(t.pointerId)}}function Mt(e,t,n,r,i,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},null!==t&&(null!==(t=bi(t))&&Ct(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function jt(e){var t=wi(e.target);if(null!==t){var n=qe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Be(n)))return e.blockedOn=t,void kt(e.priority,function(){St(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bi(n))&&Ct(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);we=r,n.target.dispatchEvent(r),we=null,t.shift()}return!0}function Ut(e,t,n){Ft(e)&&n.delete(t)}function Vt(){Tt=!1,null!==xt&&Ft(xt)&&(xt=null),null!==Nt&&Ft(Nt)&&(Nt=null),null!==Rt&&Ft(Rt)&&(Rt=null),Pt.forEach(Ut),At.forEach(Ut)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Vt)))}function qt(e){function t(t){return zt(t,e)}if(0<It.length){zt(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==xt&&zt(xt,e),null!==Nt&&zt(Nt,e),null!==Rt&&zt(Rt,e),Pt.forEach(t),At.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)jt(n),null===n.blockedOn&&Dt.shift()}var Bt=w.ReactCurrentBatchConfig,Wt=!0;function Ht(e,t,n,r){var i=_t,s=Bt.transition;Bt.transition=null;try{_t=1,Kt(e,t,n,r)}finally{_t=i,Bt.transition=s}}function Gt(e,t,n,r){var i=_t,s=Bt.transition;Bt.transition=null;try{_t=4,Kt(e,t,n,r)}finally{_t=i,Bt.transition=s}}function Kt(e,t,n,r){if(Wt){var i=Yt(e,t,n,r);if(null===i)Gr(e,t,r,Qt,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return xt=Mt(xt,e,t,n,r,i),!0;case"dragenter":return Nt=Mt(Nt,e,t,n,r,i),!0;case"mouseover":return Rt=Mt(Rt,e,t,n,r,i),!0;case"pointerover":var s=i.pointerId;return Pt.set(s,Mt(Pt.get(s)||null,e,t,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,At.set(s,Mt(At.get(s)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==i;){var s=bi(i);if(null!==s&&bt(s),null===(s=Yt(e,t,n,r))&&Gr(e,t,r,Qt,n),s===i)break;i=s}null!==i&&r.stopPropagation()}else Gr(e,t,r,null,n)}}var Qt=null;function Yt(e,t,n,r){if(Qt=null,null!==(e=wi(e=be(r))))if(null===(t=qe(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Be(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($e()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,$t=null,en=null;function tn(){if(en)return en;var e,t,n=$t,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,s=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[s-t];t++);return en=i.slice(e,1<t?1-t:void 0)}function nn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rn(){return!0}function sn(){return!1}function on(e){function t(t,n,r,i,s){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?rn:sn,this.isPropagationStopped=sn,this}return j(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rn)},persist:function(){},isPersistent:rn}),t}var an,ln,cn,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hn=on(un),dn=j({},un,{view:0,detail:0}),fn=on(dn),pn=j({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(an=e.screenX-cn.screenX,ln=e.screenY-cn.screenY):ln=an=0,cn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),mn=on(pn),gn=on(j({},pn,{dataTransfer:0})),yn=on(j({},dn,{relatedTarget:0})),vn=on(j({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),_n=j({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),wn=on(_n),bn=on(j({},un,{data:0})),Cn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},En={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=En[e])&&!!t[e]}function Tn(){return kn}var In=j({},dn,{key:function(e){if(e.key){var t=Cn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=nn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(e){return"keypress"===e.type?nn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?nn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),xn=on(In),Nn=on(j({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rn=on(j({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),Pn=on(j({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=j({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),On=on(An),Ln=[9,13,27,32],Mn=u&&"CompositionEvent"in window,jn=null;u&&"documentMode"in document&&(jn=document.documentMode);var Fn=u&&"TextEvent"in window&&!jn,Un=u&&(!Mn||jn&&8<jn&&11>=jn),Vn=String.fromCharCode(32),zn=!1;function qn(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Kn(e,t,n,r){Te(r),0<(t=Qr(t,"onChange")).length&&(n=new hn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Qn=null,Yn=null;function Xn(e){Vr(e,0)}function Jn(e){if(K(Ci(e)))return e}function $n(e,t){if("change"===e)return t}var Zn=!1;if(u){var er;if(u){var tr="oninput"in document;if(!tr){var nr=document.createElement("div");nr.setAttribute("oninput","return;"),tr="function"===typeof nr.oninput}er=tr}else er=!1;Zn=er&&(!document.documentMode||9<document.documentMode)}function rr(){Qn&&(Qn.detachEvent("onpropertychange",ir),Yn=Qn=null)}function ir(e){if("value"===e.propertyName&&Jn(Yn)){var t=[];Kn(t,Yn,e,be(e)),Pe(Xn,t)}}function sr(e,t,n){"focusin"===e?(rr(),Yn=n,(Qn=t).attachEvent("onpropertychange",ir)):"focusout"===e&&rr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(Yn)}function ar(e,t){if("click"===e)return Jn(t)}function lr(e,t){if("input"===e||"change"===e)return Jn(t)}var cr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(cr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(t,i)||!cr(e[i],t[i]))return!1}return!0}function hr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function dr(e,t){var n,r=hr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=hr(r)}}function fr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pr(){for(var e=window,t=Q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Q((e=t.contentWindow).document)}return t}function mr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gr(e){var t=pr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&fr(n.ownerDocument.documentElement,n)){if(null!==r&&mr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=void 0===r.end?s:Math.min(r.end,i),!e.extend&&s>r&&(i=r,r=s,s=i),i=dr(n,s);var o=dr(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var yr=u&&"documentMode"in document&&11>=document.documentMode,vr=null,_r=null,wr=null,br=!1;function Cr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==vr||vr!==Q(r)||("selectionStart"in(r=vr)&&mr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},wr&&ur(wr,r)||(wr=r,0<(r=Qr(_r,"onSelect")).length&&(t=new hn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}function Sr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Er={animationend:Sr("Animation","AnimationEnd"),animationiteration:Sr("Animation","AnimationIteration"),animationstart:Sr("Animation","AnimationStart"),transitionend:Sr("Transition","TransitionEnd")},kr={},Tr={};function Ir(e){if(kr[e])return kr[e];if(!Er[e])return e;var t,n=Er[e];for(t in n)if(n.hasOwnProperty(t)&&t in Tr)return kr[e]=n[t];return e}u&&(Tr=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition);var xr=Ir("animationend"),Nr=Ir("animationiteration"),Rr=Ir("animationstart"),Pr=Ir("transitionend"),Ar=new Map,Dr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Or(e,t){Ar.set(e,t),l(t,[e])}for(var Lr=0;Lr<Dr.length;Lr++){var Mr=Dr[Lr];Or(Mr.toLowerCase(),"on"+(Mr[0].toUpperCase()+Mr.slice(1)))}Or(xr,"onAnimationEnd"),Or(Nr,"onAnimationIteration"),Or(Rr,"onAnimationStart"),Or("dblclick","onDoubleClick"),Or("focusin","onFocus"),Or("focusout","onBlur"),Or(Pr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fr=new Set("cancel close invalid load scroll toggle".split(" ").concat(jr));function Ur(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,a,l,c){if(ze.apply(this,arguments),Me){if(!Me)throw Error(s(198));var u=je;Me=!1,je=null,Fe||(Fe=!0,Ue=u)}}(r,t,void 0,e),e.currentTarget=null}function Vr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Ur(i,a,c),s=l}else for(o=0;o<r.length;o++){if(l=(a=r[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Ur(i,a,c),s=l}}}if(Fe)throw e=Ue,Fe=!1,Ue=null,e}function zr(e,t){var n=t[yi];void 0===n&&(n=t[yi]=new Set);var r=e+"__bubble";n.has(r)||(Hr(t,e,2,!1),n.add(r))}function qr(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Wr(e){if(!e[Br]){e[Br]=!0,o.forEach(function(t){"selectionchange"!==t&&(Fr.has(t)||qr(t,!1,e),qr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,qr("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Xt(t)){case 1:var i=Ht;break;case 4:i=Gt;break;default:i=Kt}n=i.bind(null,t,n,e),i=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Gr(e,t,n,r,i){var s=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;o=o.return}for(;null!==a;){if(null===(o=wi(a)))return;if(5===(l=o.tag)||6===l){r=s=o;continue e}a=a.parentNode}}r=r.return}Pe(function(){var r=s,i=be(n),o=[];e:{var a=Ar.get(e);if(void 0!==a){var l=hn,c=e;switch(e){case"keypress":if(0===nn(n))break e;case"keydown":case"keyup":l=xn;break;case"focusin":c="focus",l=yn;break;case"focusout":c="blur",l=yn;break;case"beforeblur":case"afterblur":l=yn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Rn;break;case xr:case Nr:case Rr:l=vn;break;case Pr:l=Pn;break;case"scroll":l=fn;break;case"wheel":l=On;break;case"copy":case"cut":case"paste":l=wn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Nn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&(null!=(m=Ae(p,d))&&u.push(Kr(p,m,f)))),h)break;p=p.return}0<u.length&&(a=new l(a,c,null,n,i),o.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===we||!(c=n.relatedTarget||n.fromElement)||!wi(c)&&!c[gi])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?wi(c):null)&&(c!==(h=qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=mn,m="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Nn,m="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?a:Ci(l),f=null==c?a:Ci(c),(a=new u(m,p+"leave",l,n,i)).target=h,a.relatedTarget=f,m=null,wi(i)===r&&((u=new u(d,p+"enter",c,n,i)).target=f,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,p=0,f=u=l;f;f=Yr(f))p++;for(f=0,m=d;m;m=Yr(m))f++;for(;0<p-f;)u=Yr(u),p--;for(;0<f-p;)d=Yr(d),f--;for(;p--;){if(u===d||null!==d&&u===d.alternate)break e;u=Yr(u),d=Yr(d)}u=null}else u=null;null!==l&&Xr(o,a,l,u,!1),null!==c&&null!==h&&Xr(o,h,c,u,!0)}if("select"===(l=(a=r?Ci(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=$n;else if(Gn(a))if(Zn)g=lr;else{g=or;var y=sr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=ar);switch(g&&(g=g(e,r))?Kn(o,g,n,i):(y&&y(e,a,r),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=r?Ci(r):window,e){case"focusin":(Gn(y)||"true"===y.contentEditable)&&(vr=y,_r=r,wr=null);break;case"focusout":wr=_r=vr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,Cr(o,n,i);break;case"selectionchange":if(yr)break;case"keydown":case"keyup":Cr(o,n,i)}var v;if(Mn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Wn?qn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Un&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Wn&&(v=tn()):($t="value"in(Jt=i)?Jt.value:Jt.textContent,Wn=!0)),0<(y=Qr(r,_)).length&&(_=new bn(_,e,null,n,i),o.push({event:_,listeners:y}),v?_.data=v:null!==(v=Bn(n))&&(_.data=v))),(v=Fn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(zn=!0,Vn);case"textInput":return(e=t.data)===Vn&&zn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!Mn&&qn(e,t)?(e=tn(),en=$t=Jt=null,Wn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Qr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=v))}Vr(o,t)})}function Kr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,s=i.stateNode;5===i.tag&&null!==s&&(i=s,null!=(s=Ae(e,n))&&r.unshift(Kr(e,s,i)),null!=(s=Ae(e,t))&&r.push(Kr(e,s,i))),e=e.return}return r}function Yr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,i){for(var s=t._reactName,o=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(l=Ae(n,s))&&o.unshift(Kr(n,l,a)):i||null!=(l=Ae(n,s))&&o.push(Kr(n,l,a))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Jr=/\r\n?/g,$r=/\u0000|\uFFFD/g;function Zr(e){return("string"===typeof e?e:""+e).replace(Jr,"\n").replace($r,"")}function ei(e,t,n){if(t=Zr(t),Zr(e)!==t&&n)throw Error(s(425))}function ti(){}var ni=null,ri=null;function ii(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var si="function"===typeof setTimeout?setTimeout:void 0,oi="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,li="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(ci)}:si;function ci(e){setTimeout(function(){throw e})}function ui(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void qt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);qt(t)}function hi(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function di(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var fi=Math.random().toString(36).slice(2),pi="__reactFiber$"+fi,mi="__reactProps$"+fi,gi="__reactContainer$"+fi,yi="__reactEvents$"+fi,vi="__reactListeners$"+fi,_i="__reactHandles$"+fi;function wi(e){var t=e[pi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[gi]||n[pi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=di(e);null!==e;){if(n=e[pi])return n;e=di(e)}return t}n=(e=n).parentNode}return null}function bi(e){return!(e=e[pi]||e[gi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Ci(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function Si(e){return e[mi]||null}var Ei=[],ki=-1;function Ti(e){return{current:e}}function Ii(e){0>ki||(e.current=Ei[ki],Ei[ki]=null,ki--)}function xi(e,t){ki++,Ei[ki]=e.current,e.current=t}var Ni={},Ri=Ti(Ni),Pi=Ti(!1),Ai=Ni;function Di(e,t){var n=e.type.contextTypes;if(!n)return Ni;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Oi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Li(){Ii(Pi),Ii(Ri)}function Mi(e,t,n){if(Ri.current!==Ni)throw Error(s(168));xi(Ri,t),xi(Pi,n)}function ji(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(s(108,B(e)||"Unknown",i));return j({},n,r)}function Fi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ni,Ai=Ri.current,xi(Ri,e),xi(Pi,Pi.current),!0}function Ui(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=ji(e,t,Ai),r.__reactInternalMemoizedMergedChildContext=e,Ii(Pi),Ii(Ri),xi(Ri,e)):Ii(Pi),xi(Pi,n)}var Vi=null,zi=!1,qi=!1;function Bi(e){null===Vi?Vi=[e]:Vi.push(e)}function Wi(){if(!qi&&null!==Vi){qi=!0;var e=0,t=_t;try{var n=Vi;for(_t=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Vi=null,zi=!1}catch(i){throw null!==Vi&&(Vi=Vi.slice(e+1)),Ke(Ze,Wi),i}finally{_t=t,qi=!1}}return null}var Hi=[],Gi=0,Ki=null,Qi=0,Yi=[],Xi=0,Ji=null,$i=1,Zi="";function es(e,t){Hi[Gi++]=Qi,Hi[Gi++]=Ki,Ki=e,Qi=t}function ts(e,t,n){Yi[Xi++]=$i,Yi[Xi++]=Zi,Yi[Xi++]=Ji,Ji=e;var r=$i;e=Zi;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var s=32-ot(t)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,$i=1<<32-ot(t)+i|n<<i|r,Zi=s+e}else $i=1<<s|n<<i|r,Zi=e}function ns(e){null!==e.return&&(es(e,1),ts(e,1,0))}function rs(e){for(;e===Ki;)Ki=Hi[--Gi],Hi[Gi]=null,Qi=Hi[--Gi],Hi[Gi]=null;for(;e===Ji;)Ji=Yi[--Xi],Yi[Xi]=null,Zi=Yi[--Xi],Yi[Xi]=null,$i=Yi[--Xi],Yi[Xi]=null}var is=null,ss=null,os=!1,as=null;function ls(e,t){var n=Dc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function cs(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,is=e,ss=hi(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,is=e,ss=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ji?{id:$i,overflow:Zi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Dc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,is=e,ss=null,!0);default:return!1}}function us(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function hs(e){if(os){var t=ss;if(t){var n=t;if(!cs(e,t)){if(us(e))throw Error(s(418));t=hi(n.nextSibling);var r=is;t&&cs(e,t)?ls(r,n):(e.flags=-4097&e.flags|2,os=!1,is=e)}}else{if(us(e))throw Error(s(418));e.flags=-4097&e.flags|2,os=!1,is=e}}}function ds(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;is=e}function fs(e){if(e!==is)return!1;if(!os)return ds(e),os=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ii(e.type,e.memoizedProps)),t&&(t=ss)){if(us(e))throw ps(),Error(s(418));for(;t;)ls(e,t),t=hi(t.nextSibling)}if(ds(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ss=hi(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ss=null}}else ss=is?hi(e.stateNode.nextSibling):null;return!0}function ps(){for(var e=ss;e;)e=hi(e.nextSibling)}function ms(){ss=is=null,os=!1}function gs(e){null===as?as=[e]:as.push(e)}var ys=w.ReactCurrentBatchConfig;function vs(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function _s(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ws(e){return(0,e._init)(e._payload)}function bs(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Lc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Uc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var s=n.type;return s===S?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===A&&ws(s)===t.type)?((r=i(t,n.props)).ref=vs(e,t,n),r.return=e,r):((r=Mc(n.type,n.key,n.props,null,e.mode,r)).ref=vs(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,s){return null===t||7!==t.tag?((t=jc(n,e.mode,r,s)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Uc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Mc(t.type,t.key,t.props,null,e.mode,n)).ref=vs(e,null,t),n.return=e,n;case C:return(t=Vc(t,e.mode,n)).return=e,t;case A:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=jc(t,e.mode,n,null)).return=e,t;_s(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===i?c(e,t,n,r):null;case C:return n.key===i?u(e,t,n,r):null;case A:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:h(e,t,n,r,null);_s(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case b:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case C:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case A:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return h(t,e=e.get(n)||null,r,i,null);_s(t,r)}return null}function m(i,s,a,l){for(var c=null,u=null,h=s,m=s=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=f(i,h,a[m],l);if(null===y){null===h&&(h=g);break}e&&h&&null===y.alternate&&t(i,h),s=o(y,s,m),null===u?c=y:u.sibling=y,u=y,h=g}if(m===a.length)return n(i,h),os&&es(i,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(i,a[m],l))&&(s=o(h,s,m),null===u?c=h:u.sibling=h,u=h);return os&&es(i,m),c}for(h=r(i,h);m<a.length;m++)null!==(g=p(h,i,m,a[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=o(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach(function(e){return t(i,e)}),os&&es(i,m),c}function g(i,a,l,c){var u=L(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,m=a,g=a=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var _=f(i,m,v.value,c);if(null===_){null===m&&(m=y);break}e&&m&&null===_.alternate&&t(i,m),a=o(_,a,g),null===h?u=_:h.sibling=_,h=_,m=y}if(v.done)return n(i,m),os&&es(i,g),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(i,v.value,c))&&(a=o(v,a,g),null===h?u=v:h.sibling=v,h=v);return os&&es(i,g),u}for(m=r(i,m);!v.done;g++,v=l.next())null!==(v=p(m,i,g,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=o(v,a,g),null===h?u=v:h.sibling=v,h=v);return e&&m.forEach(function(e){return t(i,e)}),os&&es(i,g),u}return function e(r,s,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:e:{for(var c=o.key,u=s;null!==u;){if(u.key===c){if((c=o.type)===S){if(7===u.tag){n(r,u.sibling),(s=i(u,o.props.children)).return=r,r=s;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===A&&ws(c)===u.type){n(r,u.sibling),(s=i(u,o.props)).ref=vs(r,u,o),s.return=r,r=s;break e}n(r,u);break}t(r,u),u=u.sibling}o.type===S?((s=jc(o.props.children,r.mode,l,o.key)).return=r,r=s):((l=Mc(o.type,o.key,o.props,null,r.mode,l)).ref=vs(r,s,o),l.return=r,r=l)}return a(r);case C:e:{for(u=o.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===o.containerInfo&&s.stateNode.implementation===o.implementation){n(r,s.sibling),(s=i(s,o.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=Vc(o,r.mode,l)).return=r,r=s}return a(r);case A:return e(r,s,(u=o._init)(o._payload),l)}if(te(o))return m(r,s,o,l);if(L(o))return g(r,s,o,l);_s(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,o)).return=r,r=s):(n(r,s),(s=Uc(o,r.mode,l)).return=r,r=s),a(r)):n(r,s)}}var Cs=bs(!0),Ss=bs(!1),Es=Ti(null),ks=null,Ts=null,Is=null;function xs(){Is=Ts=ks=null}function Ns(e){var t=Es.current;Ii(Es),e._currentValue=t}function Rs(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ps(e,t){ks=e,Is=Ts=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ba=!0),e.firstContext=null)}function As(e){var t=e._currentValue;if(Is!==e)if(e={context:e,memoizedValue:t,next:null},null===Ts){if(null===ks)throw Error(s(308));Ts=e,ks.dependencies={lanes:0,firstContext:e}}else Ts=Ts.next=e;return t}var Ds=null;function Os(e){null===Ds?Ds=[e]:Ds.push(e)}function Ls(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Os(t)):(n.next=i.next,i.next=n),t.interleaved=n,Ms(e,r)}function Ms(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var js=!1;function Fs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Us(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Vs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zs(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Rl)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Ms(e,n)}return null===(i=r.interleaved)?(t.next=t,Os(r)):(t.next=i.next,i.next=t),r.interleaved=t,Ms(e,n)}function qs(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Bs(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=o:s=s.next=o,n=n.next}while(null!==n);null===s?i=s=t:s=s.next=t}else i=s=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ws(e,t,n,r){var i=e.updateQueue;js=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==s){var h=i.baseState;for(o=0,u=c=l=null,a=s;;){var d=a.lane,f=a.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,m=a;switch(d=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=m.payload)?p.call(f,h,d):p)||void 0===d)break e;h=j({},h,d);break e;case 2:js=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=f,l=h):u=u.next=f,o|=d;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(d=a).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===s&&(i.shared.lanes=0);Fl|=o,e.lanes=o,e.memoizedState=h}}function Hs(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(s(191,i));i.call(r)}}}var Gs={},Ks=Ti(Gs),Qs=Ti(Gs),Ys=Ti(Gs);function Xs(e){if(e===Gs)throw Error(s(174));return e}function Js(e,t){switch(xi(Ys,t),xi(Qs,e),xi(Ks,Gs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ii(Ks),xi(Ks,t)}function $s(){Ii(Ks),Ii(Qs),Ii(Ys)}function Zs(e){Xs(Ys.current);var t=Xs(Ks.current),n=le(t,e.type);t!==n&&(xi(Qs,e),xi(Ks,n))}function eo(e){Qs.current===e&&(Ii(Ks),Ii(Qs))}var to=Ti(0);function no(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ro=[];function io(){for(var e=0;e<ro.length;e++)ro[e]._workInProgressVersionPrimary=null;ro.length=0}var so=w.ReactCurrentDispatcher,oo=w.ReactCurrentBatchConfig,ao=0,lo=null,co=null,uo=null,ho=!1,fo=!1,po=0,mo=0;function go(){throw Error(s(321))}function yo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!cr(e[n],t[n]))return!1;return!0}function vo(e,t,n,r,i,o){if(ao=o,lo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,so.current=null===e||null===e.memoizedState?ta:na,e=n(r,i),fo){o=0;do{if(fo=!1,po=0,25<=o)throw Error(s(301));o+=1,uo=co=null,t.updateQueue=null,so.current=ra,e=n(r,i)}while(fo)}if(so.current=ea,t=null!==co&&null!==co.next,ao=0,uo=co=lo=null,ho=!1,t)throw Error(s(300));return e}function _o(){var e=0!==po;return po=0,e}function wo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===uo?lo.memoizedState=uo=e:uo=uo.next=e,uo}function bo(){if(null===co){var e=lo.alternate;e=null!==e?e.memoizedState:null}else e=co.next;var t=null===uo?lo.memoizedState:uo.next;if(null!==t)uo=t,co=e;else{if(null===e)throw Error(s(310));e={memoizedState:(co=e).memoizedState,baseState:co.baseState,baseQueue:co.baseQueue,queue:co.queue,next:null},null===uo?lo.memoizedState=uo=e:uo=uo.next=e}return uo}function Co(e,t){return"function"===typeof t?t(e):t}function So(e){var t=bo(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=co,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var l=a=null,c=null,u=o;do{var h=u.lane;if((ao&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=r):c=c.next=d,lo.lanes|=h,Fl|=h}u=u.next}while(null!==u&&u!==o);null===c?a=r:c.next=l,cr(r,t.memoizedState)||(ba=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,lo.lanes|=o,Fl|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Eo(e){var t=bo(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);cr(o,t.memoizedState)||(ba=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function ko(){}function To(e,t){var n=lo,r=bo(),i=t(),o=!cr(r.memoizedState,i);if(o&&(r.memoizedState=i,ba=!0),r=r.queue,Fo(No.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==uo&&1&uo.memoizedState.tag){if(n.flags|=2048,Do(9,xo.bind(null,n,r,i,t),void 0,null),null===Pl)throw Error(s(349));0!==(30&ao)||Io(n,t,i)}return i}function Io(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=lo.updateQueue)?(t={lastEffect:null,stores:null},lo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function xo(e,t,n,r){t.value=n,t.getSnapshot=r,Ro(t)&&Po(e)}function No(e,t,n){return n(function(){Ro(t)&&Po(e)})}function Ro(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!cr(e,n)}catch(r){return!0}}function Po(e){var t=Ms(e,1);null!==t&&ic(t,e,1,-1)}function Ao(e){var t=wo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Co,lastRenderedState:e},t.queue=e,e=e.dispatch=Xo.bind(null,lo,e),[t.memoizedState,e]}function Do(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=lo.updateQueue)?(t={lastEffect:null,stores:null},lo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Oo(){return bo().memoizedState}function Lo(e,t,n,r){var i=wo();lo.flags|=e,i.memoizedState=Do(1|t,n,void 0,void 0===r?null:r)}function Mo(e,t,n,r){var i=bo();r=void 0===r?null:r;var s=void 0;if(null!==co){var o=co.memoizedState;if(s=o.destroy,null!==r&&yo(r,o.deps))return void(i.memoizedState=Do(t,n,s,r))}lo.flags|=e,i.memoizedState=Do(1|t,n,s,r)}function jo(e,t){return Lo(8390656,8,e,t)}function Fo(e,t){return Mo(2048,8,e,t)}function Uo(e,t){return Mo(4,2,e,t)}function Vo(e,t){return Mo(4,4,e,t)}function zo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Mo(4,4,zo.bind(null,t,e),n)}function Bo(){}function Wo(e,t){var n=bo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&yo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ho(e,t){var n=bo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&yo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Go(e,t,n){return 0===(21&ao)?(e.baseState&&(e.baseState=!1,ba=!0),e.memoizedState=n):(cr(n,t)||(n=mt(),lo.lanes|=n,Fl|=n,e.baseState=!0),t)}function Ko(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var r=oo.transition;oo.transition={};try{e(!1),t()}finally{_t=n,oo.transition=r}}function Qo(){return bo().memoizedState}function Yo(e,t,n){var r=rc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Jo(e))$o(t,n);else if(null!==(n=Ls(e,t,n,r))){ic(n,e,r,nc()),Zo(n,t,r)}}function Xo(e,t,n){var r=rc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Jo(e))$o(t,i);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,cr(a,o)){var l=t.interleaved;return null===l?(i.next=i,Os(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Ls(e,t,i,r))&&(ic(n,e,r,i=nc()),Zo(n,t,r))}}function Jo(e){var t=e.alternate;return e===lo||null!==t&&t===lo}function $o(e,t){fo=ho=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Zo(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var ea={readContext:As,useCallback:go,useContext:go,useEffect:go,useImperativeHandle:go,useInsertionEffect:go,useLayoutEffect:go,useMemo:go,useReducer:go,useRef:go,useState:go,useDebugValue:go,useDeferredValue:go,useTransition:go,useMutableSource:go,useSyncExternalStore:go,useId:go,unstable_isNewReconciler:!1},ta={readContext:As,useCallback:function(e,t){return wo().memoizedState=[e,void 0===t?null:t],e},useContext:As,useEffect:jo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Lo(4194308,4,zo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Lo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Lo(4,2,e,t)},useMemo:function(e,t){var n=wo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=wo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Yo.bind(null,lo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},wo().memoizedState=e},useState:Ao,useDebugValue:Bo,useDeferredValue:function(e){return wo().memoizedState=e},useTransition:function(){var e=Ao(!1),t=e[0];return e=Ko.bind(null,e[1]),wo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=lo,i=wo();if(os){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Pl)throw Error(s(349));0!==(30&ao)||Io(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,jo(No.bind(null,r,o,e),[e]),r.flags|=2048,Do(9,xo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=wo(),t=Pl.identifierPrefix;if(os){var n=Zi;t=":"+t+"R"+(n=($i&~(1<<32-ot($i)-1)).toString(32)+n),0<(n=po++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=mo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},na={readContext:As,useCallback:Wo,useContext:As,useEffect:Fo,useImperativeHandle:qo,useInsertionEffect:Uo,useLayoutEffect:Vo,useMemo:Ho,useReducer:So,useRef:Oo,useState:function(){return So(Co)},useDebugValue:Bo,useDeferredValue:function(e){return Go(bo(),co.memoizedState,e)},useTransition:function(){return[So(Co)[0],bo().memoizedState]},useMutableSource:ko,useSyncExternalStore:To,useId:Qo,unstable_isNewReconciler:!1},ra={readContext:As,useCallback:Wo,useContext:As,useEffect:Fo,useImperativeHandle:qo,useInsertionEffect:Uo,useLayoutEffect:Vo,useMemo:Ho,useReducer:Eo,useRef:Oo,useState:function(){return Eo(Co)},useDebugValue:Bo,useDeferredValue:function(e){var t=bo();return null===co?t.memoizedState=e:Go(t,co.memoizedState,e)},useTransition:function(){return[Eo(Co)[0],bo().memoizedState]},useMutableSource:ko,useSyncExternalStore:To,useId:Qo,unstable_isNewReconciler:!1};function ia(e,t){if(e&&e.defaultProps){for(var n in t=j({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function sa(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:j({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var oa={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=nc(),i=rc(e),s=Vs(r,i);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=zs(e,s,i))&&(ic(t,e,i,r),qs(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=nc(),i=rc(e),s=Vs(r,i);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=zs(e,s,i))&&(ic(t,e,i,r),qs(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=nc(),r=rc(e),i=Vs(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=zs(e,i,r))&&(ic(t,e,r,n),qs(t,e,r))}};function aa(e,t,n,r,i,s,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(i,s))}function la(e,t,n){var r=!1,i=Ni,s=t.contextType;return"object"===typeof s&&null!==s?s=As(s):(i=Oi(t)?Ai:Ri.current,s=(r=null!==(r=t.contextTypes)&&void 0!==r)?Di(e,i):Ni),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=oa,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function ca(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&oa.enqueueReplaceState(t,t.state,null)}function ua(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Fs(e);var s=t.contextType;"object"===typeof s&&null!==s?i.context=As(s):(s=Oi(t)?Ai:Ri.current,i.context=Di(e,s)),i.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(sa(e,t,s,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&oa.enqueueReplaceState(i,i.state,null),Ws(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function ha(e,t){try{var n="",r=t;do{n+=z(r),r=r.return}while(r);var i=n}catch(s){i="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:i,digest:null}}function da(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fa(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var pa="function"===typeof WeakMap?WeakMap:Map;function ma(e,t,n){(n=Vs(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Gl||(Gl=!0,Kl=r),fa(0,t)},n}function ga(e,t,n){(n=Vs(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){fa(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){fa(0,t),"function"!==typeof r&&(null===Ql?Ql=new Set([this]):Ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ya(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new pa;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Ic.bind(null,e,t,n),t.then(e,e))}function va(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function _a(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Vs(-1,1)).tag=2,zs(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var wa=w.ReactCurrentOwner,ba=!1;function Ca(e,t,n,r){t.child=null===e?Ss(t,null,n,r):Cs(t,e.child,n,r)}function Sa(e,t,n,r,i){n=n.render;var s=t.ref;return Ps(t,i),r=vo(e,t,n,r,s,i),n=_o(),null===e||ba?(os&&n&&ns(t),t.flags|=1,Ca(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ga(e,t,i))}function Ea(e,t,n,r,i){if(null===e){var s=n.type;return"function"!==typeof s||Oc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Mc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,ka(e,t,s,r,i))}if(s=e.child,0===(e.lanes&i)){var o=s.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return Ga(e,t,i)}return t.flags|=1,(e=Lc(s,r)).ref=t.ref,e.return=t,t.child=e}function ka(e,t,n,r,i){if(null!==e){var s=e.memoizedProps;if(ur(s,r)&&e.ref===t.ref){if(ba=!1,t.pendingProps=r=s,0===(e.lanes&i))return t.lanes=e.lanes,Ga(e,t,i);0!==(131072&e.flags)&&(ba=!0)}}return xa(e,t,n,r,i)}function Ta(e,t,n){var r=t.pendingProps,i=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xi(Ll,Ol),Ol|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xi(Ll,Ol),Ol|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==s?s.baseLanes:n,xi(Ll,Ol),Ol|=r}else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,xi(Ll,Ol),Ol|=r;return Ca(e,t,i,n),t.child}function Ia(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function xa(e,t,n,r,i){var s=Oi(n)?Ai:Ri.current;return s=Di(t,s),Ps(t,i),n=vo(e,t,n,r,s,i),r=_o(),null===e||ba?(os&&r&&ns(t),t.flags|=1,Ca(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ga(e,t,i))}function Na(e,t,n,r,i){if(Oi(n)){var s=!0;Fi(t)}else s=!1;if(Ps(t,i),null===t.stateNode)Ha(e,t),la(t,n,r),ua(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=As(c):c=Di(t,c=Oi(n)?Ai:Ri.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==r||l!==c)&&ca(t,o,r,c),js=!1;var d=t.memoizedState;o.state=d,Ws(t,r,o,i),l=t.memoizedState,a!==r||d!==l||Pi.current||js?("function"===typeof u&&(sa(t,n,u,r),l=t.memoizedState),(a=js||aa(t,n,a,r,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Us(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:ia(t.type,a),o.props=c,h=t.pendingProps,d=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=As(l):l=Di(t,l=Oi(n)?Ai:Ri.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==h||d!==l)&&ca(t,o,r,l),js=!1,d=t.memoizedState,o.state=d,Ws(t,r,o,i);var p=t.memoizedState;a!==h||d!==p||Pi.current||js?("function"===typeof f&&(sa(t,n,f,r),p=t.memoizedState),(c=js||aa(t,n,c,r,d,p,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=l,r=c):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ra(e,t,n,r,s,i)}function Ra(e,t,n,r,i,s){Ia(e,t);var o=0!==(128&t.flags);if(!r&&!o)return i&&Ui(t,n,!1),Ga(e,t,s);r=t.stateNode,wa.current=t;var a=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Cs(t,e.child,null,s),t.child=Cs(t,null,a,s)):Ca(e,t,a,s),t.memoizedState=r.state,i&&Ui(t,n,!0),t.child}function Pa(e){var t=e.stateNode;t.pendingContext?Mi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Mi(0,t.context,!1),Js(e,t.containerInfo)}function Aa(e,t,n,r,i){return ms(),gs(i),t.flags|=256,Ca(e,t,n,r),t.child}var Da,Oa,La,Ma,ja={dehydrated:null,treeContext:null,retryLane:0};function Fa(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ua(e,t,n){var r,i=t.pendingProps,o=to.current,a=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),xi(to,1&o),null===e)return hs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,a?(i=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Fc(l,i,0,null),e=jc(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Fa(n),t.memoizedState=ja,e):Va(t,l));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,a){if(n)return 256&t.flags?(t.flags&=-257,za(e,t,a,r=da(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=Fc({mode:"visible",children:r.children},i,0,null),(o=jc(o,i,a,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Cs(t,e.child,null,a),t.child.memoizedState=Fa(a),t.memoizedState=ja,o);if(0===(1&t.mode))return za(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,za(e,t,a,r=da(o=Error(s(419)),r,void 0))}if(l=0!==(a&e.childLanes),ba||l){if(null!==(r=Pl)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|a))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Ms(e,i),ic(r,e,i,-1))}return yc(),za(e,t,a,r=da(Error(s(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Nc.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,ss=hi(i.nextSibling),is=t,os=!0,as=null,null!==e&&(Yi[Xi++]=$i,Yi[Xi++]=Zi,Yi[Xi++]=Ji,$i=e.id,Zi=e.overflow,Ji=t),t=Va(t,r.children),t.flags|=4096,t)}(e,t,l,i,r,o,n);if(a){a=i.fallback,l=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Lc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?a=Lc(r,a):(a=jc(a,l,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,l=null===(l=e.child.memoizedState)?Fa(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=ja,i}return e=(a=e.child).sibling,i=Lc(a,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Va(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function za(e,t,n,r){return null!==r&&gs(r),Cs(t,e.child,null,n),(e=Va(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function qa(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Rs(e.return,t,n)}function Ba(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Wa(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(Ca(e,t,r.children,n),0!==(2&(r=to.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&qa(e,n,t);else if(19===e.tag)qa(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(xi(to,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===no(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ba(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===no(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ba(t,!0,n,null,s);break;case"together":Ba(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ha(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ga(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Lc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Lc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ka(e,t){if(!os)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Qa(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ya(e,t,n){var r=t.pendingProps;switch(rs(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qa(t),null;case 1:case 17:return Oi(t.type)&&Li(),Qa(t),null;case 3:return r=t.stateNode,$s(),Ii(Pi),Ii(Ri),io(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(fs(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==as&&(lc(as),as=null))),Oa(e,t),Qa(t),null;case 5:eo(t);var i=Xs(Ys.current);if(n=t.type,null!==e&&null!=t.stateNode)La(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return Qa(t),null}if(e=Xs(Ks.current),fs(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[pi]=t,r[mi]=o,e=0!==(1&t.mode),n){case"dialog":zr("cancel",r),zr("close",r);break;case"iframe":case"object":case"embed":zr("load",r);break;case"video":case"audio":for(i=0;i<jr.length;i++)zr(jr[i],r);break;case"source":zr("error",r);break;case"img":case"image":case"link":zr("error",r),zr("load",r);break;case"details":zr("toggle",r);break;case"input":X(r,o),zr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},zr("invalid",r);break;case"textarea":ie(r,o),zr("invalid",r)}for(var l in ve(n,o),i=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&ei(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&ei(r.textContent,c,e),i=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&zr("scroll",r)}switch(n){case"input":G(r),Z(r,o,!0);break;case"textarea":G(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=ti)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[pi]=t,e[mi]=r,Da(e,t,!1,!1),t.stateNode=e;e:{switch(l=_e(n,r),n){case"dialog":zr("cancel",e),zr("close",e),i=r;break;case"iframe":case"object":case"embed":zr("load",e),i=r;break;case"video":case"audio":for(i=0;i<jr.length;i++)zr(jr[i],e);i=r;break;case"source":zr("error",e),i=r;break;case"img":case"image":case"link":zr("error",e),zr("load",e),i=r;break;case"details":zr("toggle",e),i=r;break;case"input":X(e,r),i=Y(e,r),zr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=j({},r,{value:void 0}),zr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),zr("invalid",e)}for(o in ve(n,i),c=i)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?ge(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&zr("scroll",e):null!=u&&_(e,o,u,l))}switch(n){case"input":G(e),Z(e,r,!1);break;case"textarea":G(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+W(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=ti)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Qa(t),null;case 6:if(e&&null!=t.stateNode)Ma(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(n=Xs(Ys.current),Xs(Ks.current),fs(t)){if(r=t.stateNode,n=t.memoizedProps,r[pi]=t,(o=r.nodeValue!==n)&&null!==(e=is))switch(e.tag){case 3:ei(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&ei(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[pi]=t,t.stateNode=r}return Qa(t),null;case 13:if(Ii(to),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(os&&null!==ss&&0!==(1&t.mode)&&0===(128&t.flags))ps(),ms(),t.flags|=98560,o=!1;else if(o=fs(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[pi]=t}else ms(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Qa(t),o=!1}else null!==as&&(lc(as),as=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&to.current)?0===Ml&&(Ml=3):yc())),null!==t.updateQueue&&(t.flags|=4),Qa(t),null);case 4:return $s(),Oa(e,t),null===e&&Wr(t.stateNode.containerInfo),Qa(t),null;case 10:return Ns(t.type._context),Qa(t),null;case 19:if(Ii(to),null===(o=t.memoizedState))return Qa(t),null;if(r=0!==(128&t.flags),null===(l=o.rendering))if(r)Ka(o,!1);else{if(0!==Ml||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=no(e))){for(t.flags|=128,Ka(o,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return xi(to,1&to.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Wl&&(t.flags|=128,r=!0,Ka(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=no(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ka(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!os)return Qa(t),null}else 2*Je()-o.renderingStartTime>Wl&&1073741824!==n&&(t.flags|=128,r=!0,Ka(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=to.current,xi(to,r?1&n|2:1&n),t):(Qa(t),null);case 22:case 23:return fc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ol)&&(Qa(t),6&t.subtreeFlags&&(t.flags|=8192)):Qa(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Xa(e,t){switch(rs(t),t.tag){case 1:return Oi(t.type)&&Li(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return $s(),Ii(Pi),Ii(Ri),io(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return eo(t),null;case 13:if(Ii(to),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ms()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ii(to),null;case 4:return $s(),null;case 10:return Ns(t.type._context),null;case 22:case 23:return fc(),null;default:return null}}Da=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Oa=function(){},La=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Xs(Ks.current);var s,o=null;switch(n){case"input":i=Y(e,i),r=Y(e,r),o=[];break;case"select":i=j({},i,{value:void 0}),r=j({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=ti)}for(u in ve(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&zr("scroll",e),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Ma=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ja=!1,$a=!1,Za="function"===typeof WeakSet?WeakSet:Set,el=null;function tl(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Tc(e,t,r)}else n.current=null}function nl(e,t,n){try{n()}catch(r){Tc(e,t,r)}}var rl=!1;function il(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,void 0!==s&&nl(t,n,s)}i=i.next}while(i!==r)}}function sl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[pi],delete t[mi],delete t[yi],delete t[vi],delete t[_i])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ll(e){return 5===e.tag||3===e.tag||4===e.tag}function cl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ll(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=ti));else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}function hl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(hl(e,t,n),e=e.sibling;null!==e;)hl(e,t,n),e=e.sibling}var dl=null,fl=!1;function pl(e,t,n){for(n=n.child;null!==n;)ml(e,t,n),n=n.sibling}function ml(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(it,n)}catch(a){}switch(n.tag){case 5:$a||tl(n,t);case 6:var r=dl,i=fl;dl=null,pl(e,t,n),fl=i,null!==(dl=r)&&(fl?(e=dl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):dl.removeChild(n.stateNode));break;case 18:null!==dl&&(fl?(e=dl,n=n.stateNode,8===e.nodeType?ui(e.parentNode,n):1===e.nodeType&&ui(e,n),qt(e)):ui(dl,n.stateNode));break;case 4:r=dl,i=fl,dl=n.stateNode.containerInfo,fl=!0,pl(e,t,n),dl=r,fl=i;break;case 0:case 11:case 14:case 15:if(!$a&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,void 0!==o&&(0!==(2&s)||0!==(4&s))&&nl(n,t,o),i=i.next}while(i!==r)}pl(e,t,n);break;case 1:if(!$a&&(tl(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Tc(n,t,a)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?($a=(r=$a)||null!==n.memoizedState,pl(e,t,n),$a=r):pl(e,t,n);break;default:pl(e,t,n)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Za),t.forEach(function(t){var r=Rc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function yl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:dl=l.stateNode,fl=!1;break e;case 3:case 4:dl=l.stateNode.containerInfo,fl=!0;break e}l=l.return}if(null===dl)throw Error(s(160));ml(o,a,i),dl=null,fl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){Tc(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vl(t,e),t=t.sibling}function vl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(yl(t,e),_l(e),4&r){try{il(3,e,e.return),sl(3,e)}catch(g){Tc(e,e.return,g)}try{il(5,e,e.return)}catch(g){Tc(e,e.return,g)}}break;case 1:yl(t,e),_l(e),512&r&&null!==n&&tl(n,n.return);break;case 5:if(yl(t,e),_l(e),512&r&&null!==n&&tl(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(g){Tc(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,a=null!==n?n.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&J(i,o),_e(l,a);var u=_e(l,o);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?ge(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):_(i,h,d,u)}switch(l){case"input":$(i,o);break;case"textarea":se(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(i,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[mi]=o}catch(g){Tc(e,e.return,g)}}break;case 6:if(yl(t,e),_l(e),4&r){if(null===e.stateNode)throw Error(s(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(g){Tc(e,e.return,g)}}break;case 3:if(yl(t,e),_l(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(g){Tc(e,e.return,g)}break;case 4:default:yl(t,e),_l(e);break;case 13:yl(t,e),_l(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Bl=Je())),4&r&&gl(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?($a=(u=$a)||h,yl(t,e),$a=u):yl(t,e),_l(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(el=e,h=e.child;null!==h;){for(d=el=h;null!==el;){switch(p=(f=el).child,f.tag){case 0:case 11:case 14:case 15:il(4,f,f.return);break;case 1:tl(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Tc(r,n,g)}}break;case 5:tl(f,f.return);break;case 22:if(null!==f.memoizedState){Sl(d);continue}}null!==p?(p.return=f,el=p):Sl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,u?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,a=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",a))}catch(g){Tc(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Tc(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:yl(t,e),_l(e),4&r&&gl(e);case 21:}}function _l(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ll(n)){var r=n;break e}n=n.return}throw Error(s(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),hl(e,cl(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;ul(e,cl(e),o);break;default:throw Error(s(161))}}catch(Dn){Tc(e,e.return,Dn)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function wl(e,t,n){el=e,bl(e,t,n)}function bl(e,t,n){for(var r=0!==(1&e.mode);null!==el;){var i=el,s=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Ja;if(!o){var a=i.alternate,l=null!==a&&null!==a.memoizedState||$a;a=Ja;var c=$a;if(Ja=o,($a=l)&&!c)for(el=i;null!==el;)l=(o=el).child,22===o.tag&&null!==o.memoizedState?El(i):null!==l?(l.return=o,el=l):El(i);for(;null!==s;)el=s,bl(s,t,n),s=s.sibling;el=i,Ja=a,$a=c}Cl(e)}else 0!==(8772&i.subtreeFlags)&&null!==s?(s.return=i,el=s):Cl(e)}}function Cl(e){for(;null!==el;){var t=el;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$a||sl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$a)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ia(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Hs(t,o,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Hs(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&qt(d)}}}break;default:throw Error(s(163))}$a||512&t.flags&&ol(t)}catch(f){Tc(t,t.return,f)}}if(t===e){el=null;break}if(null!==(n=t.sibling)){n.return=t.return,el=n;break}el=t.return}}function Sl(e){for(;null!==el;){var t=el;if(t===e){el=null;break}var n=t.sibling;if(null!==n){n.return=t.return,el=n;break}el=t.return}}function El(e){for(;null!==el;){var t=el;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{sl(4,t)}catch(Dn){Tc(t,n,Dn)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(Dn){Tc(t,i,Dn)}}var s=t.return;try{ol(t)}catch(Dn){Tc(t,s,Dn)}break;case 5:var o=t.return;try{ol(t)}catch(Dn){Tc(t,o,Dn)}}}catch(Dn){Tc(t,t.return,Dn)}if(t===e){el=null;break}var a=t.sibling;if(null!==a){a.return=t.return,el=a;break}el=t.return}}var kl,Tl=Math.ceil,Il=w.ReactCurrentDispatcher,xl=w.ReactCurrentOwner,Nl=w.ReactCurrentBatchConfig,Rl=0,Pl=null,Al=null,Dl=0,Ol=0,Ll=Ti(0),Ml=0,jl=null,Fl=0,Ul=0,Vl=0,zl=null,ql=null,Bl=0,Wl=1/0,Hl=null,Gl=!1,Kl=null,Ql=null,Yl=!1,Xl=null,Jl=0,$l=0,Zl=null,ec=-1,tc=0;function nc(){return 0!==(6&Rl)?Je():-1!==ec?ec:ec=Je()}function rc(e){return 0===(1&e.mode)?1:0!==(2&Rl)&&0!==Dl?Dl&-Dl:null!==ys.transition?(0===tc&&(tc=mt()),tc):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function ic(e,t,n,r){if(50<$l)throw $l=0,Zl=null,Error(s(185));yt(e,n,r),0!==(2&Rl)&&e===Pl||(e===Pl&&(0===(2&Rl)&&(Ul|=n),4===Ml&&cc(e,Dl)),sc(e,r),1===n&&0===Rl&&0===(1&t.mode)&&(Wl=Je()+500,zi&&Wi()))}function sc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-ot(s),a=1<<o,l=i[o];-1===l?0!==(a&n)&&0===(a&r)||(i[o]=ft(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}}(e,t);var r=dt(e,e===Pl?Dl:0);if(0===r)null!==n&&Qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Qe(n),1===t)0===e.tag?function(e){zi=!0,Bi(e)}(uc.bind(null,e)):Bi(uc.bind(null,e)),li(function(){0===(6&Rl)&&Wi()}),n=null;else{switch(wt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Pc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(ec=-1,tc=0,0!==(6&Rl))throw Error(s(327));var n=e.callbackNode;if(Ec()&&e.callbackNode!==n)return null;var r=dt(e,e===Pl?Dl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=vc(e,r);else{t=r;var i=Rl;Rl|=2;var o=gc();for(Pl===e&&Dl===t||(Hl=null,Wl=Je()+500,pc(e,t));;)try{wc();break}catch(l){mc(e,l)}xs(),Il.current=o,Rl=i,null!==Al?t=0:(Pl=null,Dl=0,t=Ml)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=ac(e,i))),1===t)throw n=jl,pc(e,0),cc(e,r),sc(e,Je()),n;if(6===t)cc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!cr(s(),i))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=vc(e,r))&&(0!==(o=pt(e))&&(r=o,t=ac(e,o))),1===t))throw n=jl,pc(e,0),cc(e,r),sc(e,Je()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:Sc(e,ql,Hl);break;case 3:if(cc(e,r),(130023424&r)===r&&10<(t=Bl+500-Je())){if(0!==dt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){nc(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=si(Sc.bind(null,e,ql,Hl),t);break}Sc(e,ql,Hl);break;case 4:if(cc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-ot(r);o=1<<a,(a=t[a])>i&&(i=a),r&=~o}if(r=i,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Tl(r/1960))-r)){e.timeoutHandle=si(Sc.bind(null,e,ql,Hl),r);break}Sc(e,ql,Hl);break;default:throw Error(s(329))}}}return sc(e,Je()),e.callbackNode===n?oc.bind(null,e):null}function ac(e,t){var n=zl;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=vc(e,t))&&(t=ql,ql=n,null!==t&&lc(t)),e}function lc(e){null===ql?ql=e:ql.push.apply(ql,e)}function cc(e,t){for(t&=~Vl,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function uc(e){if(0!==(6&Rl))throw Error(s(327));Ec();var t=dt(e,0);if(0===(1&t))return sc(e,Je()),null;var n=vc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=jl,pc(e,0),cc(e,t),sc(e,Je()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,ql,Hl),sc(e,Je()),null}function hc(e,t){var n=Rl;Rl|=1;try{return e(t)}finally{0===(Rl=n)&&(Wl=Je()+500,zi&&Wi())}}function dc(e){null!==Xl&&0===Xl.tag&&0===(6&Rl)&&Ec();var t=Rl;Rl|=1;var n=Nl.transition,r=_t;try{if(Nl.transition=null,_t=1,e)return e()}finally{_t=r,Nl.transition=n,0===(6&(Rl=t))&&Wi()}}function fc(){Ol=Ll.current,Ii(Ll)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oi(n)),null!==Al)for(n=Al.return;null!==n;){var r=n;switch(rs(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Li();break;case 3:$s(),Ii(Pi),Ii(Ri),io();break;case 5:eo(r);break;case 4:$s();break;case 13:case 19:Ii(to);break;case 10:Ns(r.type._context);break;case 22:case 23:fc()}n=n.return}if(Pl=e,Al=e=Lc(e.current,null),Dl=Ol=t,Ml=0,jl=null,Vl=Ul=Fl=0,ql=zl=null,null!==Ds){for(t=0;t<Ds.length;t++)if(null!==(r=(n=Ds[t]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var o=s.next;s.next=i,r.next=o}n.pending=r}Ds=null}return e}function mc(e,t){for(;;){var n=Al;try{if(xs(),so.current=ea,ho){for(var r=lo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ho=!1}if(ao=0,uo=co=lo=null,fo=!1,po=0,xl.current=null,null===n||null===n.return){Ml=1,jl=t,Al=null;break}e:{var o=e,a=n.return,l=n,c=t;if(t=Dl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=va(a);if(null!==p){p.flags&=-257,_a(p,a,l,0,t),1&p.mode&&ya(o,u,t),c=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ya(o,u,t),yc();break e}c=Error(s(426))}else if(os&&1&l.mode){var y=va(a);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),_a(y,a,l,0,t),gs(ha(c,l));break e}}o=c=ha(c,l),4!==Ml&&(Ml=2),null===zl?zl=[o]:zl.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Bs(o,ma(0,c,t));break e;case 1:l=c;var v=o.type,_=o.stateNode;if(0===(128&o.flags)&&("function"===typeof v.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===Ql||!Ql.has(_)))){o.flags|=65536,t&=-t,o.lanes|=t,Bs(o,ga(o,l,t));break e}}o=o.return}while(null!==o)}Cc(n)}catch(w){t=w,Al===n&&null!==n&&(Al=n=n.return);continue}break}}function gc(){var e=Il.current;return Il.current=ea,null===e?ea:e}function yc(){0!==Ml&&3!==Ml&&2!==Ml||(Ml=4),null===Pl||0===(268435455&Fl)&&0===(268435455&Ul)||cc(Pl,Dl)}function vc(e,t){var n=Rl;Rl|=2;var r=gc();for(Pl===e&&Dl===t||(Hl=null,pc(e,t));;)try{_c();break}catch(i){mc(e,i)}if(xs(),Rl=n,Il.current=r,null!==Al)throw Error(s(261));return Pl=null,Dl=0,Ml}function _c(){for(;null!==Al;)bc(Al)}function wc(){for(;null!==Al&&!Ye();)bc(Al)}function bc(e){var t=kl(e.alternate,e,Ol);e.memoizedProps=e.pendingProps,null===t?Cc(e):Al=t,xl.current=null}function Cc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ya(n,t,Ol)))return void(Al=n)}else{if(null!==(n=Xa(n,t)))return n.flags&=32767,void(Al=n);if(null===e)return Ml=6,void(Al=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Al=t);Al=t=e}while(null!==t);0===Ml&&(Ml=5)}function Sc(e,t,n){var r=_t,i=Nl.transition;try{Nl.transition=null,_t=1,function(e,t,n,r){do{Ec()}while(null!==Xl);if(0!==(6&Rl))throw Error(s(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}(e,o),e===Pl&&(Al=Pl=null,Dl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yl||(Yl=!0,Pc(tt,function(){return Ec(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Nl.transition,Nl.transition=null;var a=_t;_t=1;var l=Rl;Rl|=4,xl.current=null,function(e,t){if(ni=Wt,mr(e=pr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(Zt){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(l=a+i),d!==o||0!==r&&3!==d.nodeType||(c=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++u===i&&(l=a),f===o&&++h===r&&(c=a),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ri={focusedElem:e,selectionRange:n},Wt=!1,el=t;null!==el;)if(e=(t=el).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,el=e;else for(;null!==el;){t=el;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=t.stateNode,_=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:ia(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(s(163))}}catch(Zt){Tc(t,t.return,Zt)}if(null!==(e=t.sibling)){e.return=t.return,el=e;break}el=t.return}m=rl,rl=!1}(e,n),vl(n,e),gr(ri),Wt=!!ni,ri=ni=null,e.current=n,wl(n,e,i),Xe(),Rl=l,_t=a,Nl.transition=o}else e.current=n;if(Yl&&(Yl=!1,Xl=e,Jl=i),o=e.pendingLanes,0===o&&(Ql=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),sc(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Gl)throw Gl=!1,e=Kl,Kl=null,e;0!==(1&Jl)&&0!==e.tag&&Ec(),o=e.pendingLanes,0!==(1&o)?e===Zl?$l++:($l=0,Zl=e):$l=0,Wi()}(e,t,n,r)}finally{Nl.transition=i,_t=r}return null}function Ec(){if(null!==Xl){var e=wt(Jl),t=Nl.transition,n=_t;try{if(Nl.transition=null,_t=16>e?16:e,null===Xl)var r=!1;else{if(e=Xl,Xl=null,Jl=0,0!==(6&Rl))throw Error(s(331));var i=Rl;for(Rl|=4,el=e.current;null!==el;){var o=el,a=o.child;if(0!==(16&el.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(el=u;null!==el;){var h=el;switch(h.tag){case 0:case 11:case 15:il(8,h,o)}var d=h.child;if(null!==d)d.return=h,el=d;else for(;null!==el;){var f=(h=el).sibling,p=h.return;if(al(h),h===u){el=null;break}if(null!==f){f.return=p,el=f;break}el=p}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}el=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,el=a;else e:for(;null!==el;){if(0!==(2048&(o=el).flags))switch(o.tag){case 0:case 11:case 15:il(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,el=v;break e}el=o.return}}var _=e.current;for(el=_;null!==el;){var w=(a=el).child;if(0!==(2064&a.subtreeFlags)&&null!==w)w.return=a,el=w;else e:for(a=_;null!==el;){if(0!==(2048&(l=el).flags))try{switch(l.tag){case 0:case 11:case 15:sl(9,l)}}catch(C){Tc(l,l.return,C)}if(l===a){el=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,el=b;break e}el=l.return}}if(Rl=i,Wi(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(it,e)}catch(C){}r=!0}return r}finally{_t=n,Nl.transition=t}}return!1}function kc(e,t,n){e=zs(e,t=ma(0,t=ha(n,t),1),1),t=nc(),null!==e&&(yt(e,1,t),sc(e,t))}function Tc(e,t,n){if(3===e.tag)kc(e,e,n);else for(;null!==t;){if(3===t.tag){kc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ql||!Ql.has(r))){t=zs(t,e=ga(t,e=ha(n,e),1),1),e=nc(),null!==t&&(yt(t,1,e),sc(t,e));break}}t=t.return}}function Ic(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=nc(),e.pingedLanes|=e.suspendedLanes&n,Pl===e&&(Dl&n)===n&&(4===Ml||3===Ml&&(130023424&Dl)===Dl&&500>Je()-Bl?pc(e,0):Vl|=n),sc(e,t)}function xc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=nc();null!==(e=Ms(e,t))&&(yt(e,t,n),sc(e,n))}function Nc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),xc(e,n)}function Rc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),xc(e,n)}function Pc(e,t){return Ke(e,t)}function Ac(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dc(e,t,n,r){return new Ac(e,t,n,r)}function Oc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lc(e,t){var n=e.alternate;return null===n?((n=Dc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Mc(e,t,n,r,i,o){var a=2;if(r=e,"function"===typeof e)Oc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return jc(n.children,i,o,t);case E:a=8,i|=8;break;case k:return(e=Dc(12,n,t,2|i)).elementType=k,e.lanes=o,e;case N:return(e=Dc(13,n,t,i)).elementType=N,e.lanes=o,e;case R:return(e=Dc(19,n,t,i)).elementType=R,e.lanes=o,e;case D:return Fc(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:a=10;break e;case I:a=9;break e;case x:a=11;break e;case P:a=14;break e;case A:a=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Dc(a,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function jc(e,t,n,r){return(e=Dc(7,e,r,t)).lanes=n,e}function Fc(e,t,n,r){return(e=Dc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Uc(e,t,n){return(e=Dc(6,e,null,t)).lanes=n,e}function Vc(e,t,n){return(t=Dc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function qc(e,t,n,r,i,s,o,a,l){return e=new zc(e,t,n,a,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Dc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fs(s),e}function Bc(e){if(!e)return Ni;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Oi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Oi(n))return ji(e,n,t)}return t}function Wc(e,t,n,r,i,s,o,a,l){return(e=qc(n,r,!0,e,0,s,0,a,l)).context=Bc(null),n=e.current,(s=Vs(r=nc(),i=rc(n))).callback=void 0!==t&&null!==t?t:null,zs(n,s,i),e.current.lanes=i,yt(e,i,r),sc(e,r),e}function Hc(e,t,n,r){var i=t.current,s=nc(),o=rc(i);return n=Bc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Vs(s,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=zs(i,t,o))&&(ic(e,i,o,s),qs(e,i,o)),o}function Gc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Kc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Qc(e,t){Kc(e,t),(e=e.alternate)&&Kc(e,t)}kl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pi.current)ba=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ba=!1,function(e,t,n){switch(t.tag){case 3:Pa(t),ms();break;case 5:Zs(t);break;case 1:Oi(t.type)&&Fi(t);break;case 4:Js(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;xi(Es,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(xi(to,1&to.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ua(e,t,n):(xi(to,1&to.current),null!==(e=Ga(e,t,n))?e.sibling:null);xi(to,1&to.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Wa(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),xi(to,to.current),r)break;return null;case 22:case 23:return t.lanes=0,Ta(e,t,n)}return Ga(e,t,n)}(e,t,n);ba=0!==(131072&e.flags)}else ba=!1,os&&0!==(1048576&t.flags)&&ts(t,Qi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ha(e,t),e=t.pendingProps;var i=Di(t,Ri.current);Ps(t,n),i=vo(null,t,r,e,i,n);var o=_o();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Oi(r)?(o=!0,Fi(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Fs(t),i.updater=oa,t.stateNode=i,i._reactInternals=t,ua(t,r,e,n),t=Ra(null,t,r,!0,o,n)):(t.tag=0,os&&o&&ns(t),Ca(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ha(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Oc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===x)return 11;if(e===P)return 14}return 2}(r),e=ia(r,e),i){case 0:t=xa(null,t,r,e,n);break e;case 1:t=Na(null,t,r,e,n);break e;case 11:t=Sa(null,t,r,e,n);break e;case 14:t=Ea(null,t,r,ia(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,xa(e,t,r,i=t.elementType===r?i:ia(r,i),n);case 1:return r=t.type,i=t.pendingProps,Na(e,t,r,i=t.elementType===r?i:ia(r,i),n);case 3:e:{if(Pa(t),null===e)throw Error(s(387));r=t.pendingProps,i=(o=t.memoizedState).element,Us(e,t),Ws(t,r,null,n);var a=t.memoizedState;if(r=a.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Aa(e,t,r,n,i=ha(Error(s(423)),t));break e}if(r!==i){t=Aa(e,t,r,n,i=ha(Error(s(424)),t));break e}for(ss=hi(t.stateNode.containerInfo.firstChild),is=t,os=!0,as=null,n=Ss(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ms(),r===i){t=Ga(e,t,n);break e}Ca(e,t,r,n)}t=t.child}return t;case 5:return Zs(t),null===e&&hs(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,ii(r,i)?a=null:null!==o&&ii(r,o)&&(t.flags|=32),Ia(e,t),Ca(e,t,a,n),t.child;case 6:return null===e&&hs(t),null;case 13:return Ua(e,t,n);case 4:return Js(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Cs(t,null,r,n):Ca(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Sa(e,t,r,i=t.elementType===r?i:ia(r,i),n);case 7:return Ca(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ca(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,a=i.value,xi(Es,r._currentValue),r._currentValue=a,null!==o)if(cr(o.value,a)){if(o.children===i.children&&!Pi.current){t=Ga(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Vs(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Rs(o.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Rs(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}Ca(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Ps(t,n),r=r(i=As(i)),t.flags|=1,Ca(e,t,r,n),t.child;case 14:return i=ia(r=t.type,t.pendingProps),Ea(e,t,r,i=ia(r.type,i),n);case 15:return ka(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ia(r,i),Ha(e,t),t.tag=1,Oi(r)?(e=!0,Fi(t)):e=!1,Ps(t,n),la(t,r,i),ua(t,r,i,n),Ra(null,t,r,!0,e,n);case 19:return Wa(e,t,n);case 22:return Ta(e,t,n)}throw Error(s(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function Jc(e){this._internalRoot=e}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function eu(){}function tu(e,t,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if("function"===typeof i){var a=i;i=function(){var e=Gc(o);a.call(e)}}Hc(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"===typeof r){var s=r;r=function(){var e=Gc(o);s.call(e)}}var o=Wc(t,r,e,0,null,!1,0,"",eu);return e._reactRootContainer=o,e[gi]=o.current,Wr(8===e.nodeType?e.parentNode:e),dc(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var a=r;r=function(){var e=Gc(l);a.call(e)}}var l=qc(e,0,!1,null,0,!1,0,"",eu);return e._reactRootContainer=l,e[gi]=l.current,Wr(8===e.nodeType?e.parentNode:e),dc(function(){Hc(t,l,n,r)}),l}(n,t,e,i,r);return Gc(o)}Jc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Hc(e,t,null,null)},Jc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc(function(){Hc(null,e,null,null)}),t[gi]=null}},Jc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&jt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(vt(t,1|n),sc(t,Je()),0===(6&Rl)&&(Wl=Je()+500,Wi()))}break;case 13:dc(function(){var t=Ms(e,1);if(null!==t){var n=nc();ic(t,e,1,n)}}),Qc(e,1)}},Ct=function(e){if(13===e.tag){var t=Ms(e,134217728);if(null!==t)ic(t,e,134217728,nc());Qc(e,134217728)}},St=function(e){if(13===e.tag){var t=rc(e),n=Ms(e,t);if(null!==n)ic(n,e,t,nc());Qc(e,t)}},Et=function(){return _t},kt=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},Ce=function(e,t,n){switch(t){case"input":if($(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Si(r);if(!i)throw Error(s(90));K(r),$(r,i)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},xe=hc,Ne=dc;var nu={usingClientEntryPoint:!1,Events:[bi,Ci,Si,Te,Ie,hc]},ru={findFiberByHostInstance:wi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iu={bundleType:ru.bundleType,version:ru.version,rendererPackageName:ru.rendererPackageName,rendererConfig:ru.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:ru.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var su=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!su.isDisabled&&su.supportsFiber)try{it=su.inject(iu),st=su}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$c(t))throw Error(s(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:C,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!$c(e))throw Error(s(299));var n=!1,r="",i=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=qc(e,1,!1,null,0,n,0,r,i),e[gi]=t.current,Wr(8===e.nodeType?e.parentNode:e),new Xc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Zc(t))throw Error(s(200));return tu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$c(e))throw Error(s(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",a=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Wc(t,null,e,1,null!=n?n:null,i,0,o,a),e[gi]=t.current,Wr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Jc(t)},t.render=function(e,t,n){if(!Zc(t))throw Error(s(200));return tu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(s(40));return!!e._reactRootContainer&&(dc(function(){tu(null,null,e,!1,function(){e._reactRootContainer=null,e[gi]=null})}),!0)},t.unstable_batchedUpdates=hc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return tu(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{e.exports=n(234)},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}();var r=n(43),i=n(391);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function o(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}function a(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const u=!1,h=!1,d="${JSCORE_VERSION}",f=function(e,t){if(!e)throw p(t)},p=function(e){return new Error("Firebase Database ("+d+") INTERNAL ASSERT FAILED: "+e)},m=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,l=a?e[i+2]:0,c=t>>2,u=(3&t)<<4|o>>4;let h=(15&o)<<2|l>>6,d=63&l;a||(d=64,s||(h=64)),r.push(n[c],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(m(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw new y;const l=t<<2|s>>4;if(r.push(l),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class y extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const v=function(e){const t=m(e);return g.encodeByteArray(t,!0)},_=function(e){return v(e).replace(/\./g,"")},w=function(e){try{return g.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function b(e){return C(void 0,e)}function C(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&S(n)&&(e[n]=C(e[n],t[n]));return e}function S(e){return"__proto__"!==e}function E(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const k=()=>{try{return E().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/craby",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&w(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},T=e=>{var t;return null===(t=k())||void 0===t||null===(t=t.emulatorHosts)||void 0===t?void 0:t[e]},I=e=>{const t=T(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},x=()=>{var e;return null===(e=k())||void 0===e?void 0:e.config},N=e=>{var t;return null===(t=k())||void 0===t?void 0:t["_".concat(e)]};class R{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function P(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}async function A(e){return(await fetch(e,{credentials:"include"})).ok}function D(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=c({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[_(JSON.stringify({alg:"none",type:"JWT"})),_(JSON.stringify(s)),""].join(".")}const O={};let L=!1;function M(e,t){if("undefined"===typeof window||"undefined"===typeof document||!P(window.location.host)||O[e]===t||O[e]||L)return;function n(e){return"__firebase__banner__".concat(e)}O[e]=t;const r="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(O))O[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{L=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),o=document.getElementById(t)||document.createElement("span"),a=n("learnmore"),l=document.getElementById(a)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,a);const n=s();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,o,l,n),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function j(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function F(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(j())}function U(){var e;const t=null===(e=k())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}function V(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function z(){return!0===u||!0===h}function q(){return!U()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function B(){try{return"object"===typeof indexedDB}catch(e){return!1}}class W extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,W.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,H.prototype.create)}}class H{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(G,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",s="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new W(n,s,t)}}const G=/\{\$([^}]+)}/g;function K(e){return JSON.parse(e)}function Q(e){return JSON.stringify(e)}const Y=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=K(w(s[0])||""),n=K(w(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(s){}return{header:t,claims:n,data:r,signature:i}};function X(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function $(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Z(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function ee(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(te(n)&&te(s)){if(!ee(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function te(e){return null!==e&&"object"===typeof e}function ne(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function re(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function ie(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class se{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"===typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(r=l^o&(a^l),i=1518500249):(r=o^a^l,i=1859775393):u<60?(r=o&a|l&(o|a),i=2400959708):(r=o^a^l,i=3395469782);const e=(s<<5|s>>>27)+r+c+i+n[u]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let r=0;r<5;r++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[r]>>t&255,++n;return e}}class oe{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=ae),void 0===r.error&&(r.error=ae),void 0===r.complete&&(r.complete=ae);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ae(){}function le(e,t){return"".concat(e," failed: ").concat(t," argument ")}const ce=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function ue(e){return e&&e._delegate?e._delegate:e}class he{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const de="[DEFAULT]";class fe{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new R;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:de})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===de?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(s){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de;return this.component?this.component.multipleInstances?e:de:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class pe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new fe(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const me=[];var ge;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ge||(ge={}));const ye={debug:ge.DEBUG,verbose:ge.VERBOSE,info:ge.INFO,warn:ge.WARN,error:ge.ERROR,silent:ge.SILENT},ve=ge.INFO,_e={[ge.DEBUG]:"log",[ge.VERBOSE]:"log",[ge.INFO]:"info",[ge.WARN]:"warn",[ge.ERROR]:"error"},we=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=_e[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];console[r]("[".concat(n,"]  ").concat(e.name,":"),...s)};class be{constructor(e){this.name=e,this._logLevel=ve,this._logHandler=we,this._userLogHandler=null,me.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ge))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?ye[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ge.DEBUG,...t),this._logHandler(this,ge.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ge.VERBOSE,...t),this._logHandler(this,ge.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ge.INFO,...t),this._logHandler(this,ge.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ge.WARN,...t),this._logHandler(this,ge.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ge.ERROR,...t),this._logHandler(this,ge.ERROR,...t)}}let Ce,Se;const Ee=new WeakMap,ke=new WeakMap,Te=new WeakMap,Ie=new WeakMap,xe=new WeakMap;let Ne={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ke.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Te.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ae(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Re(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Se||(Se=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(De(this),n),Ae(Ee.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ae(e.apply(De(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const s=e.call(De(this),t,...r);return Te.set(s,t.sort?t.sort():[t]),Ae(s)}}function Pe(e){return"function"===typeof e?Re(e):(e instanceof IDBTransaction&&function(e){if(ke.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ke.set(e,t)}(e),t=e,(Ce||(Ce=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Ne):e);var t}function Ae(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Ae(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&Ee.set(t,e)}).catch(()=>{}),xe.set(t,e),t}(e);if(Ie.has(e))return Ie.get(e);const t=Pe(e);return t!==e&&(Ie.set(e,t),xe.set(t,e)),t}const De=e=>xe.get(e);const Oe=["get","getKey","getAll","getAllKeys","count"],Le=["put","add","delete","clear"],Me=new Map;function je(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Me.get(t))return Me.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Le.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Oe.includes(n))return;const s=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let s=t.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];return r&&(s=s.index(a.shift())),(await Promise.all([s[n](...a),i&&t.done]))[0]};return Me.set(t,s),s}Ne=(e=>c(c({},e),{},{get:(t,n,r)=>je(t,n)||e.get(t,n,r),has:(t,n)=>!!je(t,n)||e.has(t,n)}))(Ne);class Fe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const Ue="@firebase/app",Ve="0.14.3",ze=new be("@firebase/app"),qe="@firebase/app-compat",Be="@firebase/analytics-compat",We="@firebase/analytics",He="@firebase/app-check-compat",Ge="@firebase/app-check",Ke="@firebase/auth",Qe="@firebase/auth-compat",Ye="@firebase/database",Xe="@firebase/data-connect",Je="@firebase/database-compat",$e="@firebase/functions",Ze="@firebase/functions-compat",et="@firebase/installations",tt="@firebase/installations-compat",nt="@firebase/messaging",rt="@firebase/messaging-compat",it="@firebase/performance",st="@firebase/performance-compat",ot="@firebase/remote-config",at="@firebase/remote-config-compat",lt="@firebase/storage",ct="@firebase/storage-compat",ut="@firebase/firestore",ht="@firebase/ai",dt="@firebase/firestore-compat",ft="firebase",pt="[DEFAULT]",mt={[Ue]:"fire-core",[qe]:"fire-core-compat",[We]:"fire-analytics",[Be]:"fire-analytics-compat",[Ge]:"fire-app-check",[He]:"fire-app-check-compat",[Ke]:"fire-auth",[Qe]:"fire-auth-compat",[Ye]:"fire-rtdb",[Xe]:"fire-data-connect",[Je]:"fire-rtdb-compat",[$e]:"fire-fn",[Ze]:"fire-fn-compat",[et]:"fire-iid",[tt]:"fire-iid-compat",[nt]:"fire-fcm",[rt]:"fire-fcm-compat",[it]:"fire-perf",[st]:"fire-perf-compat",[ot]:"fire-rc",[at]:"fire-rc-compat",[lt]:"fire-gcs",[ct]:"fire-gcs-compat",[ut]:"fire-fst",[dt]:"fire-fst-compat",[ht]:"fire-vertex","fire-js":"fire-js",[ft]:"fire-js-all"},gt=new Map,yt=new Map,vt=new Map;function _t(e,t){try{e.container.addComponent(t)}catch(n){ze.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function wt(e){const t=e.name;if(vt.has(t))return ze.debug("There were multiple attempts to register component ".concat(t,".")),!1;vt.set(t,e);for(const n of gt.values())_t(n,e);for(const n of yt.values())_t(n,e);return!0}function bt(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ct(e){return null!==e&&void 0!==e&&void 0!==e.settings}const St=new H("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Et{constructor(e,t,n){this._isDeleted=!1,this._options=c({},e),this._config=c({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new he("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw St.create("app-deleted",{appName:this._name})}}const kt="12.3.0";function Tt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=c({name:pt,automaticDataCollectionEnabled:!0},t),i=r.name;if("string"!==typeof i||!i)throw St.create("bad-app-name",{appName:String(i)});if(n||(n=x()),!n)throw St.create("no-options");const s=gt.get(i);if(s){if(ee(n,s.options)&&ee(r,s.config))return s;throw St.create("duplicate-app",{appName:i})}const o=new pe(i);for(const l of vt.values())o.addComponent(l);const a=new Et(n,r,o);return gt.set(i,a),a}function It(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pt;const t=gt.get(e);if(!t&&e===pt&&x())return Tt();if(!t)throw St.create("no-app",{appName:e});return t}function xt(e,t,n){var r;let i=null!==(r=mt[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return s&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),s&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void ze.warn(e.join(" "))}wt(new he("".concat(i,"-version"),()=>({library:i,version:t}),"VERSION"))}const Nt="firebase-heartbeat-store";let Rt=null;function Pt(){return Rt||(Rt=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(e,t),a=Ae(o);return r&&o.addEventListener("upgradeneeded",e=>{r(Ae(o.result),e.oldVersion,e.newVersion,Ae(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Nt)}catch(n){console.warn(n)}}}).catch(e=>{throw St.create("idb-open",{originalErrorMessage:e.message})})),Rt}async function At(e,t){try{const n=(await Pt()).transaction(Nt,"readwrite"),r=n.objectStore(Nt);await r.put(t,Dt(e)),await n.done}catch(n){if(n instanceof W)ze.warn(n.message);else{const e=St.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});ze.warn(e.message)}}}function Dt(e){return"".concat(e.name,"!").concat(e.options.appId)}class Ot{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Mt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{var e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Lt();var t;if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){ze.warn(n)}}async getHeartbeatsHeader(){try{var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Lt(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),jt(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),jt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=_(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ze.warn(t),""}}}function Lt(){return(new Date).toISOString().substring(0,10)}class Mt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!B()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(yd){t(yd)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Pt()).transaction(Nt),n=await t.objectStore(Nt).get(Dt(e));return await t.done,n}catch(t){if(t instanceof W)ze.warn(t.message);else{const e=St.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});ze.warn(e.message)}}}(this.app);return null!==e&&void 0!==e&&e.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return At(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return At(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function jt(e){return _(JSON.stringify({version:2,heartbeats:e})).length}var Ft;Ft="",wt(new he("platform-logger",e=>new Fe(e),"PRIVATE")),wt(new he("heartbeat",e=>new Ot(e),"PRIVATE")),xt(Ue,Ve,Ft),xt(Ue,Ve,"esm2020"),xt("fire-js","");var Ut,Vt,zt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},qt={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const r=Array(16);if("string"===typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s,o=e.g[3];s=t+(o^n&(i^o))+r[0]+3614090360&4294967295,s=o+(i^(t=n+(s<<7&4294967295|s>>>25))&(n^i))+r[1]+3905402710&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(n^o&(t^n))+r[2]+606105819&4294967295,s=n+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+r[3]+3250441966&4294967295,s=t+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[4]+4118548399&4294967295,s=o+(i^(t=n+(s<<7&4294967295|s>>>25))&(n^i))+r[5]+1200080426&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(n^o&(t^n))+r[6]+2821735955&4294967295,s=n+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+r[7]+4249261313&4294967295,s=t+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[8]+1770035416&4294967295,s=o+(i^(t=n+(s<<7&4294967295|s>>>25))&(n^i))+r[9]+2336552879&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(n^o&(t^n))+r[10]+4294925233&4294967295,s=n+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+r[11]+2304563134&4294967295,s=t+(o^(n=i+(s<<22&4294967295|s>>>10))&(i^o))+r[12]+1804603682&4294967295,s=o+(i^(t=n+(s<<7&4294967295|s>>>25))&(n^i))+r[13]+4254626195&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(n^o&(t^n))+r[14]+2792965006&4294967295,s=n+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+r[15]+1236535329&4294967295,s=t+(i^o&((n=i+(s<<22&4294967295|s>>>10))^i))+r[1]+4129170786&4294967295,s=o+(n^i&((t=n+(s<<5&4294967295|s>>>27))^n))+r[6]+3225465664&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^n&(o^t))+r[11]+643717713&4294967295,s=n+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+r[0]+3921069994&4294967295,s=t+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[5]+3593408605&4294967295,s=o+(n^i&((t=n+(s<<5&4294967295|s>>>27))^n))+r[10]+38016083&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^n&(o^t))+r[15]+3634488961&4294967295,s=n+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+r[4]+3889429448&4294967295,s=t+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[9]+568446438&4294967295,s=o+(n^i&((t=n+(s<<5&4294967295|s>>>27))^n))+r[14]+3275163606&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^n&(o^t))+r[3]+4107603335&4294967295,s=n+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+r[8]+1163531501&4294967295,s=t+(i^o&((n=i+(s<<20&4294967295|s>>>12))^i))+r[13]+2850285829&4294967295,s=o+(n^i&((t=n+(s<<5&4294967295|s>>>27))^n))+r[2]+4243563512&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^n&(o^t))+r[7]+1735328473&4294967295,s=n+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+r[12]+2368359562&4294967295,s=t+((n=i+(s<<20&4294967295|s>>>12))^i^o)+r[5]+4294588738&4294967295,s=o+((t=n+(s<<4&4294967295|s>>>28))^n^i)+r[8]+2272392833&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^n)+r[11]+1839030562&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^t)+r[14]+4259657740&4294967295,s=t+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[1]+2763975236&4294967295,s=o+((t=n+(s<<4&4294967295|s>>>28))^n^i)+r[4]+1272893353&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^n)+r[7]+4139469664&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^t)+r[10]+3200236656&4294967295,s=t+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[13]+681279174&4294967295,s=o+((t=n+(s<<4&4294967295|s>>>28))^n^i)+r[0]+3936430074&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^n)+r[3]+3572445317&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^t)+r[6]+76029189&4294967295,s=t+((n=i+(s<<23&4294967295|s>>>9))^i^o)+r[9]+3654602809&4294967295,s=o+((t=n+(s<<4&4294967295|s>>>28))^n^i)+r[12]+3873151461&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^n)+r[15]+530742520&4294967295,s=n+((i=o+(s<<16&4294967295|s>>>16))^o^t)+r[2]+3299628645&4294967295,s=t+(i^((n=i+(s<<23&4294967295|s>>>9))|~o))+r[0]+4096336452&4294967295,s=o+(n^((t=n+(s<<6&4294967295|s>>>26))|~i))+r[7]+1126891415&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~n))+r[14]+2878612391&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+r[5]+4237533241&4294967295,s=t+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[12]+1700485571&4294967295,s=o+(n^((t=n+(s<<6&4294967295|s>>>26))|~i))+r[3]+2399980690&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~n))+r[10]+4293915773&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+r[1]+2240044497&4294967295,s=t+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[8]+1873313359&4294967295,s=o+(n^((t=n+(s<<6&4294967295|s>>>26))|~i))+r[15]+4264355552&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~n))+r[6]+2734768916&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+r[13]+1309151649&4294967295,s=t+(i^((n=i+(s<<21&4294967295|s>>>11))|~o))+r[4]+4149444226&4294967295,s=o+(n^((t=n+(s<<6&4294967295|s>>>26))|~i))+r[11]+3174756917&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~n))+r[2]+718787259&4294967295,s=n+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+o&4294967295}function r(e,t){this.h=t;const n=[];let r=!0;for(let i=e.length-1;i>=0;i--){const s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const r=t-this.blockSize,i=this.C;let s=this.h,o=0;for(;o<t;){if(0==s)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"===typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var i={};function s(e){return-128<=e&&e<128?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new r([0|e],e<0?-1:0)}):new r([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(e<0)return d(o(-e));const t=[];let n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new r(t,0)}var a=s(0),l=s(1),c=s(16777216);function u(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){const t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new r(n,~e.h).add(l)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new m(a,a);if(h(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(h(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(e.g.length>30){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=t;r.l(e)<=0;)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!u(r);){var c=s.add(r);c.l(e)<=0&&(i=i.add(n),s=c),r=v(r,1),n=v(n,1)}return t=f(e,i.j(t)),new m(i,t)}for(i=a;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),c=(s=o(n)).j(t);h(c)||c.l(e)>0;)c=(s=o(n-=r)).j(t);u(s)&&(s=l),i=i.add(s),e=f(e,c)}return new m(i,e)}function y(e){const t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new r(n,e.h)}function v(e,t){const n=t>>5;t%=32;const i=e.g.length-n,s=[];for(let r=0;r<i;r++)s[r]=t>0?e.i(r+n)>>>t|e.i(r+n+1)<<32-t:e.i(r+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(h(this))return"-"+d(this).toString(e);const t=o(Math.pow(e,6));var n=this;let r="";for(;;){const i=g(n,t).g;let s=(((n=f(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(u(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let i=0;for(let r=0;r<=t;r++){let t=i+(65535&this.i(r))+(65535&e.i(r)),s=(t>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);i=s>>>16,t&=65535,s&=65535,n[r]=s<<16|t}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(this.l(c)<0&&e.l(c)<0)return o(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){const r=this.i(i)>>>16,s=65535&this.i(i),o=e.i(t)>>>16,a=65535&e.i(t);n[2*i+2*t]+=s*a,p(n,2*i+2*t),n[2*i+2*t+1]+=r*a,p(n,2*i+2*t+1),n[2*i+2*t+1]+=s*o,p(n,2*i+2*t+1),n[2*i+2*t+2]+=r*o,p(n,2*i+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new r(n,0)},e.B=function(e){return g(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new r(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new r(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,Vt=qt.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=o(Math.pow(n,8));let i=a;for(let a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a);const e=parseInt(t.substring(a,a+s),n);s<8?(s=o(Math.pow(n,s)),i=i.j(s).add(o(e))):(i=i.j(r),i=i.add(o(e)))}return i},Ut=qt.Integer=r}).apply("undefined"!==typeof zt?zt:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Bt,Wt,Ht,Gt,Kt,Qt,Yt,Xt,Jt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},$t={};(function(){var e,t=Object.defineProperty;var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Jt&&Jt];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var i=i||{},s=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){return(l=a).apply(null,arguments)}function c(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var h="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function d(e){const t=e.length;if(t>0){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let r=1;r<arguments.length;r++){const t=arguments[r];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function p(e){s.setTimeout(()=>{throw e},0)}function m(){var e=w;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new y,e=>e.reset());class y{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let v,_=!1,w=new class{constructor(){this.h=this.g=null}add(e,t){const n=g.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},b=()=>{const e=Promise.resolve(void 0);v=()=>{e.then(C)}};function C(){for(var e;e=m();){try{e.h.call(e.g)}catch(n){p(n)}var t=g;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}_=!1}function S(){this.u=this.u,this.C=this.C}function E(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}S.prototype.u=!1,S.prototype.dispose=function(){this.u||(this.u=!0,this.N())},S.prototype[Symbol.dispose]=function(){this.dispose()},S.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},E.prototype.h=function(){this.defaultPrevented=!0};var k=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(n){}return e}();function T(e){return/^[\s\xa0]*$/.test(e)}function I(e,t){E.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}u(I,E),I.prototype.init=function(e,t){const n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&I.Z.h.call(this)},I.prototype.h=function(){I.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var x="closure_listenable_"+(1e6*Math.random()|0),N=0;function R(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++N,this.da=this.fa=!1}function P(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function A(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function D(e){const t={};for(const n in e)t[n]=e[n];return t}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<O.length;t++)n=O[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function M(e){this.src=e,this.g={},this.h=0}function j(e,t){const n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(P(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function F(e,t,n,r){for(let i=0;i<e.length;++i){const s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}M.prototype.add=function(e,t,n,r,i){const s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);const o=F(e,t,r,i);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new R(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var U="closure_lm_"+(1e6*Math.random()|0),V={};function z(e,t,n,r,i){if(r&&r.once)return B(e,t,n,r,i);if(Array.isArray(t)){for(let s=0;s<t.length;s++)z(e,t[s],n,r,i);return null}return n=X(n),e&&e[x]?e.J(t,n,o(r)?!!r.capture:!!r,i):q(e,t,n,!1,r,i)}function q(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");const a=o(i)?!!i.capture:!!i;let l=Q(e);if(l||(e[U]=l=new M(e)),(n=l.add(t,n,r,a,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=K;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)k||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(G(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function B(e,t,n,r,i){if(Array.isArray(t)){for(let s=0;s<t.length;s++)B(e,t[s],n,r,i);return null}return n=X(n),e&&e[x]?e.K(t,n,o(r)?!!r.capture:!!r,i):q(e,t,n,!0,r,i)}function W(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)W(e,t[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=X(n),e&&e[x]?(e=e.i,(s=String(t).toString())in e.g&&((n=F(t=e.g[s],n,r,i))>-1&&(P(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[s],e.h--)))):e&&(e=Q(e))&&(t=e.g[t.toString()],e=-1,t&&(e=F(t,n,r,i)),(n=e>-1?t[e]:null)&&H(n))}function H(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[x])j(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(G(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Q(t))?(j(n,e),0==n.h&&(n.src=null,t[U]=null)):P(e)}}}function G(e){return e in V?V[e]:V[e]="on"+e}function K(e,t){if(e.da)e=!0;else{t=new I(t,this);const n=e.listener,r=e.ha||e.src;e.fa&&H(e),e=n.call(r,t)}return e}function Q(e){return(e=e[U])instanceof M?e:null}var Y="__closure_events_fn_"+(1e9*Math.random()>>>0);function X(e){return"function"===typeof e?e:(e[Y]||(e[Y]=function(t){return e.handleEvent(t)}),e[Y])}function J(){S.call(this),this.i=new M(this),this.M=this,this.G=null}function $(e,t){var n,r=e.G;if(r)for(n=[];r;r=r.G)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new E(t,e);else if(t instanceof E)t.target=t.target||e;else{var i=t;L(t=new E(r,e),i)}let s,o;if(i=!0,n)for(o=n.length-1;o>=0;o--)s=t.g=n[o],i=Z(s,r,!0,t)&&i;if(s=t.g=e,i=Z(s,r,!0,t)&&i,i=Z(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)s=t.g=n[o],i=Z(s,r,!1,t)&&i}function Z(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){const o=t[s];if(o&&!o.da&&o.capture==n){const t=o.listener,n=o.ha||o.src;o.fa&&j(e.i,o),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}function ee(e){e.g=function(e,t){if("function"!==typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return Number(t)>2147483647?-1:s.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,ee(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(J,S),J.prototype[x]=!0,J.prototype.removeEventListener=function(e,t,n,r){W(this,e,t,n,r)},J.prototype.N=function(){if(J.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)P(n[e]);delete e.g[t],e.h--}}this.G=null},J.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},J.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class te extends S{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ee(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ne(e){S.call(this),this.h=e,this.g={}}u(ne,S);var re=[];function ie(e){A(e.g,function(e,t){this.g.hasOwnProperty(t)&&H(e)},e),e.g={}}ne.prototype.N=function(){ne.Z.N.call(this),ie(this)},ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var se=s.JSON.stringify,oe=s.JSON.parse,ae=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function le(){}function ce(){}var ue={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function he(){E.call(this,"d")}function de(){E.call(this,"c")}u(he,E),u(de,E);var fe={},pe=null;function me(){return pe=pe||new J}function ge(e){E.call(this,fe.Ia,e)}function ye(e){const t=me();$(t,new ge(t))}function ve(e,t){E.call(this,fe.STAT_EVENT,e),this.stat=t}function _e(e){const t=me();$(t,new ve(t,e))}function we(e,t){E.call(this,fe.Ja,e),this.size=t}function be(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){e()},t)}function Ce(){this.g=!0}function Se(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const s=JSON.parse(t);if(s)for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}return se(s)}catch(s){return t}}(e,n)+(r?" "+r:"")})}fe.Ia="serverreachability",u(ge,E),fe.STAT_EVENT="statevent",u(ve,E),fe.Ja="timingevent",u(we,E),Ce.prototype.ua=function(){this.g=!1},Ce.prototype.info=function(){};var Ee,ke={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Te={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ie(){}function xe(e){return encodeURIComponent(String(e))}function Ne(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Re(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new ne(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Pe}function Pe(){this.i=null,this.g="",this.h=!1}u(Ie,le),Ie.prototype.g=function(){return new XMLHttpRequest},Ee=new Ie;var Ae={},De={};function Oe(e,t,n){e.M=1,e.A=st(et(t)),e.u=n,e.R=!0,Le(e,null)}function Le(e,t){e.F=Date.now(),Fe(e),e.B=et(e.A);var n=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),_t(n.i,"t",r),e.C=0,n=e.j.L,e.h=new Pe,e.g=yn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new te(l(e.Y,e,e.g),e.P)),t=e.V,n=e.g,r=e.ba;var i="readystatechange";Array.isArray(i)||(i&&(re[0]=i.toString()),i=re);for(let s=0;s<i.length;s++){const e=z(n,i[s],r||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?D(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ye(),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s){var o="",a=s.split("&");for(let e=0;e<a.length;e++){var l=a[e].split("=");if(l.length>1){const e=l[0];l=l[1];const t=e.split("_");o=t.length>=2&&"type"==t[1]?o+(e+"=")+l+"&":o+(e+"=redacted&")}}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Me(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function je(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?De:(n=Number(t.substring(n,r)),isNaN(n)?Ae:(r+=1)+n>t.length?De:(t=t.slice(r,r+n),e.C=r+n,t))}function Fe(e){e.T=Date.now()+e.H,Ue(e,e.H)}function Ue(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=be(l(e.aa,e),t)}function Ve(e){e.D&&(s.clearTimeout(e.D),e.D=null)}function ze(e){0==e.j.I||e.K||dn(e.j,e)}function qe(e){Ve(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ie(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Be(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||Qe(n.h,e)))if(!e.L&&Qe(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;hn(n),Zt(n)}ln(n),_e(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=be(l(n.Va,n),6e3));Ke(n.h)<=1&&n.ta&&(n.ta=void 0)}else pn(n,11)}else if((e.L||n.g==e)&&hn(n),!T(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let l=i[t];const u=l[0];if(!(u<=n.K))if(n.K=u,l=l[1],2==n.I)if("c"==l[0]){n.M=l[1],n.ba=l[2];const t=l[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const i=l[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));const u=l[5];null!=u&&"number"===typeof u&&u>0&&(r=1.5*u,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ye(s,s.h),s.h=null))}if(r.G){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,it(r.J,r.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=e;if((r=n).na=gn(r,r.L?r.ba:null,r.W),o.L){Xe(r.h,o);var a=o,c=r.O;c&&(a.H=c),a.D&&(Ve(a),Fe(a)),r.g=o}else an(r);n.i.length>0&&nn(n)}else"stop"!=l[0]&&"close"!=l[0]||pn(n,7);else 3==n.I&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?pn(n,7):qt(n):"noop"!=l[0]&&n.l&&n.l.qa(l),n.A=0)}ye()}catch(u){}}Re.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Ft(e)?t.j():this.Y(e)},Re.prototype.Y=function(e){try{if(e==this.g)e:{const l=Ft(this.g),c=this.g.ya();this.g.ca();if(!(l<3)&&(3!=l||this.g&&(this.h.h||this.g.la()||Ut(this.g)))){this.K||4!=l||7==c||ye(),Ve(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Me(e))return e.g.la();const t=Ut(e.g);if(""===t)return"";let n="";const r=t.length,i=4==Ft(e.g);if(!e.h.i){if("undefined"===typeof TextDecoder)return qe(e),ze(e),"";e.h.i=new s.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,r,i,s,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.i,this.v,this.B,this.l,this.S,l,t),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i=this.g;if((r=i.g?i.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(r)){var o=r;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,_e(12),qe(this),ze(this);break e}Se(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Be(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=je(this,n),t==De){4==l&&(this.m=4,_e(14),e=!1),Se(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ae){this.m=4,_e(15),Se(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Se(this.i,this.l,t,null),Be(this,t)}if(Me(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=l||0!=n.length||this.h.h||(this.m=1,_e(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),cn(a),a.P=!0,_e(11))}}else Se(this.i,this.l,n,"[Invalid Chunked Response]"),qe(this),ze(this)}else Se(this.i,this.l,n,null),Be(this,n);4==l&&qe(this),this.o&&!this.K&&(4==l?dn(this.j,this):(this.o=!1,Fe(this)))}else(function(e){const t={};e=(e.g&&Ft(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(T(e[r]))continue;var n=Ne(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,_e(12)):(this.m=0,_e(13)),qe(this),ze(this)}}}catch(Dn){}},Re.prototype.cancel=function(){this.K=!0,qe(this)},Re.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ye(),_e(17)),qe(this),this.m=2,ze(this)):Ue(this,this.T-e)};var We=class{constructor(e,t){this.g=e,this.map=t}};function He(e){this.l=e||10,s.PerformanceNavigationTiming?e=(e=s.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ge(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ke(e){return e.h?1:e.g?e.g.size:0}function Qe(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ye(e,t){e.g?e.g.add(t):e.h=t}function Xe(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Je(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return d(e.i)}He.prototype.cancel=function(){if(this.i=Je(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var $e=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ze(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Ze?(this.l=e.l,tt(this,e.j),this.o=e.o,this.g=e.g,nt(this,e.u),this.h=e.h,rt(this,wt(e.i)),this.m=e.m):e&&(t=String(e).match($e))?(this.l=!1,tt(this,t[1]||"",!0),this.o=ot(t[2]||""),this.g=ot(t[3]||"",!0),nt(this,t[4]),this.h=ot(t[5]||"",!0),rt(this,t[6]||"",!0),this.m=ot(t[7]||"")):(this.l=!1,this.i=new pt(null,this.l))}function et(e){return new Ze(e)}function tt(e,t,n){e.j=n?ot(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function nt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function rt(e,t,n){t instanceof pt?(e.i=t,function(e,t){t&&!e.j&&(mt(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(gt(this,t),_t(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=at(t,dt)),e.i=new pt(t,e.l))}function it(e,t,n){e.i.set(t,n)}function st(e){return it(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ot(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function at(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,lt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function lt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ze.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(at(t,ct,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(at(t,ct,!0),"@"),e.push(xe(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(at(n,"/"==n.charAt(0)?ht:ut,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",at(n,ft)),e.join("")},Ze.prototype.resolve=function(e){const t=et(this);let n=!!e.j;n?tt(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)nt(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");const e=[];for(let t=0;t<i.length;){const n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?rt(t,wt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var ct=/[#\/\?@]/g,ut=/[#\?:]/g,ht=/[#\?]/g,dt=/[#\?@]/g,ft=/#/g;function pt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function mt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const r=e[n].indexOf("=");let i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function gt(e,t){mt(e),t=bt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function yt(e,t){return mt(e),t=bt(e,t),e.g.has(t)}function vt(e,t){mt(e);let n=[];if("string"===typeof t)yt(e,t)&&(n=n.concat(e.g.get(bt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function _t(e,t,n){gt(e,t),n.length>0&&(e.i=null,e.g.set(bt(e,t),d(n)),e.h+=n.length)}function wt(e){const t=new pt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function bt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ct(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(s){}}function St(){this.g=new ae}function Et(e){this.i=e.Sb||null,this.h=e.ab||!1}function kt(e,t){J.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Tt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function It(e){e.readyState=4,e.l=null,e.j=null,e.B=null,xt(e)}function xt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Nt(e){let t="";return A(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Rt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Nt(n),"string"===typeof e?null!=n&&xe(n):it(e,t,n))}function Pt(e){J.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=pt.prototype).add=function(e,t){mt(this),this.i=null,e=bt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){mt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.set=function(e,t){return mt(this),this.i=null,yt(this,e=bt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=vt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];const i=xe(n);n=vt(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+xe(n[t])),e.push(r)}}return this.i=e.join("&")},u(Et,le),Et.prototype.g=function(){return new kt(this.i,this.h)},u(kt,J),(e=kt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,xt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||s).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,It(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,xt(this)),this.g&&(this.readyState=3,xt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Tt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?It(this):xt(this),3==this.readyState&&Tt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,It(this))},e.Na=function(e){this.g&&(this.response=e,It(this))},e.ga=function(){this.g&&It(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(kt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Pt,J);var At=/^https?$/i,Dt=["POST","PUT"];function Ot(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Lt(e),jt(e)}function Lt(e){e.A||(e.A=!0,$(e,"complete"),$(e,"error"))}function Mt(e){if(e.h&&"undefined"!=typeof i)if(e.v&&4==Ft(e))setTimeout(e.Ca.bind(e),0);else if($(e,"readystatechange"),4==Ft(e)){e.h=!1;try{const i=e.ca();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===i){let t=String(e.D).match($e)[1]||null;!t&&s.self&&s.self.location&&(t=s.self.location.protocol.slice(0,-1)),r=!At.test(t?t.toLowerCase():"")}n=r}if(n)$(e,"complete"),$(e,"success");else{e.o=6;try{var o=Ft(e)>2?e.g.statusText:""}catch(a){o=""}e.l=o+" ["+e.ca()+"]",Lt(e)}}finally{jt(e)}}}function jt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const r=e.g;e.g=null,t||$(e,"ready");try{r.onreadystatechange=null}catch(n){}}}function Ft(e){return e.g?e.g.readyState:0}function Ut(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Vt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function zt(e){this.za=0,this.i=[],this.j=new Ce,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Vt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Vt("baseRetryDelayMs",5e3,e),this.Za=Vt("retryDelaySeedMs",1e4,e),this.Ta=Vt("forwardChannelMaxRetries",2,e),this.va=Vt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new He(e&&e.concurrentRequestLimit),this.Ba=new St,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function qt(e){if(tn(e),3==e.I){var t=e.V++,n=et(e.J);if(it(n,"SID",e.M),it(n,"RID",t),it(n,"TYPE","terminate"),sn(e,n),(t=new Re(e,e.j,t)).M=2,t.A=st(et(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!n&&s.Image&&((new Image).src=t.A,n=!0),n||(t.g=yn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Fe(t)}mn(e)}function Zt(e){e.g&&(cn(e),e.g.cancel(),e.g=null)}function tn(e){Zt(e),e.v&&(s.clearTimeout(e.v),e.v=null),hn(e),e.h.cancel(),e.m&&("number"===typeof e.m&&s.clearTimeout(e.m),e.m=null)}function nn(e){if(!Ge(e.h)&&!e.m){e.m=!0;var t=e.Ea;v||b(),_||(v(),_=!0),w.add(t,e),e.D=0}}function rn(e,t){var n;n=t?t.l:e.V++;const r=et(e.J);it(r,"SID",e.M),it(r,"RID",n),it(r,"AID",e.K),sn(e,r),e.u&&e.o&&Rt(r,e.u,e.o),n=new Re(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=on(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Ye(e.h,n),Oe(n,r,t)}function sn(e,t){e.H&&A(e.H,function(e,n){it(t,n,e)}),e.l&&A({},function(e,n){it(t,n,e)})}function on(e,t,n){n=Math.min(e.i.length,n);const r=e.l?l(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let c=0;c<n;c++){var s=i[c].g;const n=i[c].map;if((s-=t)<0)t=Math.max(0,i[c].g-100),l=!1;else try{s="req"+s+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[t,n]of a){let r=n;o(n)&&(r=se(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(en){throw e.push(s+"type="+encodeURIComponent("_badmap")),en}}catch(en){r&&r(n)}}if(l){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,n),t.G=e,a}function an(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;v||b(),_||(v(),_=!0),w.add(t,e),e.A=0}}function ln(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=be(l(e.Da,e),fn(e,e.A)),e.A++,!0)}function cn(e){null!=e.B&&(s.clearTimeout(e.B),e.B=null)}function un(e){e.g=new Re(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=et(e.na);it(t,"RID","rpc"),it(t,"SID",e.M),it(t,"AID",e.K),it(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&it(t,"TO",e.ia),it(t,"TYPE","xmlhttp"),sn(e,t),e.u&&e.o&&Rt(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=st(et(t)),n.u=null,n.R=!0,Le(n,e)}function hn(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function dn(e,t){var n=null;if(e.g==t){hn(e),cn(e),e.g=null;var r=2}else{if(!Qe(e.h,t))return;n=t.G,Xe(e.h,t),r=1}if(0!=e.I)if(t.o)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.F;var i=e.D;$(r=me(),new we(r,n)),nn(e)}else an(e);else if(3==(i=t.m)||0==i&&t.X>0||!(1==r&&function(e,t){return!(Ke(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.G.concat(e.i),!0):!(1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta))&&(e.m=be(l(e.Ea,e,t),fn(e,e.D)),e.D++,!0))}(e,t)||2==r&&ln(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),i){case 1:pn(e,5);break;case 4:pn(e,10);break;case 3:pn(e,6);break;default:pn(e,2)}}function fn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function pn(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.bb,e),r=e.Ua;const t=!r;r=new Ze(r||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||tt(r,"https"),st(r),t?function(e,t){const n=new Ce;if(s.Image){const r=new Image;r.onload=c(Ct,n,"TestLoadImage: loaded",!0,t,r),r.onerror=c(Ct,n,"TestLoadImage: error",!1,t,r),r.onabort=c(Ct,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=c(Ct,n,"TestLoadImage: timeout",!1,t,r),s.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ce;const n=new AbortController,r=setTimeout(()=>{n.abort(),Ct(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?Ct(0,0,!0,t):Ct(0,0,!1,t)}).catch(()=>{clearTimeout(r),Ct(0,0,!1,t)})}(r.toString(),n)}else _e(2);e.I=0,e.l&&e.l.pa(t),mn(e),tn(e)}function mn(e){if(e.I=0,e.ja=[],e.l){const t=Je(e.h);0==t.length&&0==e.i.length||(f(e.ja,t),f(e.ja,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.oa()}}function gn(e,t,n){var r=n instanceof Ze?et(n):new Ze(n);if(""!=r.g)t&&(r.g=t+"."+r.g),nt(r,r.u);else{var i=s.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;const e=new Ze(null);r&&tt(e,r),t&&(e.g=t),i&&nt(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&it(r,n,t),it(r,"VER",e.ka),sn(e,r),r}function yn(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Pt(new Et({ab:n})):new Pt(e.ma)).Fa(e.L),t}function vn(){}function _n(){}function wn(e,t){J.call(this),this.g=new zt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!T(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!T(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Sn(this)}function bn(e){he.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Cn(){de.call(this),this.status=1}function Sn(e){this.g=e}(e=Pt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ee.g(),this.g.onreadystatechange=h(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ot(this,o)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=s.FormData&&e instanceof s.FormData,!(Array.prototype.indexOf.call(Dt,t,void 0)>=0)||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of n)this.g.setRequestHeader(s,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(o){Ot(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,$(this,"complete"),$(this,"abort"),jt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),jt(this,!0)),Pt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Mt(this):this.Xa())},e.Xa=function(){Mt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Ft(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),oe(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=zt.prototype).ka=8,e.I=1,e.connect=function(e,t,n,r){_e(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=gn(this,null,this.W),nn(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Re(this,this.j,e);let s=this.o;if(this.U&&(s?(s=D(s),L(s,this.U)):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=on(this,i,t),it(n=et(this.J),"RID",e),it(n,"CVER",22),this.G&&it(n,"X-HTTP-Session-Id",this.G),sn(this,n),s&&(this.R?t="headers="+xe(Nt(s))+"&"+t:this.u&&Rt(n,this.u,s)),Ye(this.h,i),this.Ra&&it(n,"TYPE","init"),this.S?(it(n,"$req",t),it(n,"SID","null"),i.U=!0,Oe(i,n,null)):Oe(i,n,t),this.I=2}}else 3==this.I&&(e?rn(this,e):0==this.i.length||Ge(this.h)||rn(this))},e.Da=function(){if(this.v=null,un(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=be(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,_e(10),Zt(this),un(this))},e.Va=function(){null!=this.C&&(this.C=null,Zt(this),ln(this),_e(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),_e(2)):(this.j.info("Failed to ping google.com"),_e(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=vn.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},_n.prototype.g=function(e,t){return new wn(e,t)},u(wn,J),wn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},wn.prototype.close=function(){qt(this.g)},wn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=se(e),e=n);t.i.push(new We(t.Ya++,e)),3==t.I&&nn(t)},wn.prototype.N=function(){this.g.l=null,delete this.j,qt(this.g),delete this.g,wn.Z.N.call(this)},u(bn,he),u(Cn,de),u(Sn,vn),Sn.prototype.ra=function(){$(this.g,"a")},Sn.prototype.qa=function(e){$(this.g,new bn(e))},Sn.prototype.pa=function(e){$(this.g,new Cn)},Sn.prototype.oa=function(){$(this.g,"b")},_n.prototype.createWebChannel=_n.prototype.g,wn.prototype.send=wn.prototype.o,wn.prototype.open=wn.prototype.m,wn.prototype.close=wn.prototype.close,Xt=$t.createWebChannelTransport=function(){return new _n},Yt=$t.getStatEventTarget=function(){return me()},Qt=$t.Event=fe,Kt=$t.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ke.NO_ERROR=0,ke.TIMEOUT=8,ke.HTTP_ERROR=6,Gt=$t.ErrorCode=ke,Te.COMPLETE="complete",Ht=$t.EventType=Te,ce.EventType=ue,ue.OPEN="a",ue.CLOSE="b",ue.ERROR="c",ue.MESSAGE="d",J.prototype.listen=J.prototype.J,Wt=$t.WebChannel=ce,$t.FetchXmlHttpFactory=Et,Pt.prototype.listenOnce=Pt.prototype.K,Pt.prototype.getLastError=Pt.prototype.Ha,Pt.prototype.getLastErrorCode=Pt.prototype.ya,Pt.prototype.getStatus=Pt.prototype.ca,Pt.prototype.getResponseJson=Pt.prototype.La,Pt.prototype.getResponseText=Pt.prototype.la,Pt.prototype.send=Pt.prototype.ea,Pt.prototype.setWithCredentials=Pt.prototype.Fa,Bt=$t.XhrIo=Pt}).apply("undefined"!==typeof Jt?Jt:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const Zt="@firebase/firestore",en="4.9.2";class tn{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tn.UNAUTHENTICATED=new tn(null),tn.GOOGLE_CREDENTIALS=new tn("google-credentials-uid"),tn.FIRST_PARTY=new tn("first-party-uid"),tn.MOCK_USER=new tn("mock-user");let nn="12.3.0";const rn=new be("@firebase/firestore");function sn(){return rn.logLevel}function on(e){if(rn.logLevel<=ge.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(cn);rn.debug("Firestore (".concat(nn,"): ").concat(e),...i)}}function an(e){if(rn.logLevel<=ge.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(cn);rn.error("Firestore (".concat(nn,"): ").concat(e),...i)}}function ln(e){if(rn.logLevel<=ge.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(cn);rn.warn("Firestore (".concat(nn,"): ").concat(e),...i)}}function cn(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function un(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,hn(e,r,n)}function hn(e,t,n){let r="FIRESTORE (".concat(nn,") INTERNAL ASSERTION FAILED: ").concat(t," (ID: ").concat(e.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw an(r),new Error(r)}function dn(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||hn(t,i,r)}function fn(e,t){return e}const pn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class mn extends W{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class gn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class yn{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class vn{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tn.UNAUTHENTICATED))}shutdown(){}}class _n{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class wn{constructor(e){this.t=e,this.currentUser=tn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){dn(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new gn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new gn,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{on("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(on("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new gn)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(on("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(dn("string"==typeof t.accessToken,31837,{l:t}),new yn(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return dn(null===e||"string"==typeof e,2055,{h:e}),new tn(e)}}class bn{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=tn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Cn{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new bn(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Sn{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class En{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ct(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){dn(void 0===this.o,3512);const n=e=>{null!=e.error&&on("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.m;return this.m=e.token,on("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{on("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):on("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Sn(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(dn("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Sn(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function kn(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class Tn{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=kn(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function In(e,t){return e<t?-1:e>t?1:0}function xn(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),i=t.charAt(r);if(n!==i)return Pn(n)===Pn(i)?In(n,i):Pn(n)?1:-1}return In(e.length,t.length)}const Nn=55296,Rn=57343;function Pn(e){const t=e.charCodeAt(0);return t>=Nn&&t<=Rn}function An(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}const Dn="__name__";class On{constructor(e,t,n){void 0===t?t=0:t>e.length&&un(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&un(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===On.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof On?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=On.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return In(e.length,t.length)}static compareSegments(e,t){const n=On.isNumericId(e),r=On.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?On.extractNumericId(e).compare(On.extractNumericId(t)):xn(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ut.fromString(e.substring(4,e.length-2))}}class Ln extends On{construct(e,t,n){return new Ln(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new mn(pn.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter(e=>e.length>0))}return new Ln(e)}static emptyPath(){return new Ln([])}}const Mn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class jn extends On{construct(e,t,n){return new jn(e,t,n)}static isValidIdentifier(e){return Mn.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),jn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Dn}static keyField(){return new jn([Dn])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new mn(pn.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new mn(pn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new mn(pn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new mn(pn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new jn(t)}static emptyPath(){return new jn([])}}class Fn{constructor(e){this.path=e}static fromPath(e){return new Fn(Ln.fromString(e))}static fromName(e){return new Fn(Ln.fromString(e).popFirst(5))}static empty(){return new Fn(Ln.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ln.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ln.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Fn(new Ln(e.slice()))}}function Un(e,t,n){if(!n)throw new mn(pn.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Vn(e){if(!Fn.isDocumentKey(e))throw new mn(pn.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function zn(e){if(Fn.isDocumentKey(e))throw new mn(pn.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function qn(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Bn(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":un(12329,{type:typeof e})}function Wn(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new mn(pn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Bn(e);throw new mn(pn.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function Hn(e,t){if(t<=0)throw new mn(pn.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}function Gn(e,t){const n={typeString:e};return t&&(n.value=t),n}function Kn(e,t){if(!qn(e))throw new mn(pn.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n="JSON missing required field: '".concat(r,"'");break}const o=e[r];if(i&&typeof o!==i){n="JSON field '".concat(r,"' must be a ").concat(i,".");break}if(void 0!==s&&o!==s.value){n="Expected '".concat(r,"' field to equal '").concat(s.value,"'");break}}if(n)throw new mn(pn.INVALID_ARGUMENT,n);return!0}const Qn=-62135596800,Yn=1e6;class Xn{static now(){return Xn.fromMillis(Date.now())}static fromDate(e){return Xn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Yn);return new Xn(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new mn(pn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new mn(pn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Qn)throw new mn(pn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new mn(pn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Yn}_compareTo(e){return this.seconds===e.seconds?In(this.nanoseconds,e.nanoseconds):In(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Xn._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Kn(e,Xn._jsonSchema))return new Xn(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Qn;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Xn._jsonSchemaVersion="firestore/timestamp/1.0",Xn._jsonSchema={type:Gn("string",Xn._jsonSchemaVersion),seconds:Gn("number"),nanoseconds:Gn("number")};class Jn{static fromTimestamp(e){return new Jn(e)}static min(){return new Jn(new Xn(0,0))}static max(){return new Jn(new Xn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const $n=-1;class Zn{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}Zn.UNKNOWN_ID=-1;function er(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Jn.fromTimestamp(1e9===r?new Xn(n+1,0):new Xn(n,r));return new nr(i,Fn.empty(),t)}function tr(e){return new nr(e.readTime,e.key,$n)}class nr{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new nr(Jn.min(),Fn.empty(),$n)}static max(){return new nr(Jn.max(),Fn.empty(),$n)}}function rr(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Fn.comparator(e.documentKey,t.documentKey),0!==n?n:In(e.largestBatchId,t.largestBatchId))}const ir="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function or(e){if(e.code!==pn.FAILED_PRECONDITION||e.message!==ir)throw e;on("LocalStore","Unexpectedly lost primary lease")}class ar{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&un(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ar((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ar?t:ar.resolve(t)}catch(e){return ar.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ar.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ar.reject(t)}static resolve(e){return new ar((t,n)=>{t(e)})}static reject(e){return new ar((t,n)=>{n(e)})}static waitFor(e){return new ar((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=ar.resolve(!1);for(const n of e)t=t.next(e=>e?ar.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new ar((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const l=a;t(e[l]).next(e=>{s[l]=e,++o,o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new ar((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function lr(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function cr(e){return"IndexedDbTransactionError"===e.name}class ur{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ur.ce=-1;const hr=-1;function dr(e){return null==e}function fr(e){return 0===e&&1/e==-1/0}function pr(e){return"number"==typeof e&&Number.isInteger(e)&&!fr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const mr="\x01";function gr(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=vr(t)),t=yr(e.get(n),t);return vr(t)}function yr(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case mr:n+="\x01\x11";break;default:n+=t}}return n}function vr(e){return e+mr+"\x01"}const _r="remoteDocuments",wr="owner",br="mutationQueues",Cr="mutations";const Sr="documentMutations",Er="remoteDocumentsV14",kr="remoteDocumentGlobal",Tr="targets",Ir="targetDocuments",xr="targetGlobal",Nr="collectionParents",Rr="clientMetadata",Pr="bundles",Ar="namedQueries",Dr="indexConfiguration",Or="indexState",Lr="indexEntries",Mr="documentOverlays",jr="globals",Fr=[br,Cr,Sr,_r,Tr,wr,xr,Ir,Rr,kr,Nr,Pr,Ar],Ur=[br,Cr,Sr,Er,Tr,wr,xr,Ir,Rr,kr,Nr,Pr,Ar,Mr],Vr=Ur,zr=[...Vr,Dr,Or,Lr];function qr(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Br(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Wr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Hr{constructor(e,t){this.comparator=e,this.root=t||Kr.EMPTY}insert(e,t){return new Hr(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Kr.BLACK,null,null))}remove(e){return new Hr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Kr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Gr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Gr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Gr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Gr(this.root,e,this.comparator,!0)}}class Gr{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Kr{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Kr.RED,this.left=null!=r?r:Kr.EMPTY,this.right=null!=i?i:Kr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Kr(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Kr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Kr.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Kr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Kr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw un(43730,{key:this.key,value:this.value});if(this.right.isRed())throw un(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw un(27949);return e+(this.isRed()?0:1)}}Kr.EMPTY=null,Kr.RED=!0,Kr.BLACK=!1,Kr.EMPTY=new class{constructor(){this.size=0}get key(){throw un(57766)}get value(){throw un(16141)}get color(){throw un(16727)}get left(){throw un(29726)}get right(){throw un(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new Kr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Qr{constructor(e){this.comparator=e,this.data=new Hr(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Yr(this.data.getIterator())}getIteratorFrom(e){return new Yr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Qr))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Qr(this.comparator);return t.data=e,t}}class Yr{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Xr{constructor(e){this.fields=e,e.sort(jn.comparator)}static empty(){return new Xr([])}unionWith(e){let t=new Qr(jn.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Xr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return An(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Jr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $r{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Jr("Invalid base64 string: "+e):e}}(e);return new $r(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new $r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return In(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$r.EMPTY_BYTE_STRING=new $r("");const Zr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ei(e){if(dn(!!e,39018),"string"==typeof e){let t=0;const n=Zr.exec(e);if(dn(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ti(e.seconds),nanos:ti(e.nanos)}}function ti(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ni(e){return"string"==typeof e?$r.fromBase64String(e):$r.fromUint8Array(e)}const ri="server_timestamp",ii="__type__",si="__previous_value__",oi="__local_write_time__";function ai(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[ii])||void 0===t?void 0:t.stringValue)===ri}function li(e){const t=e.mapValue.fields[si];return ai(t)?li(t):t}function ci(e){const t=ei(e.mapValue.fields[oi].timestampValue);return new Xn(t.seconds,t.nanos)}class ui{constructor(e,t,n,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=c}}const hi="(default)";class di{constructor(e,t){this.projectId=e,this.database=t||hi}static empty(){return new di("","")}get isDefaultDatabase(){return this.database===hi}isEqual(e){return e instanceof di&&e.projectId===this.projectId&&e.database===this.database}}const fi="__type__",pi="__max__",mi={mapValue:{fields:{__type__:{stringValue:pi}}}},gi="__vector__",yi="value";function vi(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ai(e)?4:Li(e)?9007199254740991:Di(e)?10:11:un(28295,{value:e})}function _i(e,t){if(e===t)return!0;const n=vi(e);if(n!==vi(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ci(e).isEqual(ci(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=ei(e.timestampValue),r=ei(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ni(e.bytesValue).isEqual(ni(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ti(e.geoPointValue.latitude)===ti(t.geoPointValue.latitude)&&ti(e.geoPointValue.longitude)===ti(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ti(e.integerValue)===ti(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=ti(e.doubleValue),r=ti(t.doubleValue);return n===r?fr(n)===fr(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return An(e.arrayValue.values||[],t.arrayValue.values||[],_i);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(qr(n)!==qr(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!_i(n[i],r[i])))return!1;return!0}(e,t);default:return un(52216,{left:e})}}function wi(e,t){return void 0!==(e.values||[]).find(e=>_i(e,t))}function bi(e,t){if(e===t)return 0;const n=vi(e),r=vi(t);if(n!==r)return In(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return In(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=ti(e.integerValue||e.doubleValue),r=ti(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ci(e.timestampValue,t.timestampValue);case 4:return Ci(ci(e),ci(t));case 5:return xn(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ni(e),r=ni(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=In(n[i],r[i]);if(0!==e)return e}return In(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=In(ti(e.latitude),ti(t.latitude));return 0!==n?n:In(ti(e.longitude),ti(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Si(e.arrayValue,t.arrayValue);case 10:return function(e,t,n,r,i,s){const o=e.fields||{},a=t.fields||{},l=null===(n=o[yi])||void 0===n?void 0:n.arrayValue,c=null===(r=a[yi])||void 0===r?void 0:r.arrayValue,u=In((null===l||void 0===l||null===(i=l.values)||void 0===i?void 0:i.length)||0,(null===c||void 0===c||null===(s=c.values)||void 0===s?void 0:s.length)||0);return 0!==u?u:Si(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===mi.mapValue&&t===mi.mapValue)return 0;if(e===mi.mapValue)return 1;if(t===mi.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=xn(r[o],s[o]);if(0!==e)return e;const t=bi(n[r[o]],i[s[o]]);if(0!==t)return t}return In(r.length,s.length)}(e.mapValue,t.mapValue);default:throw un(23264,{he:n})}}function Ci(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return In(e,t);const n=ei(e),r=ei(t),i=In(n.seconds,r.seconds);return 0!==i?i:In(n.nanos,r.nanos)}function Si(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=bi(n[i],r[i]);if(e)return e}return In(n.length,r.length)}function Ei(e){return ki(e)}function ki(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=ei(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return ni(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Fn.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=ki(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+="".concat(i,":").concat(ki(e.fields[i]));return n+"}"}(e.mapValue):un(61005,{value:e})}function Ti(e){switch(vi(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=li(e);return t?16+Ti(t):16;case 5:return 2*e.stringValue.length;case 6:return ni(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+Ti(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Br(e.fields,(e,n)=>{t+=e.length+Ti(n)}),t}(e.mapValue);default:throw un(13486,{value:e})}}function Ii(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function xi(e){return!!e&&"integerValue"in e}function Ni(e){return!!e&&"arrayValue"in e}function Ri(e){return!!e&&"nullValue"in e}function Pi(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ai(e){return!!e&&"mapValue"in e}function Di(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[fi])||void 0===t?void 0:t.stringValue)===gi}function Oi(e){if(e.geoPointValue)return{geoPointValue:c({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:c({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Br(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Oi(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Oi(e.arrayValue.values[n]);return t}return c({},e)}function Li(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===pi}class Mi{constructor(e){this.value=e}static empty(){return new Mi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ai(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Oi(t)}setAll(e){let t=jn.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Oi(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Ai(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _i(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ai(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Br(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new Mi(Oi(this.value))}}function ji(e){const t=[];return Br(e.fields,(e,n)=>{const r=new jn([e]);if(Ai(n)){const e=ji(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new Xr(t)}class Fi{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Fi(e,0,Jn.min(),Jn.min(),Jn.min(),Mi.empty(),0)}static newFoundDocument(e,t,n,r){return new Fi(e,1,t,Jn.min(),n,r,0)}static newNoDocument(e,t){return new Fi(e,2,t,Jn.min(),Jn.min(),Mi.empty(),0)}static newUnknownDocument(e,t){return new Fi(e,3,t,Jn.min(),Jn.min(),Mi.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Jn.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Mi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Mi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Jn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Fi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Fi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class Ui{constructor(e,t){this.position=e,this.inclusive=t}}function Vi(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Fn.comparator(Fn.fromName(o.referenceValue),n.key):bi(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function zi(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!_i(e.position[n],t.position[n]))return!1;return!0}class qi{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Bi(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Wi{}class Hi extends Wi{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Zi(e,t,n):"array-contains"===t?new rs(e,n):"in"===t?new is(e,n):"not-in"===t?new ss(e,n):"array-contains-any"===t?new os(e,n):new Hi(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new es(e,n):new ts(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(bi(t,this.value)):null!==t&&vi(this.value)===vi(t)&&this.matchesComparison(bi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return un(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Gi extends Wi{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Gi(e,t)}matches(e){return Ki(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ki(e){return"and"===e.op}function Qi(e){return Yi(e)&&Ki(e)}function Yi(e){for(const t of e.filters)if(t instanceof Gi)return!1;return!0}function Xi(e){if(e instanceof Hi)return e.field.canonicalString()+e.op.toString()+Ei(e.value);if(Qi(e))return e.filters.map(e=>Xi(e)).join(",");{const t=e.filters.map(e=>Xi(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Ji(e,t){return e instanceof Hi?function(e,t){return t instanceof Hi&&e.op===t.op&&e.field.isEqual(t.field)&&_i(e.value,t.value)}(e,t):e instanceof Gi?function(e,t){return t instanceof Gi&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&Ji(n,t.filters[r]),!0)}(e,t):void un(19439)}function $i(e){return e instanceof Hi?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Ei(e.value))}(e):e instanceof Gi?function(e){return e.op.toString()+" {"+e.getFilters().map($i).join(" ,")+"}"}(e):"Filter"}class Zi extends Hi{constructor(e,t,n){super(e,t,n),this.key=Fn.fromName(n.referenceValue)}matches(e){const t=Fn.comparator(e.key,this.key);return this.matchesComparison(t)}}class es extends Hi{constructor(e,t){super(e,"in",t),this.keys=ns("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ts extends Hi{constructor(e,t){super(e,"not-in",t),this.keys=ns("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ns(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Fn.fromName(e.referenceValue))}class rs extends Hi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ni(t)&&wi(t.arrayValue,this.value)}}class is extends Hi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&wi(this.value.arrayValue,t)}}class ss extends Hi{constructor(e,t){super(e,"not-in",t)}matches(e){if(wi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!wi(this.value.arrayValue,t)}}class os extends Hi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ni(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>wi(this.value.arrayValue,e))}}class as{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function ls(e){return new as(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function cs(e){const t=fn(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Xi(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),dr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Ei(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Ei(e)).join(",")),t.Te=e}return t.Te}function us(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Bi(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Ji(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!zi(e.startAt,t.startAt)&&zi(e.endAt,t.endAt)}function hs(e){return Fn.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ds{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function fs(e,t,n,r,i,s,o,a){return new ds(e,t,n,r,i,s,o,a)}function ps(e){return new ds(e)}function ms(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function gs(e){return null!==e.collectionGroup}function ys(e){const t=fn(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Qr(jn.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new qi(r,n))}),e.has(jn.keyField().canonicalString())||t.Ie.push(new qi(jn.keyField(),n))}return t.Ie}function vs(e){const t=fn(e);return t.Ee||(t.Ee=_s(t,ys(e))),t.Ee}function _s(e,t){if("F"===e.limitType)return ls(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new qi(e.field,t)});const n=e.endAt?new Ui(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Ui(e.startAt.position,e.startAt.inclusive):null;return ls(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function ws(e,t){const n=e.filters.concat([t]);return new ds(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function bs(e,t,n){return new ds(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Cs(e,t){return us(vs(e),vs(t))&&e.limitType===t.limitType}function Ss(e){return"".concat(cs(vs(e)),"|lt:").concat(e.limitType)}function Es(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>$i(e)).join(", "),"]")),dr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Ei(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Ei(e)).join(",")),"Target(".concat(t,")")}(vs(e)),"; limitType=").concat(e.limitType,")")}function ks(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Fn.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of ys(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Vi(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,ys(e),t))&&!(e.endAt&&!function(e,t,n){const r=Vi(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,ys(e),t))}(e,t)}function Ts(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Is(e){return(t,n)=>{let r=!1;for(const i of ys(e)){const e=xs(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function xs(e,t,n){const r=e.field.isKeyField()?Fn.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?bi(r,i):un(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return un(19790,{direction:e.dir})}}class Ns{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Br(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return Wr(this.inner)}size(){return this.innerSize}}const Rs=new Hr(Fn.comparator);function Ps(){return Rs}const As=new Hr(Fn.comparator);function Ds(){let e=As;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function Os(e){let t=As;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Ls(){return js()}function Ms(){return js()}function js(){return new Ns(e=>e.toString(),(e,t)=>e.isEqual(t))}const Fs=new Hr(Fn.comparator),Us=new Qr(Fn.comparator);function Vs(){let e=Us;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const zs=new Qr(In);function qs(){return zs}function Bs(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fr(t)?"-0":t}}function Ws(e){return{integerValue:""+e}}function Hs(e,t){return pr(t)?Ws(t):Bs(e,t)}class Gs{constructor(){this._=void 0}}function Ks(e,t,n){return e instanceof Xs?function(e,t){const n={fields:{[ii]:{stringValue:ri},[oi]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ai(t)&&(t=li(t)),t&&(n.fields[si]=t),{mapValue:n}}(n,t):e instanceof Js?$s(e,t):e instanceof Zs?eo(e,t):function(e,t){const n=Ys(e,t),r=no(n)+no(e.Ae);return xi(n)&&xi(e.Ae)?Ws(r):Bs(e.serializer,r)}(e,t)}function Qs(e,t,n){return e instanceof Js?$s(e,t):e instanceof Zs?eo(e,t):n}function Ys(e,t){return e instanceof to?function(e){return xi(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Xs extends Gs{}class Js extends Gs{constructor(e){super(),this.elements=e}}function $s(e,t){const n=ro(t);for(const r of e.elements)n.some(e=>_i(e,r))||n.push(r);return{arrayValue:{values:n}}}class Zs extends Gs{constructor(e){super(),this.elements=e}}function eo(e,t){let n=ro(t);for(const r of e.elements)n=n.filter(e=>!_i(e,r));return{arrayValue:{values:n}}}class to extends Gs{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function no(e){return ti(e.integerValue||e.doubleValue)}function ro(e){return Ni(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class io{constructor(e,t){this.field=e,this.transform=t}}class so{constructor(e,t){this.version=e,this.transformResults=t}}class oo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oo}static exists(e){return new oo(void 0,e)}static updateTime(e){return new oo(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ao(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class lo{}function co(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new wo(e.key,oo.none()):new mo(e.key,e.data,oo.none());{const n=e.data,r=Mi.empty();let i=new Qr(jn.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new go(e.key,r,new Xr(i.toArray()),oo.none())}}function uo(e,t,n){e instanceof mo?function(e,t,n){const r=e.value.clone(),i=vo(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof go?function(e,t,n){if(!ao(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=vo(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(yo(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ho(e,t,n,r){return e instanceof mo?function(e,t,n,r){if(!ao(e.precondition,t))return n;const i=e.value.clone(),s=_o(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof go?function(e,t,n,r){if(!ao(e.precondition,t))return n;const i=_o(e.fieldTransforms,r,t),s=t.data;return s.setAll(yo(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return ao(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function fo(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Ys(r.transform,e||null);null!=i&&(null===n&&(n=Mi.empty()),n.set(r.field,i))}return n||null}function po(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&An(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Js&&t instanceof Js||e instanceof Zs&&t instanceof Zs?An(e.elements,t.elements,_i):e instanceof to&&t instanceof to?_i(e.Ae,t.Ae):e instanceof Xs&&t instanceof Xs}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class mo extends lo{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class go extends lo{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function yo(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function vo(e,t,n){const r=new Map;dn(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Qs(o,a,n[i]))}return r}function _o(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Ks(e,s,t))}return r}class wo extends lo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bo extends lo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Co{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&uo(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ho(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ho(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ms();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=co(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Jn.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Vs())}isEqual(e){return this.batchId===e.batchId&&An(this.mutations,e.mutations,(e,t)=>po(e,t))&&An(this.baseMutations,e.baseMutations,(e,t)=>po(e,t))}}class So{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){dn(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=Fs;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new So(e,t,n,r)}}class Eo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class ko{constructor(e,t){this.count=e,this.unchangedNames=t}}var To,Io;function xo(e){switch(e){case pn.OK:return un(64938);case pn.CANCELLED:case pn.UNKNOWN:case pn.DEADLINE_EXCEEDED:case pn.RESOURCE_EXHAUSTED:case pn.INTERNAL:case pn.UNAVAILABLE:case pn.UNAUTHENTICATED:return!1;case pn.INVALID_ARGUMENT:case pn.NOT_FOUND:case pn.ALREADY_EXISTS:case pn.PERMISSION_DENIED:case pn.FAILED_PRECONDITION:case pn.ABORTED:case pn.OUT_OF_RANGE:case pn.UNIMPLEMENTED:case pn.DATA_LOSS:return!0;default:return un(15467,{code:e})}}function No(e){if(void 0===e)return an("GRPC error has no .code"),pn.UNKNOWN;switch(e){case To.OK:return pn.OK;case To.CANCELLED:return pn.CANCELLED;case To.UNKNOWN:return pn.UNKNOWN;case To.DEADLINE_EXCEEDED:return pn.DEADLINE_EXCEEDED;case To.RESOURCE_EXHAUSTED:return pn.RESOURCE_EXHAUSTED;case To.INTERNAL:return pn.INTERNAL;case To.UNAVAILABLE:return pn.UNAVAILABLE;case To.UNAUTHENTICATED:return pn.UNAUTHENTICATED;case To.INVALID_ARGUMENT:return pn.INVALID_ARGUMENT;case To.NOT_FOUND:return pn.NOT_FOUND;case To.ALREADY_EXISTS:return pn.ALREADY_EXISTS;case To.PERMISSION_DENIED:return pn.PERMISSION_DENIED;case To.FAILED_PRECONDITION:return pn.FAILED_PRECONDITION;case To.ABORTED:return pn.ABORTED;case To.OUT_OF_RANGE:return pn.OUT_OF_RANGE;case To.UNIMPLEMENTED:return pn.UNIMPLEMENTED;case To.DATA_LOSS:return pn.DATA_LOSS;default:return un(39323,{code:e})}}(Io=To||(To={}))[Io.OK=0]="OK",Io[Io.CANCELLED=1]="CANCELLED",Io[Io.UNKNOWN=2]="UNKNOWN",Io[Io.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Io[Io.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Io[Io.NOT_FOUND=5]="NOT_FOUND",Io[Io.ALREADY_EXISTS=6]="ALREADY_EXISTS",Io[Io.PERMISSION_DENIED=7]="PERMISSION_DENIED",Io[Io.UNAUTHENTICATED=16]="UNAUTHENTICATED",Io[Io.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Io[Io.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Io[Io.ABORTED=10]="ABORTED",Io[Io.OUT_OF_RANGE=11]="OUT_OF_RANGE",Io[Io.UNIMPLEMENTED=12]="UNIMPLEMENTED",Io[Io.INTERNAL=13]="INTERNAL",Io[Io.UNAVAILABLE=14]="UNAVAILABLE",Io[Io.DATA_LOSS=15]="DATA_LOSS";let Ro=null;function Po(){return new TextEncoder}const Ao=new Ut([4294967295,4294967295],0);function Do(e){const t=Po().encode(e),n=new Vt;return n.update(t),new Uint8Array(n.digest())}function Oo(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Ut([n,r],0),new Ut([i,s],0)]}class Lo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Mo("Invalid padding: ".concat(t));if(n<0)throw new Mo("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new Mo("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new Mo("Invalid padding when bitmap length is 0: ".concat(t));this.ge=8*e.length-t,this.pe=Ut.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(Ut.fromNumber(n)));return 1===r.compare(Ao)&&(r=new Ut([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Do(e),[n,r]=Oo(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(n,r,i);if(!this.we(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Lo(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(e){if(0===this.ge)return;const t=Do(e),[n,r]=Oo(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(n,r,i);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Mo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class jo{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Fo.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new jo(Jn.min(),r,new Hr(In),Ps(),Vs())}}class Fo{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Fo(n,t,Vs(),Vs(),Vs())}}class Uo{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class Vo{constructor(e,t){this.targetId=e,this.Ce=t}}class zo{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$r.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class qo{constructor(){this.ve=0,this.Fe=Ho(),this.Me=$r.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Vs(),t=Vs(),n=Vs();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:un(38017,{changeType:i})}}),new Fo(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=Ho()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,dn(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Bo{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ps(),this.Je=Wo(),this.He=Wo(),this.Ye=new Hr(In)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:un(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(hs(s))if(0===n){const e=new Fn(s.path);this.et(t,e,Fi.newNoDocument(e,Jn.min()))}else dn(1===n,20013,{expectedCount:n});else{const r=this._t(t);if(r!==n){var i;const n=this.ut(e),s=n?this.ct(n,e,r):1;if(0!==s){this.it(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}null===(i=Ro)||void 0===i||i.lt(function(e,t,n,r,i,s,o,a,l,c){const u={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(u.bloomFilter={applied:0===i,hashCount:null!==(s=null===h||void 0===h?void 0:h.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(o=null===h||void 0===h||null===(a=h.bits)||void 0===a||null===(a=a.bitmap)||void 0===a?void 0:a.length)&&void 0!==o?o:0,padding:null!==(l=null===h||void 0===h||null===(c=h.bits)||void 0===c?void 0:c.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null===r||void 0===r?void 0:r.mightContain(e))&&void 0!==t&&t}}),u}(r,e.Ce,this.Ge.ht(),n,s))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=ni(n).toUint8Array()}catch(e){if(e instanceof Jr)return ln("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Lo(s,r,i)}catch(e){return ln(e instanceof Mo?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const i=this.Ge.ht(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((n,r)=>{const i=this.ot(r);if(i){if(n.current&&hs(i.target)){const t=new Fn(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,Fi.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=Vs();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const r=new jo(e,t,this.Ye,this.je,n);return this.je=Ps(),this.Je=Wo(),this.He=Wo(),this.Ye=new Hr(In),r}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new qo,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Qr(In),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Qr(In),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||on("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new qo),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Wo(){return new Hr(Fn.comparator)}function Ho(){return new Hr(Fn.comparator)}const Go={asc:"ASCENDING",desc:"DESCENDING"},Ko={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Qo={and:"AND",or:"OR"};class Yo{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Xo(e,t){return e.useProto3Json||dr(t)?t:{value:t}}function Jo(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function $o(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Zo(e,t){return Jo(e,t.toTimestamp())}function ea(e){return dn(!!e,49232),Jn.fromTimestamp(function(e){const t=ei(e);return new Xn(t.seconds,t.nanos)}(e))}function ta(e,t){return na(e,t).canonicalString()}function na(e,t){const n=function(e){return new Ln(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function ra(e){const t=Ln.fromString(e);return dn(Sa(t),10190,{key:t.toString()}),t}function ia(e,t){return ta(e.databaseId,t.path)}function sa(e,t){const n=ra(t);if(n.get(1)!==e.databaseId.projectId)throw new mn(pn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new mn(pn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Fn(ca(n))}function oa(e,t){return ta(e.databaseId,t)}function aa(e){const t=ra(e);return 4===t.length?Ln.emptyPath():ca(t)}function la(e){return new Ln(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ca(e){return dn(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ua(e,t,n){return{name:ia(e,t),fields:n.value.mapValue.fields}}function ha(e,t){let n;if(t instanceof mo)n={update:ua(e,t.key,t.value)};else if(t instanceof wo)n={delete:ia(e,t.key)};else if(t instanceof go)n={update:ua(e,t.key,t.data),updateMask:Ca(t.fieldMask)};else{if(!(t instanceof bo))return un(16599,{Vt:t.type});n={verify:ia(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Xs)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Js)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Zs)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof to)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw un(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Zo(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:un(27497)}(e,t.precondition)),n}function da(e,t){return{documents:[oa(e,t.path)]}}function fa(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=oa(e,i);const s=function(e){if(0!==e.length)return ba(Gi.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:_a(e.field),direction:ga(e.dir)}}(e))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Xo(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:i}}function pa(e){let t=aa(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){dn(1===r,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=ma(e);return t instanceof Gi&&Qi(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map(e=>function(e){return new qi(wa(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,dr(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new Ui(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new Ui(n,t)}(n.endAt)),fs(t,i,o,s,a,"F",l,c)}function ma(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=wa(e.unaryFilter.field);return Hi.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=wa(e.unaryFilter.field);return Hi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=wa(e.unaryFilter.field);return Hi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=wa(e.unaryFilter.field);return Hi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return un(61313);default:return un(60726)}}(e):void 0!==e.fieldFilter?function(e){return Hi.create(wa(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return un(58110);default:return un(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Gi.create(e.compositeFilter.filters.map(e=>ma(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return un(1026)}}(e.compositeFilter.op))}(e):un(30097,{filter:e})}function ga(e){return Go[e]}function ya(e){return Ko[e]}function va(e){return Qo[e]}function _a(e){return{fieldPath:e.canonicalString()}}function wa(e){return jn.fromServerFormat(e.fieldPath)}function ba(e){return e instanceof Hi?function(e){if("=="===e.op){if(Pi(e.value))return{unaryFilter:{field:_a(e.field),op:"IS_NAN"}};if(Ri(e.value))return{unaryFilter:{field:_a(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Pi(e.value))return{unaryFilter:{field:_a(e.field),op:"IS_NOT_NAN"}};if(Ri(e.value))return{unaryFilter:{field:_a(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_a(e.field),op:ya(e.op),value:e.value}}}(e):e instanceof Gi?function(e){const t=e.getFilters().map(e=>ba(e));return 1===t.length?t[0]:{compositeFilter:{op:va(e.op),filters:t}}}(e):un(54877,{filter:e})}function Ca(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Sa(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Ea{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Jn.min(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Jn.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:$r.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Ea(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ka{constructor(e){this.yt=e}}function Ta(e){const t=pa({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?bs(t,t.limit,"L"):t}class Ia{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ti(e.integerValue));else if("doubleValue"in e){const n=ti(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),fr(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=ei(n)),t.xt("".concat(n.seconds||"")),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ni(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?Li(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Di(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):un(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const r of Object.keys(n))this.Ot(r,t),this.Ct(n[r],t)}kt(e,t){var n;const r=e.fields||{};this.Ft(t,53);const i=yi,s=(null===(n=r[i].arrayValue)||void 0===n||null===(n=n.values)||void 0===n?void 0:n.length)||0;this.Ft(t,15),t.Mt(ti(s)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const r of n)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),Fn.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ia.Kt=new Ia;class xa{constructor(){this.Cn=new Na}addToCollectionParentIndex(e,t){return this.Cn.add(t),ar.resolve()}getCollectionParents(e,t){return ar.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ar.resolve()}deleteFieldIndex(e,t){return ar.resolve()}deleteAllFieldIndexes(e){return ar.resolve()}createTargetIndexes(e,t){return ar.resolve()}getDocumentsMatchingTarget(e,t){return ar.resolve(null)}getIndexType(e,t){return ar.resolve(0)}getFieldIndexes(e,t){return ar.resolve([])}getNextCollectionGroupToUpdate(e){return ar.resolve(null)}getMinOffset(e,t){return ar.resolve(nr.min())}getMinOffsetFromCollectionGroup(e,t){return ar.resolve(nr.min())}updateCollectionGroup(e,t,n){return ar.resolve()}updateIndexEntries(e,t){return ar.resolve()}}class Na{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Qr(Ln.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Qr(Ln.comparator)).toArray()}}new Uint8Array(0);const Ra={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pa=41943040;class Aa{static withCacheSize(e){return new Aa(e,Aa.DEFAULT_COLLECTION_PERCENTILE,Aa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Aa.DEFAULT_COLLECTION_PERCENTILE=10,Aa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Aa.DEFAULT=new Aa(Pa,Aa.DEFAULT_COLLECTION_PERCENTILE,Aa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Aa.DISABLED=new Aa(-1,0,0);class Da{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Da(0)}static cr(){return new Da(-1)}}const Oa="LruGarbageCollector",La=1048576;function Ma(e,t){let[n,r]=e,[i,s]=t;const o=In(n,i);return 0===o?In(r,s):o}class ja{constructor(e){this.Ir=e,this.buffer=new Qr(Ma),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ma(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Fa{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){on(Oa,"Garbage collection scheduled in ".concat(e,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){cr(e)?on(Oa,"Ignoring IndexedDB error during garbage collection: ",e):await or(e)}await this.Vr(3e5)})}}class Ua{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ar.resolve(ur.ce);const n=new ja(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(on("LruGarbageCollector","Garbage collection skipped; disabled"),ar.resolve(Ra)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(on("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),Ra):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,s,o,a,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(on("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),sn()<=ge.DEBUG&&on("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(s-c,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-s)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(a-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(l-a)+"ms\n"+"Total Duration: ".concat(l-c,"ms")),ar.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}function Va(e,t){return new Ua(e,t)}class za{constructor(){this.changes=new Ns(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Fi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ar.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class qa{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ba{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&ho(n.mutation,e,Xr.empty(),Xn.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Vs()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Vs();const r=Ls();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=Ds();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Ls();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Vs()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=Ps();const s=js(),o=js();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof go)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),ho(o.mutation,t,o.mutation.getFieldMask(),Xn.now())):s.set(t.key,Xr.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new qa(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=js();let r=new Hr((e,t)=>e-t),i=Vs();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Xr.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||Vs()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,l=r.value,c=Ms();l.forEach(e=>{if(!i.has(e)){const r=co(t.get(e),n.get(e));null!==r&&c.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,c))}return ar.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Fn.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gs(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ar.resolve(Ls());let o=$n,a=i;return s.next(t=>ar.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?ar.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,Vs())).next(e=>({batchId:o,changes:Os(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Fn(t)).next(e=>{let t=Ds();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=Ds();return this.indexManager.getCollectionParents(e,i).next(o=>ar.forEach(o,o=>{const a=function(e,t){return new ds(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Fi.newInvalidDocument(r)))});let n=Ds();return e.forEach((e,r)=>{const s=i.get(e);void 0!==s&&ho(s.mutation,r,Xr.empty(),Xn.now()),ks(t,r)&&(n=n.insert(e,r))}),n})}}class Wa{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ar.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:ea(e.createTime)}}(t)),ar.resolve()}getNamedQuery(e,t){return ar.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(e){return{name:e.name,query:Ta(e.bundledQuery),readTime:ea(e.readTime)}}(t)),ar.resolve()}}class Ha{constructor(){this.overlays=new Hr(Fn.comparator),this.qr=new Map}getOverlay(e,t){return ar.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ls();return ar.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),ar.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),ar.resolve()}getOverlaysForCollection(e,t,n){const r=Ls(),i=t.length+1,s=new Fn(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ar.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Hr((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Ls(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Ls(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return ar.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Eo(t,n));let i=this.qr.get(t);void 0===i&&(i=Vs(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class Ga{constructor(){this.sessionToken=$r.EMPTY_BYTE_STRING}getSessionToken(e){return ar.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ar.resolve()}}class Ka{constructor(){this.Qr=new Qr(Qa.$r),this.Ur=new Qr(Qa.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new Qa(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new Qa(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new Fn(new Ln([])),n=new Qa(t,e),r=new Qa(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Fn(new Ln([])),n=new Qa(t,e),r=new Qa(t,e+1);let i=Vs();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new Qa(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Qa{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Fn.comparator(e.key,t.key)||In(e.Yr,t.Yr)}static Kr(e,t){return In(e.Yr,t.Yr)||Fn.comparator(e.key,t.key)}}class Ya{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Qr(Qa.$r)}checkEmpty(e){return ar.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Co(i,t,n,r);this.mutationQueue.push(s);for(const o of r)this.Zr=this.Zr.add(new Qa(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return ar.resolve(s)}lookupMutationBatch(e,t){return ar.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),i=r<0?0:r;return ar.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ar.resolve(0===this.mutationQueue.length?hr:this.tr-1)}getAllMutationBatches(e){return ar.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Qa(t,0),r=new Qa(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,r],e=>{const t=this.Xr(e.Yr);i.push(t)}),ar.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Qr(In);return t.forEach(e=>{const t=new Qa(e,0),r=new Qa(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),ar.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Fn.isDocumentKey(i)||(i=i.child(""));const s=new Qa(new Fn(i),0);let o=new Qr(In);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)},s),ar.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){dn(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return ar.forEach(t.mutations,r=>{const i=new Qa(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new Qa(t,0),r=this.Zr.firstAfterOrEqual(n);return ar.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ar.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Xa{constructor(e){this.ri=e,this.docs=new Hr(Fn.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ar.resolve(n?n.document.mutableCopy():Fi.newInvalidDocument(t))}getEntries(e,t){let n=Ps();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Fi.newInvalidDocument(e))}),ar.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Ps();const s=t.path,o=new Fn(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||rr(tr(o),n)<=0||(r.has(o.key)||ks(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return ar.resolve(i)}getAllFromCollectionGroup(e,t,n,r){un(9500)}ii(e,t){return ar.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Ja(this)}getSize(e){return ar.resolve(this.size)}}class Ja extends za{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),ar.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class $a{constructor(e){this.persistence=e,this.si=new Ns(e=>cs(e),us),this.lastRemoteSnapshotVersion=Jn.min(),this.highestTargetId=0,this.oi=0,this._i=new Ka,this.targetCount=0,this.ai=Da.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),ar.resolve()}getLastRemoteSnapshotVersion(e){return ar.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ar.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ar.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),ar.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Da(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ar.resolve()}updateTargetData(e,t){return this.Pr(t),ar.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ar.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),ar.waitFor(i).next(()=>r)}getTargetCount(e){return ar.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return ar.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),ar.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),ar.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ar.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return ar.resolve(n)}containsKey(e,t){return ar.resolve(this._i.containsKey(t))}}class Za{constructor(e,t){this.ui={},this.overlays={},this.ci=new ur(0),this.li=!1,this.li=!0,this.hi=new Ga,this.referenceDelegate=e(this),this.Pi=new $a(this),this.indexManager=new xa,this.remoteDocumentCache=function(e){return new Xa(e)}(e=>this.referenceDelegate.Ti(e)),this.serializer=new ka(t),this.Ii=new Wa(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ha,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new Ya(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){on("MemoryPersistence","Starting transaction:",e);const r=new el(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return ar.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class el extends sr{constructor(e){super(),this.currentSequenceNumber=e}}class tl{constructor(e){this.persistence=e,this.Ri=new Ka,this.Vi=null}static mi(e){return new tl(e)}get fi(){if(this.Vi)return this.Vi;throw un(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),ar.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),ar.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ar.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ar.forEach(this.fi,n=>{const r=Fn.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,Jn.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return ar.or([()=>ar.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class nl{constructor(e,t){this.persistence=e,this.pi=new Ns(e=>gr(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=Va(this,t)}static mi(e,t){return new nl(e,t)}Ei(){}di(e){return ar.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return ar.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?ar.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,Jn.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ar.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ar.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ar.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ar.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ti(e.data.value)),t}br(e,t,n){return ar.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return ar.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class rl{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=Vs(),r=Vs();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new rl(e,t.fromCache,n,r)}}class il{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sl{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=q()?8:lr(j())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new il;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(sn()<=ge.DEBUG&&on("QueryEngine","SDK will not create cache indexes for query:",Es(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ar.resolve()):(sn()<=ge.DEBUG&&on("QueryEngine","Query:",Es(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(sn()<=ge.DEBUG&&on("QueryEngine","The SDK decides to create cache indexes for query:",Es(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,vs(t))):ar.resolve())}ys(e,t){if(ms(t))return ar.resolve(null);let n=vs(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=bs(t,null,"F"),n=vs(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=Vs(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,bs(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,r){return ms(t)||r.isEqual(Jn.min())?ar.resolve(null):this.ps.getDocuments(e,n).next(i=>{const s=this.Ds(t,i);return this.Cs(t,s,n,r)?ar.resolve(null):(sn()<=ge.DEBUG&&on("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Es(t)),this.vs(e,s,t,er(r,$n)).next(e=>e))})}Ds(e,t){let n=new Qr(Is(e));return t.forEach((t,r)=>{ks(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return sn()<=ge.DEBUG&&on("QueryEngine","Using full collection scan to execute query:",Es(t)),this.ps.getDocumentsMatchingQuery(e,t,nr.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const ol="LocalStore";class al{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new Hr(In),this.xs=new Ns(e=>cs(e),us),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ba(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function ll(e,t,n,r){return new al(e,t,n,r)}async function cl(e,t){const n=fn(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let o=Vs();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function ul(e){const t=fn(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function hl(e,t,n){let r=Vs(),i=Vs();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=Ps();return n.forEach((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Jn.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):on(ol,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{ks:r,qs:i}})}function dl(e,t){const n=fn(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=hr),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function fl(e,t){const n=fn(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Pi.getTargetData(e,t).next(i=>i?(r=i,ar.resolve(r)):n.Pi.allocateTargetId(e).next(i=>(r=new Ea(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}async function pl(e,t,n){const r=fn(e),i=r.Ms.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!cr(e))throw e;on(ol,"Failed to update sequence numbers for target ".concat(t,": ").concat(e))}r.Ms=r.Ms.remove(t),r.xs.delete(i.target)}function ml(e,t,n){const r=fn(e);let i=Jn.min(),s=Vs();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=fn(e),i=r.xs.get(n);return void 0!==i?ar.resolve(r.Ms.get(i)):r.Pi.getTargetData(t,n)}(r,e,vs(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.Fs.getDocumentsMatchingQuery(e,t,n?i:Jn.min(),n?s:Vs())).next(e=>(gl(r,Ts(t),e),{documents:e,Qs:s})))}function gl(e,t,n){let r=e.Os.get(t)||Jn.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}class yl{constructor(){this.activeTargetIds=qs()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vl{constructor(){this.Mo=new yl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new yl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class _l{Oo(e){}shutdown(){}}const wl="ConnectivityMonitor";class bl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){on(wl,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){on(wl,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Cl=null;function Sl(){return null===Cl?Cl=268435456+Math.round(2147483648*Math.random()):Cl++,"0x"+Cl.toString(16)}const El="RestConnection",kl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Tl{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko="projects/".concat(n,"/databases/").concat(r),this.Wo=this.databaseId.database===hi?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}Go(e,t,n,r,i){const s=Sl(),o=this.zo(e,t.toUriEncodedString());on(El,"Sending RPC '".concat(e,"' ").concat(s,":"),o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,i);const{host:l}=new URL(o),c=P(l);return this.Jo(e,o,a,n,c).then(t=>(on(El,"Received RPC '".concat(e,"' ").concat(s,": "),t),t),t=>{throw ln(El,"RPC '".concat(e,"' ").concat(s," failed with error: "),t,"url: ",o,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+nn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=kl[e];return"".concat(this.Uo,"/v1/").concat(t,":").concat(n)}terminate(){}}class Il{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const xl="WebChannelConnection";class Nl extends Tl{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){const s=Sl();return new Promise((i,o)=>{const a=new Bt;a.setWithCredentials(!0),a.listenOnce(Ht.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Gt.NO_ERROR:const n=a.getResponseJson();on(xl,"XHR for RPC '".concat(e,"' ").concat(s," received:"),JSON.stringify(n)),i(n);break;case Gt.TIMEOUT:on(xl,"RPC '".concat(e,"' ").concat(s," timed out")),o(new mn(pn.DEADLINE_EXCEEDED,"Request time out"));break;case Gt.HTTP_ERROR:const r=a.getStatus();if(on(xl,"RPC '".concat(e,"' ").concat(s," failed with status:"),r,"response text:",a.getResponseText()),r>0){var t;let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const n=null===(t=e)||void 0===t?void 0:t.error;if(n&&n.status&&n.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(pn).indexOf(t)>=0?t:pn.UNKNOWN}(n.status);o(new mn(e,n.message))}else o(new mn(pn.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new mn(pn.UNAVAILABLE,"Connection failed."));break;default:un(9055,{l_:e,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{on(xl,"RPC '".concat(e,"' ").concat(s," completed."))}});const l=JSON.stringify(r);on(xl,"RPC '".concat(e,"' ").concat(s," sending request:"),r),a.send(t,"POST",l,n,15)})}T_(e,t,n){const r=Sl(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Xt(),o=Yt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=i.join("");on(xl,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(c),a);const u=s.createWebChannel(c,a);this.I_(u);let h=!1,d=!1;const f=new Il({Yo:t=>{d?on(xl,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(h||(on(xl,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),u.open(),h=!0),on(xl,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),u.send(t))},Zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,Wt.EventType.OPEN,()=>{d||(on(xl,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),f.o_())}),p(u,Wt.EventType.CLOSE,()=>{d||(d=!0,on(xl,"RPC '".concat(e,"' stream ").concat(r," transport closed")),f.a_(),this.E_(u))}),p(u,Wt.EventType.ERROR,t=>{d||(d=!0,ln(xl,"RPC '".concat(e,"' stream ").concat(r," transport errored. Name:"),t.name,"Message:",t.message),f.a_(new mn(pn.UNAVAILABLE,"The operation could not be completed")))}),p(u,Wt.EventType.MESSAGE,t=>{if(!d){var n;const i=t.data[0];dn(!!i,16349);const s=i,o=(null===s||void 0===s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){on(xl,"RPC '".concat(e,"' stream ").concat(r," received error:"),o);const t=o.status;let n=function(e){const t=To[e];if(void 0!==t)return No(t)}(t),i=o.message;void 0===n&&(n=pn.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.a_(new mn(n,i)),u.close()}else on(xl,"RPC '".concat(e,"' stream ").concat(r," received:"),i),f.u_(i)}}),p(o,Qt.STAT_EVENT,t=>{t.stat===Kt.PROXY?on(xl,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===Kt.NOPROXY&&on(xl,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function Rl(){return"undefined"!=typeof document?document:null}function Pl(e){return new Yo(e,!0)}class Al{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&on("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Dl="PersistentStream";class Ol{constructor(e,t,n,r,i,s,o,a){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Al(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===pn.RESOURCE_EXHAUSTED?(an(t.toString()),an("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===pn.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,r]=e;this.D_===t&&this.G_(n,r)},t=>{e(()=>{const e=new mn(pn.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return on(Dl,"close with error: ".concat(e)),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(on(Dl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ll extends Ol{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:un(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(dn(void 0===t||"string"==typeof t,58123),$r.fromBase64String(t||"")):(dn(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),$r.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?pn.UNKNOWN:No(e.code);return new mn(t,e.message||"")}(o);n=new zo(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=sa(e,r.document.name),s=ea(r.document.updateTime),o=r.document.createTime?ea(r.document.createTime):Jn.min(),a=new Mi({mapValue:{fields:r.document.fields}}),l=Fi.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Uo(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=sa(e,r.document),s=r.readTime?ea(r.readTime):Jn.min(),o=Fi.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Uo([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=sa(e,r.document),s=r.removedTargetIds||[];n=new Uo([],s,i,null)}else{if(!("filter"in t))return un(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new ko(r,i),o=e.targetId;n=new Vo(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Jn.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Jn.min():t.readTime?ea(t.readTime):Jn.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=la(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=hs(r)?{documents:da(e,r)}:{query:fa(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=$o(e,t.resumeToken);const r=Xo(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Jn.min())>0){n.readTime=Jo(e,t.snapshotVersion.toTimestamp());const r=Xo(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return un(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=la(this.serializer),t.removeTarget=e,this.q_(t)}}class Ml extends Ol{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return dn(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,dn(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){dn(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(dn(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?ea(e.updateTime):ea(t);return n.isEqual(Jn.min())&&(n=ea(t)),new so(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=ea(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=la(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>ha(this.serializer,e))};this.q_(t)}}class jl{}class Fl extends jl{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new mn(pn.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[s,o]=i;return this.connection.Go(e,na(t,n),r,s,o)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===pn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new mn(pn.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[o,a]=s;return this.connection.Ho(e,na(t,n),r,o,a,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===pn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new mn(pn.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Ul{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(an(t),this.aa=!1):on("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const Vl="RemoteStore";class zl{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{Xl(this)&&(on(Vl,"Restarting streams for network reachability change."),await async function(e){const t=fn(e);t.Ea.add(4),await Bl(t),t.Ra.set("Unknown"),t.Ea.delete(4),await ql(t)}(this))})}),this.Ra=new Ul(n,r)}}async function ql(e){if(Xl(e))for(const t of e.da)await t(!0)}async function Bl(e){for(const t of e.da)await t(!1)}function Wl(e,t){const n=fn(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),Yl(n)?Ql(n):mc(n).O_()&&Gl(n,t))}function Hl(e,t){const n=fn(e),r=mc(n);n.Ia.delete(t),r.O_()&&Kl(n,t),0===n.Ia.size&&(r.O_()?r.L_():Xl(n)&&n.Ra.set("Unknown"))}function Gl(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Jn.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}mc(e).Y_(t)}function Kl(e,t){e.Va.Ue(t),mc(e).Z_(t)}function Ql(e){e.Va=new Bo({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),mc(e).start(),e.Ra.ua()}function Yl(e){return Xl(e)&&!mc(e).x_()&&e.Ia.size>0}function Xl(e){return 0===fn(e).Ea.size}function Jl(e){e.Va=void 0}async function $l(e){e.Ra.set("Online")}async function Zl(e){e.Ia.forEach((t,n)=>{Gl(e,t)})}async function ec(e,t){Jl(e),Yl(e)?(e.Ra.ha(t),Ql(e)):e.Ra.set("Unknown")}async function tc(e,t,n){if(e.Ra.set("Online"),t instanceof zo&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){on(Vl,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await nc(e,n)}else if(t instanceof Uo?e.Va.Ze(t):t instanceof Vo?e.Va.st(t):e.Va.tt(t),!n.isEqual(Jn.min()))try{const t=await ul(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken($r.EMPTY_BYTE_STRING,r.snapshotVersion)),Kl(e,t);const i=new Ea(r.target,t,n,r.sequenceNumber);Gl(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){on(Vl,"Failed to raise snapshot:",t),await nc(e,t)}}async function nc(e,t,n){if(!cr(t))throw t;e.Ea.add(1),await Bl(e),e.Ra.set("Offline"),n||(n=()=>ul(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{on(Vl,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await ql(e)})}function rc(e,t){return t().catch(n=>nc(e,n,t))}async function ic(e){const t=fn(e),n=gc(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:hr;for(;sc(t);)try{const e=await dl(t.localStore,r);if(null===e){0===t.Ta.length&&n.L_();break}r=e.batchId,oc(t,e)}catch(e){await nc(t,e)}ac(t)&&lc(t)}function sc(e){return Xl(e)&&e.Ta.length<10}function oc(e,t){e.Ta.push(t);const n=gc(e);n.O_()&&n.X_&&n.ea(t.mutations)}function ac(e){return Xl(e)&&!gc(e).x_()&&e.Ta.length>0}function lc(e){gc(e).start()}async function cc(e){gc(e).ra()}async function uc(e){const t=gc(e);for(const n of e.Ta)t.ea(n.mutations)}async function hc(e,t,n){const r=e.Ta.shift(),i=So.from(r,t,n);await rc(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await ic(e)}async function dc(e,t){t&&gc(e).X_&&await async function(e,t){if(function(e){return xo(e)&&e!==pn.ABORTED}(t.code)){const n=e.Ta.shift();gc(e).B_(),await rc(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await ic(e)}}(e,t),ac(e)&&lc(e)}async function fc(e,t){const n=fn(e);n.asyncQueue.verifyOperationInProgress(),on(Vl,"RemoteStore received new credentials");const r=Xl(n);n.Ea.add(3),await Bl(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await ql(n)}async function pc(e,t){const n=fn(e);t?(n.Ea.delete(2),await ql(n)):t||(n.Ea.add(2),await Bl(n),n.Ra.set("Unknown"))}function mc(e){return e.ma||(e.ma=function(e,t,n){const r=fn(e);return r.sa(),new Ll(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:$l.bind(null,e),t_:Zl.bind(null,e),r_:ec.bind(null,e),H_:tc.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),Yl(e)?Ql(e):e.Ra.set("Unknown")):(await e.ma.stop(),Jl(e))})),e.ma}function gc(e){return e.fa||(e.fa=function(e,t,n){const r=fn(e);return r.sa(),new Ml(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:cc.bind(null,e),r_:dc.bind(null,e),ta:uc.bind(null,e),na:hc.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await ic(e)):(await e.fa.stop(),e.Ta.length>0&&(on(Vl,"Stopping write stream with ".concat(e.Ta.length," pending writes")),e.Ta=[]))})),e.fa}class yc{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new gn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new yc(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new mn(pn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vc(e,t){if(an("AsyncQueue","".concat(t,": ").concat(e)),cr(e))return new mn(pn.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class _c{static emptySet(e){return new _c(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Fn.comparator(t.key,n.key):(e,t)=>Fn.comparator(e.key,t.key),this.keyedMap=Ds(),this.sortedSet=new Hr(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof _c))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new _c;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class wc{constructor(){this.ga=new Hr(Fn.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):un(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class bc{constructor(e,t,n,r,i,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new bc(e,t,_c.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Cs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Cc{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Sc{constructor(){this.queries=Ec(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=fn(e),r=n.queries;n.queries=Ec(),r.forEach((e,n)=>{for(const r of n.Sa)r.onError(t)})}(this,new mn(pn.ABORTED,"Firestore shutting down"))}}function Ec(){return new Ns(e=>Ss(e),Cs)}async function kc(e,t){const n=fn(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.ba()&&t.Da()&&(r=2):(s=new Cc,r=t.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=vc(e,"Initialization of query '".concat(Es(t.query),"' failed"));return void t.onError(n)}n.queries.set(i,s),s.Sa.push(t),t.va(n.onlineState),s.wa&&t.Fa(s.wa)&&Nc(n)}async function Tc(e,t){const n=fn(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.Sa.indexOf(t);e>=0&&(s.Sa.splice(e,1),0===s.Sa.length?i=t.Da()?0:1:!s.ba()&&t.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Ic(e,t){const n=fn(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(i)&&(r=!0);t.wa=i}}r&&Nc(n)}function xc(e,t,n){const r=fn(e),i=r.queries.get(t);if(i)for(const s of i.Sa)s.onError(n);r.queries.delete(t)}function Nc(e){e.Ca.forEach(e=>{e.next()})}var Rc,Pc;(Pc=Rc||(Rc={})).Ma="default",Pc.Cache="cache";class Ac{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new bc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=bc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Rc.Cache}}class Dc{constructor(e){this.key=e}}class Oc{constructor(e){this.key=e}}class Lc{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Vs(),this.mutatedKeys=Vs(),this.eu=Is(e),this.tu=new _c(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new wc,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),u=ks(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),f=!0):this.su(c,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||l&&this.eu(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const s=e.iu.ya();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return un(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),r=null!==r&&void 0!==r&&r;const o=t&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,l=a!==this.Za;return this.Za=a,0!==s.length||l?{snapshot:new bc(this.query,e.tu,i,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new wc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Vs(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Oc(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new Dc(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=Vs();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return bc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Mc="SyncEngine";class jc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Fc{constructor(e){this.key=e,this.hu=!1}}class Uc{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new Ns(e=>Ss(e),Cs),this.Iu=new Map,this.Eu=new Set,this.du=new Hr(Fn.comparator),this.Au=new Map,this.Ru=new Ka,this.Vu={},this.mu=new Map,this.fu=Da.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function Vc(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=au(e);let i;const s=r.Tu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await qc(r,t,n,!0),i}async function zc(e,t){const n=au(e);await qc(n,t,!0,!1)}async function qc(e,t,n,r){const i=await fl(e.localStore,vs(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await Bc(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&Wl(e.remoteStore,i),a}async function Bc(e,t,n,r,i){e.pu=(t,n,r)=>async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await ml(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ru(n,i)}));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return tu(e,t.targetId,a.au),a.snapshot}(e,t,n,r);const s=await ml(e.localStore,t,!0),o=new Lc(t,s.Qs),a=o.ru(s.documents),l=Fo.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),c=o.applyChanges(a,e.isPrimaryClient,l);tu(e,n,c.au);const u=new jc(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),c.snapshot}async function Wc(e,t,n){const r=fn(e),i=r.Tu.get(t),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(e=>!Cs(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await pl(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Hl(r.remoteStore,i.targetId),Zc(r,i.targetId)}).catch(or)):(Zc(r,i.targetId),await pl(r.localStore,i.targetId,!0))}async function Hc(e,t){const n=fn(e),r=n.Tu.get(t),i=n.Iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Hl(n.remoteStore,r.targetId))}async function Gc(e,t){const n=fn(e);try{const e=await function(e,t){const n=fn(e),r=t.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const o=[];t.targetChanges.forEach((s,a)=>{const l=i.get(a);if(!l)return;o.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,a)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken($r.EMPTY_BYTE_STRING,Jn.min()).withLastLimboFreeSnapshotVersion(Jn.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,r)),i=i.insert(a,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(l,c,s)&&o.push(n.Pi.updateTargetData(e,c))});let a=Ps(),l=Vs();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),o.push(hl(e,s,t.documentUpdates).next(e=>{a=e.ks,l=e.qs})),!r.isEqual(Jn.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));o.push(t)}return ar.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,l)).next(()=>a)}).then(e=>(n.Ms=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Au.get(t);r&&(dn(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?dn(r.hu,14607):e.removedDocuments.size>0&&(dn(r.hu,42227),r.hu=!1))}),await iu(n,e,t)}catch(e){await or(e)}}function Kc(e,t,n){const r=fn(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach((n,r)=>{const i=r.view.va(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=fn(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.Sa)i.va(t)&&(r=!0)}),r&&Nc(n)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Qc(e,t,n){const r=fn(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Au.get(t),s=i&&i.key;if(s){let e=new Hr(Fn.comparator);e=e.insert(s,Fi.newNoDocument(s,Jn.min()));const n=Vs().add(s),i=new jo(Jn.min(),new Map,new Hr(In),e,n);await Gc(r,i),r.du=r.du.remove(s),r.Au.delete(t),ru(r)}else await pl(r.localStore,t,!1).then(()=>Zc(r,t,n)).catch(or)}async function Yc(e,t){const n=fn(e),r=t.batch.batchId;try{const e=await function(e,t){const n=fn(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=ar.resolve();return s.forEach(e=>{o=o.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);dn(null!==s,48541),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Vs();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);$c(n,r,null),Jc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await iu(n,e)}catch(e){await or(e)}}async function Xc(e,t,n){const r=fn(e);try{const e=await function(e,t){const n=fn(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(dn(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);$c(r,t,n),Jc(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await iu(r,e)}catch(n){await or(n)}}function Jc(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function $c(e,t,n){const r=fn(e);let i=r.Vu[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Vu[r.currentUser.toKey()]=i}}function Zc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||eu(e,t)})}function eu(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(Hl(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),ru(e))}function tu(e,t,n){for(const r of n)r instanceof Dc?(e.Ru.addReference(r.key,t),nu(e,r)):r instanceof Oc?(on(Mc,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||eu(e,r.key)):un(19791,{wu:r})}function nu(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(on(Mc,"New document in limbo: "+n),e.Eu.add(r),ru(e))}function ru(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new Fn(Ln.fromString(t)),r=e.fu.next();e.Au.set(r,new Fc(n)),e.du=e.du.insert(n,r),Wl(e.remoteStore,new Ea(vs(ps(n.path)),r,"TargetPurposeLimboResolution",ur.ce))}}async function iu(e,t,n){const r=fn(e),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((e,a)=>{o.push(r.pu(a,t,n).then(e=>{if((e||n)&&r.isPrimaryClient){var t;const i=e?!e.fromCache:null===n||void 0===n||null===(t=n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=rl.As(a.targetId,e);s.push(t)}}))}),await Promise.all(o),r.Pu.H_(i),await async function(e,t){const n=fn(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>ar.forEach(t,t=>ar.forEach(t.Es,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>ar.forEach(t.ds,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!cr(e))throw e;on(ol,"Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ms.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(e,i)}}}(r.localStore,s))}async function su(e,t){const n=fn(e);if(!n.currentUser.isEqual(t)){on(Mc,"User change. New user:",t.toKey());const e=await cl(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new mn(pn.CANCELLED,t))})}),e.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await iu(n,e.Ls)}}function ou(e,t){const n=fn(e),r=n.Au.get(t);if(r&&r.hu)return Vs().add(r.key);{let e=Vs();const r=n.Iu.get(t);if(!r)return e;for(const t of r){const r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function au(e){const t=fn(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Gc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ou.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Qc.bind(null,t),t.Pu.H_=Ic.bind(null,t.eventManager),t.Pu.yu=xc.bind(null,t.eventManager),t}function lu(e){const t=fn(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Yc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Xc.bind(null,t),t}class cu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Pl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return ll(this.persistence,new sl,e.initialUser,this.serializer)}Cu(e){return new Za(tl.mi,this.serializer)}Du(e){return new vl}async terminate(){var e,t;null!==(e=this.gcScheduler)&&void 0!==e&&e.stop(),null!==(t=this.indexBackfillerScheduler)&&void 0!==t&&t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cu.provider={build:()=>new cu};class uu extends cu{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){dn(this.persistence.referenceDelegate instanceof nl,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Fa(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Aa.withCacheSize(this.cacheSizeBytes):Aa.DEFAULT;return new Za(e=>nl.mi(e,t),this.serializer)}}class hu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Kc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=su.bind(null,this.syncEngine),await pc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Sc}createDatastore(e){const t=Pl(e.databaseInfo.databaseId),n=function(e){return new Nl(e)}(e.databaseInfo);return function(e,t,n,r){return new Fl(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new zl(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e=>Kc(this.syncEngine,e,0),bl.v()?new bl:new _l)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Uc(e,t,n,r,i,s);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=fn(e);on(Vl,"RemoteStore shutting down."),t.Ea.add(5),await Bl(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),null!==(e=this.datastore)&&void 0!==e&&e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}hu.provider={build:()=>new hu};class du{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):an("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const fu="FirestoreClient";class pu{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=tn.UNAUTHENTICATED,this.clientId=Tn.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{on(fu,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(on(fu,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new gn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=vc(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function mu(e,t){e.asyncQueue.verifyOperationInProgress(),on(fu,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await cl(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gu(e,t){e.asyncQueue.verifyOperationInProgress();const n=await yu(e);on(fu,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>fc(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>fc(t.remoteStore,n)),e._onlineComponents=t}async function yu(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){on(fu,"Using user provided OfflineComponentProvider");try{await mu(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===pn.FAILED_PRECONDITION||e.code===pn.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;ln("Error using user provided cache. Falling back to memory cache: "+n),await mu(e,new cu)}}else on(fu,"Using default OfflineComponentProvider"),await mu(e,new uu(void 0));return e._offlineComponents}async function vu(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(on(fu,"Using user provided OnlineComponentProvider"),await gu(e,e._uninitializedComponentsProvider._online)):(on(fu,"Using default OnlineComponentProvider"),await gu(e,new hu))),e._onlineComponents}function _u(e){return vu(e).then(e=>e.syncEngine)}async function wu(e){const t=await vu(e),n=t.eventManager;return n.onListen=Vc.bind(null,t.syncEngine),n.onUnlisten=Wc.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=zc.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Hc.bind(null,t.syncEngine),n}function bu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new gn;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new du({next:a=>{s.Nu(),t.enqueueAndForget(()=>Tc(e,o));const l=a.docs.has(n);!l&&a.fromCache?i.reject(new mn(pn.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&"server"===r.source?i.reject(new mn(pn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new Ac(ps(n.path),s,{includeMetadataChanges:!0,qa:!0});return kc(e,o)}(await wu(e),e.asyncQueue,t,n,r)),r.promise}function Cu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new gn;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new du({next:n=>{s.Nu(),t.enqueueAndForget(()=>Tc(e,o)),n.fromCache&&"server"===r.source?i.reject(new mn(pn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Ac(n,s,{includeMetadataChanges:!0,qa:!0});return kc(e,o)}(await wu(e),e.asyncQueue,t,n,r)),r.promise}function Su(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Eu=new Map,ku="firestore.googleapis.com",Tu=!0;class Iu{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new mn(pn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ku,this.ssl=Tu}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Tu;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Pa;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<La)throw new mn(pn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new mn(pn.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Su(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new mn(pn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new mn(pn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new mn(pn.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class xu{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Iu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new mn(pn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new mn(pn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Iu(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new vn;switch(e.type){case"firstParty":return new Cn(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new mn(pn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Eu.get(e);t&&(on("ComponentProvider","Removing Datastore"),Eu.delete(e),t.terminate())}(this),Promise.resolve()}}class Nu{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Nu(this.firestore,e,this._query)}}class Ru{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ru(this.firestore,e,this._key)}toJSON(){return{type:Ru._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Kn(t,Ru._jsonSchema))return new Ru(e,n||null,new Fn(Ln.fromString(t.referencePath)))}}Ru._jsonSchemaVersion="firestore/documentReference/1.0",Ru._jsonSchema={type:Gn("string",Ru._jsonSchemaVersion),referencePath:Gn("string")};class Pu extends Nu{constructor(e,t,n){super(e,t,ps(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ru(this.firestore,null,new Fn(e))}withConverter(e){return new Pu(this.firestore,e,this._path)}}function Au(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=ue(e),Un("collection","path",t),e instanceof xu){const n=Ln.fromString(t,...r);return zn(n),new Pu(e,null,n)}{if(!(e instanceof Ru||e instanceof Pu))throw new mn(pn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Ln.fromString(t,...r));return zn(n),new Pu(e.firestore,null,n)}}function Du(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=ue(e),1===arguments.length&&(t=Tn.newId()),Un("doc","path",t),e instanceof xu){const n=Ln.fromString(t,...r);return Vn(n),new Ru(e,null,new Fn(n))}{if(!(e instanceof Ru||e instanceof Pu))throw new mn(pn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Ln.fromString(t,...r));return Vn(n),new Ru(e.firestore,e instanceof Pu?e.converter:null,new Fn(n))}}const Ou="AsyncQueue";class Lu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Al(this,"async_queue_retry"),this._c=()=>{const e=Rl();e&&on(Ou,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Rl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Rl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new gn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!cr(e))throw e;on(Ou,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,an("INTERNAL UNHANDLED ERROR: ",Mu(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=yc.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&un(47125,{Pc:Mu(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Mu(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function ju(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class Fu extends xu{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Lu,this._persistenceKey=(null===r||void 0===r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Lu(e),this._firestoreClient=void 0,await e}}}function Uu(e){if(e._terminated)throw new mn(pn.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Vu(e),e._firestoreClient}function Vu(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new ui(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Su(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||null!==(n=i.localCache)&&void 0!==n&&n._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new pu(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null===e||void 0===e?void 0:e._online.build();return{_offline:null===e||void 0===e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class zu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new zu($r.fromBase64String(e))}catch(e){throw new mn(pn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new zu($r.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:zu._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Kn(e,zu._jsonSchema))return zu.fromBase64String(e.bytes)}}zu._jsonSchemaVersion="firestore/bytes/1.0",zu._jsonSchema={type:Gn("string",zu._jsonSchemaVersion),bytes:Gn("string")};class qu{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new mn(pn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new jn(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Bu{constructor(e){this._methodName=e}}class Wu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new mn(pn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new mn(pn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return In(this._lat,e._lat)||In(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Wu._jsonSchemaVersion}}static fromJSON(e){if(Kn(e,Wu._jsonSchema))return new Wu(e.latitude,e.longitude)}}Wu._jsonSchemaVersion="firestore/geoPoint/1.0",Wu._jsonSchema={type:Gn("string",Wu._jsonSchemaVersion),latitude:Gn("number"),longitude:Gn("number")};class Hu{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Hu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Kn(e,Hu._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Hu(e.vectorValues);throw new mn(pn.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Hu._jsonSchemaVersion="firestore/vectorValue/1.0",Hu._jsonSchema={type:Gn("string",Hu._jsonSchemaVersion),vectorValues:Gn("object")};const Gu=/^__.*__$/;class Ku{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new go(e,this.data,this.fieldMask,t,this.fieldTransforms):new mo(e,this.data,t,this.fieldTransforms)}}class Qu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new go(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Yu(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw un(40011,{Ac:e})}}class Xu{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Xu(c(c({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return mh(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Yu(this.Ac)&&Gu.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Ju{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Pl(e)}Cc(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Xu({Ac:e,methodName:t,Dc:n,path:jn.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function $u(e){const t=e._freezeSettings(),n=Pl(e._databaseId);return new Ju(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Zu(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=e.Cc(s.merge||s.mergeFields?2:0,t,n,i);hh("Data must be an object, but it was:",o,r);const a=ch(r,o);let l,c;if(s.merge)l=new Xr(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=dh(t,r,n);if(!o.contains(i))throw new mn(pn.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));gh(e,i)||e.push(i)}l=new Xr(e),c=o.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=o.fieldTransforms;return new Ku(new Mi(a),l,c)}class eh extends Bu{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Sc("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof eh}}function th(e,t,n){return new Xu({Ac:3,Dc:t.settings.Dc,methodName:e._methodName,fc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class nh extends Bu{_toFieldTransform(e){return new io(e.path,new Xs)}isEqual(e){return e instanceof nh}}class rh extends Bu{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=th(this,e,!0),n=this.vc.map(e=>lh(e,t)),r=new Js(n);return new io(e.path,r)}isEqual(e){return e instanceof rh&&ee(this.vc,e.vc)}}class ih extends Bu{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=th(this,e,!0),n=this.vc.map(e=>lh(e,t)),r=new Zs(n);return new io(e.path,r)}isEqual(e){return e instanceof ih&&ee(this.vc,e.vc)}}function sh(e,t,n,r){const i=e.Cc(1,t,n);hh("Data must be an object, but it was:",i,r);const s=[],o=Mi.empty();Br(r,(e,r)=>{const a=ph(t,e,n);r=ue(r);const l=i.yc(a);if(r instanceof eh)s.push(a);else{const e=lh(r,l);null!=e&&(s.push(a),o.set(a,e))}});const a=new Xr(s);return new Qu(o,a,i.fieldTransforms)}function oh(e,t,n,r,i,s){const o=e.Cc(1,t,n),a=[dh(t,r,n)],l=[i];if(s.length%2!=0)throw new mn(pn.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let d=0;d<s.length;d+=2)a.push(dh(t,s[d])),l.push(s[d+1]);const c=[],u=Mi.empty();for(let d=a.length-1;d>=0;--d)if(!gh(c,a[d])){const e=a[d];let t=l[d];t=ue(t);const n=o.yc(e);if(t instanceof eh)c.push(e);else{const r=lh(t,n);null!=r&&(c.push(e),u.set(e,r))}}const h=new Xr(c);return new Qu(u,h,o.fieldTransforms)}function ah(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return lh(n,e.Cc(r?4:3,t))}function lh(e,t){if(uh(e=ue(e)))return hh("Unsupported field value:",t,e),ch(e,t);if(e instanceof Bu)return function(e,t){if(!Yu(t.Ac))throw t.Sc("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Sc("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=lh(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=ue(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Hs(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Xn.fromDate(e);return{timestampValue:Jo(t.serializer,n)}}if(e instanceof Xn){const n=new Xn(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Jo(t.serializer,n)}}if(e instanceof Wu)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof zu)return{bytesValue:$o(t.serializer,e._byteString)};if(e instanceof Ru){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:ta(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Hu)return function(e,t){return{mapValue:{fields:{[fi]:{stringValue:gi},[yi]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return Bs(t.serializer,e)})}}}}}}(e,t);throw t.Sc("Unsupported field value: ".concat(Bn(e)))}(e,t)}function ch(e,t){const n={};return Wr(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Br(e,(e,r)=>{const i=lh(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function uh(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Xn||e instanceof Wu||e instanceof zu||e instanceof Ru||e instanceof Bu||e instanceof Hu)}function hh(e,t,n){if(!uh(n)||!qn(n)){const r=Bn(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function dh(e,t,n){if((t=ue(t))instanceof qu)return t._internalPath;if("string"==typeof t)return ph(e,t);throw mh("Field path arguments must be of type string or ",e,!1,void 0,n)}const fh=new RegExp("[~\\*/\\[\\]]");function ph(e,t,n){if(t.search(fh)>=0)throw mh("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new qu(...t.split("."))._internalPath}catch(r){throw mh("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function mh(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a="Function ".concat(t,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=" in field ".concat(r)),o&&(l+=" in document ".concat(i)),l+=")"),new mn(pn.INVALID_ARGUMENT,a+e+l)}function gh(e,t){return e.some(e=>e.isEqual(t))}class yh{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ru(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new vh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(_h("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class vh extends yh{data(){return super.data()}}function _h(e,t){return"string"==typeof t?ph(e,t):t instanceof qu?t._internalPath:t._delegate._internalPath}function wh(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new mn(pn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class bh{}class Ch extends bh{}function Sh(e,t){let n=[];for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];t instanceof bh&&n.push(t),n=n.concat(i),function(e){const t=e.filter(e=>e instanceof Th).length,n=e.filter(e=>e instanceof Eh).length;if(t>1||t>0&&n>0)throw new mn(pn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const o of n)e=o._apply(e);return e}class Eh extends Ch{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Eh(e,t,n)}_apply(e){const t=this._parse(e);return Ah(e._query,t),new Nu(e.firestore,e.converter,ws(e._query,t))}_parse(e){const t=$u(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new mn(pn.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(s,"' queries on documentId()."));if("in"===s||"not-in"===s){Ph(o,s);const t=[];for(const n of o)t.push(Rh(r,e,n));a={arrayValue:{values:t}}}else a=Rh(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Ph(o,s),a=ah(n,t,o,"in"===s||"not-in"===s);return Hi.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function kh(e,t,n){const r=t,i=_h("where",e);return Eh._create(i,r,n)}class Th extends bh{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Th(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Gi.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)Ah(n,i),n=ws(n,i)}(e._query,t),new Nu(e.firestore,e.converter,ws(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Ih extends Ch{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ih(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new mn(pn.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new mn(pn.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new qi(t,n)}(e._query,this._field,this._direction);return new Nu(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new ds(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function xh(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=_h("orderBy",e);return Ih._create(n,t)}class Nh extends Ch{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Nh(e,t,n)}_apply(e){return new Nu(e.firestore,e.converter,bs(e._query,this._limit,this._limitType))}}function Rh(e,t,n){if("string"==typeof(n=ue(n))){if(""===n)throw new mn(pn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gs(t)&&-1!==n.indexOf("/"))throw new mn(pn.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=t.path.child(Ln.fromString(n));if(!Fn.isDocumentKey(r))throw new mn(pn.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Ii(e,new Fn(r))}if(n instanceof Ru)return Ii(e,n._key);throw new mn(pn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Bn(n),"."))}function Ph(e,t){if(!Array.isArray(e)||0===e.length)throw new mn(pn.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function Ah(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new mn(pn.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new mn(pn.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class Dh{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(vi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ti(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ni(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw un(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return Br(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t;const n=null===(t=e.fields)||void 0===t||null===(t=t[yi].arrayValue)||void 0===t||null===(t=t.values)||void 0===t?void 0:t.map(e=>ti(e.doubleValue));return new Hu(n)}convertGeoPoint(e){return new Wu(ti(e.latitude),ti(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=li(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ci(e));default:return null}}convertTimestamp(e){const t=ei(e);return new Xn(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ln.fromString(e);dn(Sa(n),9688,{name:e});const r=new di(n.get(1),n.get(3)),i=new Fn(n.popFirst(5));return r.isEqual(t)||an("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}function Oh(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Lh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Mh extends yh{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new jh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(_h("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new mn(pn.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Mh._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Mh._jsonSchemaVersion="firestore/documentSnapshot/1.0",Mh._jsonSchema={type:Gn("string",Mh._jsonSchemaVersion),bundleSource:Gn("string","DocumentSnapshot"),bundleName:Gn("string"),bundle:Gn("string")};class jh extends Mh{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class Fh{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Lh(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new jh(this._firestore,this._userDataWriter,n.key,n,new Lh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new mn(pn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new jh(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Lh(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new jh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Lh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Uh(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new mn(pn.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Fh._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Tn.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Uh(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return un(61501,{type:e})}}function Vh(e){e=Wn(e,Ru);const t=Wn(e.firestore,Fu);return bu(Uu(t),e._key).then(n=>Yh(t,e,n))}Fh._jsonSchemaVersion="firestore/querySnapshot/1.0",Fh._jsonSchema={type:Gn("string",Fh._jsonSchemaVersion),bundleSource:Gn("string","QuerySnapshot"),bundleName:Gn("string"),bundle:Gn("string")};class zh extends Dh{constructor(e){super(),this.firestore=e}convertBytes(e){return new zu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ru(this.firestore,null,t)}}function qh(e){e=Wn(e,Nu);const t=Wn(e.firestore,Fu),n=Uu(t),r=new zh(t);return wh(e._query),Cu(n,e._query).then(n=>new Fh(t,r,e,n))}function Bh(e,t,n){e=Wn(e,Ru);const r=Wn(e.firestore,Fu),i=Oh(e.converter,t,n);return Qh(r,[Zu($u(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,oo.none())])}function Wh(e,t,n){e=Wn(e,Ru);const r=Wn(e.firestore,Fu),i=$u(r);let s;for(var o=arguments.length,a=new Array(o>3?o-3:0),l=3;l<o;l++)a[l-3]=arguments[l];return s="string"==typeof(t=ue(t))||t instanceof qu?oh(i,"updateDoc",e._key,t,n,a):sh(i,"updateDoc",e._key,t),Qh(r,[s.toMutation(e._key,oo.exists(!0))])}function Hh(e){return Qh(Wn(e.firestore,Fu),[new wo(e._key,oo.none())])}function Gh(e,t){const n=Wn(e.firestore,Fu),r=Du(e),i=Oh(e.converter,t);return Qh(n,[Zu($u(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,oo.exists(!1))]).then(()=>r)}function Kh(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=ue(e);let i={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof n[s]||ju(n[s])||(i=n[s++]);const o={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(ju(n[s])){var a,l,c;const e=n[s];n[s]=null===(a=e.next)||void 0===a?void 0:a.bind(e),n[s+1]=null===(l=e.error)||void 0===l?void 0:l.bind(e),n[s+2]=null===(c=e.complete)||void 0===c?void 0:c.bind(e)}let u,h,d;if(e instanceof Ru)h=Wn(e.firestore,Fu),d=ps(e._key.path),u={next:t=>{n[s]&&n[s](Yh(h,e,t))},error:n[s+1],complete:n[s+2]};else{const t=Wn(e,Nu);h=Wn(t.firestore,Fu),d=t._query;const r=new zh(h);u={next:e=>{n[s]&&n[s](new Fh(h,r,t,e))},error:n[s+1],complete:n[s+2]},wh(e._query)}return function(e,t,n,r){const i=new du(r),s=new Ac(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>kc(await wu(e),s)),()=>{i.Nu(),e.asyncQueue.enqueueAndForget(async()=>Tc(await wu(e),s))}}(Uu(h),d,o,u)}function Qh(e,t){return function(e,t){const n=new gn;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=lu(e);try{const e=await function(e,t){const n=fn(e),r=Xn.now(),i=t.reduce((e,t)=>e.add(t.key),Vs());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=Ps(),l=Vs();return n.Ns.getEntries(e,i).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(i=>{s=i;const o=[];for(const e of t){const t=fo(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new go(e.key,t,ji(t.value.mapValue),oo.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)}).next(t=>{o=t;const r=t.applyToLocalDocumentSet(s,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:o.batchId,changes:Os(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Vu[e.currentUser.toKey()];r||(r=new Hr(In)),r=r.insert(t,n),e.Vu[e.currentUser.toKey()]=r}(r,e.batchId,n),await iu(r,e.changes),await ic(r.remoteStore)}catch(e){const t=vc(e,"Failed to persist write");n.reject(t)}}(await _u(e),t,n)),n.promise}(Uu(e),t)}function Yh(e,t,n){const r=n.docs.get(t._key),i=new zh(e);return new Mh(e,i,t._key,r,new Lh(n.hasPendingWrites,n.fromCache),t.converter)}function Xh(){return new nh("serverTimestamp")}function Jh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new rh("arrayUnion",t)}function $h(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new ih("arrayRemove",t)}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){nn=e}(kt),wt(new he("firestore",(e,n)=>{let{instanceIdentifier:r,options:i}=n;const s=e.getProvider("app").getImmediate(),o=new Fu(new wn(e.getProvider("auth-internal")),new En(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new mn(pn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new di(e.options.projectId,t)}(s,r),s);return i=c({useFetchStreams:t},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),xt(Zt,en,e),xt(Zt,en,"esm2020")}();const Zh="@firebase/database",ed="1.1.0";let td="";function nd(e){td=e}class rd{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Q(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:K(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class id{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return X(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const sd=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new rd(t)}}catch(t){}return new id},od=sd("localStorage"),ad=sd("sessionStorage"),ld=new be("@firebase/database"),cd=function(){let e=1;return function(){return e++}}(),ud=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,f(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new se;n.update(t);const r=n.digest();return g.encodeByteArray(r)},hd=function(){let e="";for(let t=0;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];Array.isArray(n)||n&&"object"===typeof n&&"number"===typeof n.length?e+=hd.apply(null,n):e+="object"===typeof n?Q(n):n,e+=" "}return e};let dd=null,fd=!0;const pd=function(e,t){f(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(ld.logLevel=ge.VERBOSE,dd=ld.log.bind(ld),t&&ad.set("logging_enabled",!0)):"function"===typeof e?dd=e:(dd=null,ad.remove("logging_enabled"))},md=function(){if(!0===fd&&(fd=!1,null===dd&&!0===ad.get("logging_enabled")&&pd(!0)),dd){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=hd.apply(null,t);dd(r)}},gd=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];md(e,...n)}},yd=function(){const e="FIREBASE INTERNAL ERROR: "+hd(...arguments);ld.error(e)},vd=function(){const e="FIREBASE FATAL ERROR: ".concat(hd(...arguments));throw ld.error(e),new Error(e)},_d=function(){const e="FIREBASE WARNING: "+hd(...arguments);ld.warn(e)},wd=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},bd="[MIN_NAME]",Cd="[MAX_NAME]",Sd=function(e,t){if(e===t)return 0;if(e===bd||t===Cd)return-1;if(t===bd||e===Cd)return 1;{const n=Pd(e),r=Pd(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},Ed=function(e,t){return e===t?0:e<t?-1:1},kd=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Q(t))},Td=function(e){if("object"!==typeof e||null===e)return Q(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=Q(t[r]),n+=":",n+=Td(e[t[r]]);return n+="}",n},Id=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function xd(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Nd=function(e){f(!wd(e),"Invalid JSON number");const t=1023;let n,r,i,s,o;0===e?(r=0,i=0,n=1/e===-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const Rd=new RegExp("^-?(0*)\\d{1,10}$"),Pd=function(e){if(Rd.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Ad=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw _d("Exception was thrown by user callback.",e),t},Math.floor(0))}},Dd=function(e,t){const n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n};class Od{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Ct(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){_d('Provided AppCheck credentials for the app named "'.concat(this.appName,'" ')+"are invalid. This usually indicates your app was not initialized correctly.")}}class Ld{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(md("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',_d(e)}}class Md{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Md.OWNER="owner";const jd="5",Fd=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ud="ac",Vd="websocket",zd="long_polling";class qd{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=od.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&od.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"";return"".concat(e).concat(this.host,"/").concat(t)}}function Bd(e,t,n){let r;if(f("string"===typeof t,"typeof type must == string"),f("object"===typeof n,"typeof params must == object"),t===Vd)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==zd)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return xd(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Wd{constructor(){this.counters_={}}incrementCounter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;X(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return b(this.counters_)}}const Hd={},Gd={};function Kd(e){const t=e.toString();return Hd[t]||(Hd[t]=new Wd),Hd[t]}class Qd{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Ad(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Yd="start";class Xd{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=gd(e),this.stats_=Kd(t),this.urlFn=e=>(this.appCheckToken&&(e[Ud]=this.appCheckToken),Bd(t,zd,e))}open(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Qd(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if(z()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Jd(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i,s,o,a,l]=t;if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===Yd)n.id=s,n.password=o;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);s?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(s,()=>{n.onClosed_()})):n.onClosed_()}},function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[i,s]=t;n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,s)},()=>{this.onClosed_()},this.urlFn);const e={};e[Yd]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=jd,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Ud]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&Fd.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Xd.forceAllow_=!0}static forceDisallow(){Xd.forceDisallow_=!0}static isAvailable(){return!z()&&(!!Xd.forceAllow_||!Xd.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Q(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=v(t),r=Id(n,1840);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(z())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Q(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Jd{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,z())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=cd(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Jd.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(i){md("frame writing exception"),i.stack&&md(i.stack),md(i)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||md("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){z()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{md("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}},Math.floor(1))}}let $d=null;"undefined"!==typeof MozWebSocket?$d=MozWebSocket:"undefined"!==typeof WebSocket&&($d=WebSocket);class Zd{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=gd(this.connId),this.stats_=Kd(t),this.connURL=Zd.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={};return s.v=jd,!z()&&"undefined"!==typeof location&&location.hostname&&Fd.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s[Ud]=r),i&&(s.p=i),Bd(e,Vd,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,od.set("previous_websocket_failure",!0);try{let e;if(z()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":"Firebase/".concat(jd,"/").concat(td,"/").concat(process.platform,"/").concat(t),"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization="Bearer ".concat(this.authToken)),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n={NODE_ENV:"production",PUBLIC_URL:"/craby",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new $d(this.connURL,[],e)}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Zd.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==$d&&!Zd.forceDisallow_}static previouslyFailed(){return od.isInMemoryStorage||!0===od.get("previous_websocket_failure")}markConnectionHealthy(){od.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=K(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(f(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Q(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Id(t,16384);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Zd.responsesRequiredToBeHealthy=2,Zd.healthyTimeout=3e4;class ef{static get ALL_TRANSPORTS(){return[Xd,Zd]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Zd&&Zd.isAvailable();let n=t&&!Zd.previouslyFailed();if(e.webSocketOnly&&(t||_d("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Zd];else{const e=this.transports_=[];for(const t of ef.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ef.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ef.globalTransportInitialized_=!1;class tf{constructor(e,t,n,r,i,s,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=gd("c:"+this.id+":"),this.transportManager_=new ef(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Dd(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=kd("t",e),n=kd("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=kd("t",e),n=kd("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=kd("t",e);if("d"in e){const n=e.d;if("h"===t){const e=c({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?yd("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):yd("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),jd!==n&&_d("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Dd(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Dd(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(od.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class nf{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class rf{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(let e=0;e<i.length;e++)i[e].callback.apply(i[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class sf extends rf{static getInstance(){return new sf}constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||F()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return f("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class of{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function af(){return new of("")}function lf(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function cf(e){return e.pieces_.length-e.pieceNum_}function uf(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new of(e.pieces_,t)}function hf(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function df(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function ff(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new of(t,0)}function pf(e,t){const n=[];for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof of)for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new of(n,0)}function mf(e){return e.pieceNum_>=e.pieces_.length}function gf(e,t){const n=lf(e),r=lf(t);if(null===n)return t;if(n===r)return gf(uf(e),uf(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function yf(e,t){const n=df(e,0),r=df(t,0);for(let i=0;i<n.length&&i<r.length;i++){const e=Sd(n[i],r[i]);if(0!==e)return e}return n.length===r.length?0:n.length<r.length?-1:1}function vf(e,t){if(cf(e)!==cf(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function _f(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(cf(e)>cf(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class wf{constructor(e,t){this.errorPrefix_=t,this.parts_=df(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=ce(this.parts_[n]);bf(this)}}function bf(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Cf(e))}function Cf(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Sf extends rf{static getInstance(){return new Sf}constructor(){let e,t;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!==typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!==typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!==typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Ef=1e3;class kf extends nf{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=kf.nextPersistentConnectionId_++,this.log_=gd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ef,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!z())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Sf.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&sf.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Q(i)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new R,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{const s=i.d,o=i.s;kf.warnOnListenWarnings_(s,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"===typeof e&&X(e,"w")){const n=J(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();_d("Using an unspecified index. Your data will be downloaded and "+"filtered on the client. Consider adding ".concat(e," at ")+"".concat(n," to your security rules for better performance."))}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Y(e).claims;return"object"===typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Y(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"===typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Q(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):yd("Unrecognized action received from server: "+Q(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ef,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ef,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Ef),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+kf.nextConnectionId_++,i=this.lastSessionId;let s=!1,o=null;const a=function(){o?o.close():(s=!0,n())},l=function(e){f(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)};this.realtime_={close:a,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,l]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);s?md("getToken() completed but was canceled"):(md("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,o=new tf(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{_d(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(yd){this.log_("Failed to get token: "+yd),s||(this.repoInfo_.nodeAdmin&&_d(yd),a())}}}interrupt(e){md("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){md("Resuming connection for reason: "+e),delete this.interruptReasons_[e],$(this.interruptReasons_)&&(this.reconnectDelay_=Ef,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Td(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new of(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){md("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){md("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";z()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+td.replace(/\./g,"-")]=1,F()?e["framework.cordova"]=1:V()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=sf.getInstance().currentlyOnline();return $(this.interruptReasons_)&&e}}kf.nextPersistentConnectionId_=0,kf.nextConnectionId_=0;class Tf{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Tf(e,t)}}class If{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Tf(bd,e),r=new Tf(bd,t);return 0!==this.compare(n,r)}minPost(){return Tf.MIN}}let xf;class Nf extends If{static get __EMPTY_NODE(){return xf}static set __EMPTY_NODE(e){xf=e}compare(e,t){return Sd(e.name,t.name)}isDefinedOn(e){throw p("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Tf.MIN}maxPost(){return new Tf(Cd,xf)}makePost(e,t){return f("string"===typeof e,"KeyIndex indexValue must always be a string."),new Tf(e,xf)}toString(){return".key"}}const Rf=new Nf;class Pf{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Af{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Af.RED,this.left=null!=r?r:Df.EMPTY_NODE,this.right=null!=i?i:Df.EMPTY_NODE}copy(e,t,n,r,i){return new Af(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Df.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Df.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Af.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Af.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Af.RED=!0,Af.BLACK=!1;class Df{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Df.EMPTY_NODE;this.comparator_=e,this.root_=t}insert(e,t){return new Df(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Af.BLACK,null,null))}remove(e){return new Df(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Af.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Pf(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Pf(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Pf(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Pf(this.root_,null,this.comparator_,!0,e)}}function Of(e,t){return Sd(e.name,t.name)}function Lf(e,t){return Sd(e,t)}let Mf;Df.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Af(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const jf=function(e){return"number"===typeof e?"number:"+Nd(e):"string:"+e},Ff=function(e){if(e.isLeafNode()){const t=e.val();f("string"===typeof t||"number"===typeof t||"object"===typeof t&&X(t,".sv"),"Priority must be a string or number.")}else f(e===Mf||e.isEmpty(),"priority of unexpected type.");f(e===Mf||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Uf,Vf,zf;class qf{static set __childrenNodeConstructor(e){Uf=e}static get __childrenNodeConstructor(){return Uf}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qf.__childrenNodeConstructor.EMPTY_NODE;this.value_=e,this.priorityNode_=t,this.lazyHash_=null,f(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ff(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new qf(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:qf.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return mf(e)?this:".priority"===lf(e)?this.priorityNode_:qf.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:qf.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=lf(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(f(".priority"!==n||1===cf(e),".priority must be the last token in a path"),this.updateImmediateChild(n,qf.__childrenNodeConstructor.EMPTY_NODE.updateChild(uf(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+jf(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Nd(this.value_):this.value_,this.lazyHash_=ud(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===qf.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof qf.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=qf.VALUE_TYPE_ORDER.indexOf(t),i=qf.VALUE_TYPE_ORDER.indexOf(n);return f(r>=0,"Unknown leaf type: "+t),f(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}qf.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Bf=new class extends If{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?Sd(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Tf.MIN}maxPost(){return new Tf(Cd,new qf("[PRIORITY-POST]",zf))}makePost(e,t){const n=Vf(e);return new Tf(t,new qf("[PRIORITY-POST]",n))}toString(){return".priority"}},Wf=Math.log(2);class Hf{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Wf,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Gf=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Af(a,o.node,Af.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=i(t,l),u=i(l+1,r);return o=e[l],a=n?n(o):o,new Af(a,o.node,Af.BLACK,c,u)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const c=i(s+1,a),u=e[s],h=n?n(u):u;l(new Af(h,u.node,r,null,c))},l=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,Af.BLACK):(a(r,Af.BLACK),a(r,Af.RED))}return s}(new Hf(e.length));return new Df(r||t,s)};let Kf;const Qf={};class Yf{static get Default(){return f(Qf&&Bf,"ChildrenNode.ts has not been loaded"),Kf=Kf||new Yf({".priority":Qf},{".priority":Bf}),Kf}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=J(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Df?t:null}hasIndex(e){return X(this.indexSet_,e.toString())}addIndex(e,t){f(e!==Rf,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(Tf.Wrap);let s,o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?Gf(n,e.getCompare()):Qf;const a=e.toString(),l=c({},this.indexSet_);l[a]=e;const u=c({},this.indexes_);return u[a]=s,new Yf(u,l)}addToIndexes(e,t){const n=Z(this.indexes_,(n,r)=>{const i=J(this.indexSet_,r);if(f(i,"Missing index implementation for "+r),n===Qf){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(Tf.Wrap);let s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),Gf(n,i.getCompare())}return Qf}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new Tf(e.name,r))),i.insert(e,e.node)}});return new Yf(n,this.indexSet_)}removeFromIndexes(e,t){const n=Z(this.indexes_,n=>{if(n===Qf)return n;{const r=t.get(e.name);return r?n.remove(new Tf(e.name,r)):n}});return new Yf(n,this.indexSet_)}}let Xf;class Jf{static get EMPTY_NODE(){return Xf||(Xf=new Jf(new Df(Lf),null,Yf.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ff(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Xf}updatePriority(e){return this.children_.isEmpty()?this:new Jf(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Xf:t}}getChild(e){const t=lf(e);return null===t?this:this.getImmediateChild(t).getChild(uf(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(f(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Tf(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(n,this.children_));const s=r.isEmpty()?Xf:this.priorityNode_;return new Jf(r,s,i)}}updateChild(e,t){const n=lf(e);if(null===n)return t;{f(".priority"!==lf(e)||1===cf(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(uf(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild(Bf,(s,o)=>{t[s]=o.val(e),n++,i&&Jf.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+jf(this.getPriority().val())+":"),this.forEachChild(Bf,(t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":ud(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new Tf(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Tf(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Tf(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,Tf.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,Tf.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===$f?-1:0}withIndex(e){if(e===Rf||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Jf(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Rf||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Bf),n=t.getIterator(Bf);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===Rf?null:this.indexMap_.get(e.toString())}}Jf.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const $f=new class extends Jf{constructor(){super(new Df(Lf),Jf.EMPTY_NODE,Yf.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Jf.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Tf,{MIN:{value:new Tf(bd,Jf.EMPTY_NODE)},MAX:{value:new Tf(Cd,$f)}}),Nf.__EMPTY_NODE=Jf.EMPTY_NODE,qf.__childrenNodeConstructor=Jf,Mf=$f,function(e){zf=e}($f);function Zf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return Jf.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),f(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){return new qf(e,Zf(t))}if(e instanceof Array){let n=Jf.EMPTY_NODE;return xd(e,(t,r)=>{if(X(e,t)&&"."!==t.substring(0,1)){const e=Zf(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}}),n.updatePriority(Zf(t))}{const n=[];let r=!1;if(xd(e,(e,t)=>{if("."!==e.substring(0,1)){const i=Zf(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new Tf(e,i)))}}),0===n.length)return Jf.EMPTY_NODE;const i=Gf(n,Of,e=>e.name,Lf);if(r){const e=Gf(n,Bf.getCompare());return new Jf(i,Zf(t),new Yf({".priority":e},{".priority":Bf}))}return new Jf(i,Zf(t),Yf.Default)}}!function(e){Vf=e}(Zf);class ep extends If{constructor(e){super(),this.indexPath_=e,f(!mf(e)&&".priority"!==lf(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?Sd(e.name,t.name):i}makePost(e,t){const n=Zf(e),r=Jf.EMPTY_NODE.updateChild(this.indexPath_,n);return new Tf(t,r)}maxPost(){const e=Jf.EMPTY_NODE.updateChild(this.indexPath_,$f);return new Tf(Cd,e)}toString(){return df(this.indexPath_,0).join("/")}}const tp=new class extends If{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Sd(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Tf.MIN}maxPost(){return Tf.MAX}makePost(e,t){const n=Zf(e);return new Tf(t,n)}toString(){return".value"}};function np(e){return{type:"value",snapshotNode:e}}function rp(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ip(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function sp(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class op{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(ip(t,o)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(rp(t,n)):s.trackChildChange(sp(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Bf,(e,r)=>{t.hasChild(e)||n.trackChildChange(ip(e,r))}),t.isLeafNode()||t.forEachChild(Bf,(t,r)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(sp(t,r,i))}else n.trackChildChange(rp(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Jf.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class ap{constructor(e){this.indexedFilter_=new op(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ap.getStartPost_(e),this.endPost_=ap.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new Tf(t,n))||(n=Jf.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Jf.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Jf.EMPTY_NODE);const i=this;return t.forEachChild(Bf,(e,t)=>{i.matches(new Tf(e,t))||(r=r.updateImmediateChild(e,Jf.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class lp{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new ap(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new Tf(t,n))||(n=Jf.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=Jf.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=Jf.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(Jf.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,Jf.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();const o=e;f(o.numChildren()===this.limit_,"");const a=new Tf(t,n),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(a);if(o.hasChild(t)){const e=o.getImmediateChild(t);let u=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=u&&(u.name===t||o.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);const h=null==u?1:s(u,a);if(c&&!n.isEmpty()&&h>=0)return null!=i&&i.trackChildChange(sp(t,n,e)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(ip(t,e));const n=o.updateImmediateChild(t,Jf.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(rp(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:c&&s(l,a)>=0?(null!=i&&(i.trackChildChange(ip(l.name,l.node)),i.trackChildChange(rp(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(l.name,Jf.EMPTY_NODE)):e}}class cp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Bf}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:bd}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Cd}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Bf}copy(){const e=new cp;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function up(e){const t={};if(e.isDefault())return t;let n;if(e.index_===Bf?n="$priority":e.index_===tp?n="$value":e.index_===Rf?n="$key":(f(e.index_ instanceof ep,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Q(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Q(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Q(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Q(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Q(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function hp(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Bf&&(t.i=e.index_.toString()),t}class dp extends nf{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=gd("p:rest:"),this.listens_={}}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=dp.getListenId_(e,n),o={};this.listens_[s]=o;const a=up(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),J(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}})}unlisten(e,t){const n=dp.getListenId_(e,t);delete this.listens_[n]}get(e){const t=up(e._queryParams),n=e._path.toString(),r=new R;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(r=>{let[i,s]=r;i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ne(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let t=null;if(a.status>=200&&a.status<300){try{t=K(a.responseText)}catch(e){_d("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,t)}else 401!==a.status&&404!==a.status&&_d("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}}class fp{constructor(){this.rootNode_=Jf.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function pp(){return{value:null,children:new Map}}function mp(e,t,n){if(mf(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=lf(t);e.children.has(r)||e.children.set(r,pp());mp(e.children.get(r),t=uf(t),n)}}function gp(e,t){if(mf(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(Bf,(t,n)=>{mp(e,new of(t),n)}),gp(e,t)}}if(e.children.size>0){const n=lf(t);if(t=uf(t),e.children.has(n)){gp(e.children.get(n),t)&&e.children.delete(n)}return 0===e.children.size}return!0}function yp(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,r)=>{yp(r,new of(t.toString()+"/"+e),n)})}class vp{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=c({},e);return this.last_&&xd(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class _p{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new vp(e);const n=1e4+2e4*Math.random();Dd(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;xd(e,(e,r)=>{r>0&&X(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),Dd(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var wp;function bp(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(wp||(wp={}));class Cp{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=wp.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(mf(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new of(e));return new Cp(af(),t,this.revert)}}return f(lf(this.path)===e,"operationForChild called for unrelated child."),new Cp(uf(this.path),this.affectedTree,this.revert)}}class Sp{constructor(e,t){this.source=e,this.path=t,this.type=wp.LISTEN_COMPLETE}operationForChild(e){return mf(this.path)?new Sp(this.source,af()):new Sp(this.source,uf(this.path))}}class Ep{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=wp.OVERWRITE}operationForChild(e){return mf(this.path)?new Ep(this.source,af(),this.snap.getImmediateChild(e)):new Ep(this.source,uf(this.path),this.snap)}}class kp{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=wp.MERGE}operationForChild(e){if(mf(this.path)){const t=this.children.subtree(new of(e));return t.isEmpty()?null:t.value?new Ep(this.source,af(),t.value):new kp(this.source,af(),t)}return f(lf(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new kp(this.source,uf(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Tp{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(mf(e))return this.isFullyInitialized()&&!this.filtered_;const t=lf(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ip{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function xp(e,t,n,r,i,s){const o=r.filter(e=>e.type===n);o.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw p("Should only compare child_ events.");const r=new Tf(t.childName,t.snapshotNode),i=new Tf(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)),o.forEach(n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function Np(e,t){return{eventCache:e,serverCache:t}}function Rp(e,t,n,r){return Np(new Tp(t,n,r),e.serverCache)}function Pp(e,t,n,r){return Np(e.eventCache,new Tp(t,n,r))}function Ap(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Dp(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Op;class Lp{static fromObject(e){let t=new Lp(null);return xd(e,(e,n)=>{t=t.set(new of(e),n)}),t}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(Op||(Op=new Df(Ed)),Op);this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:af(),value:this.value};if(mf(e))return null;{const n=lf(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(uf(e),t);if(null!=i){return{path:pf(new of(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(mf(e))return this;{const t=lf(e),n=this.children.get(t);return null!==n?n.subtree(uf(e)):new Lp(null)}}set(e,t){if(mf(e))return new Lp(t,this.children);{const n=lf(e),r=(this.children.get(n)||new Lp(null)).set(uf(e),t),i=this.children.insert(n,r);return new Lp(this.value,i)}}remove(e){if(mf(e))return this.children.isEmpty()?new Lp(null):new Lp(null,this.children);{const t=lf(e),n=this.children.get(t);if(n){const r=n.remove(uf(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new Lp(null):new Lp(this.value,i)}return this}}get(e){if(mf(e))return this.value;{const t=lf(e),n=this.children.get(t);return n?n.get(uf(e)):null}}setTree(e,t){if(mf(e))return t;{const n=lf(e),r=(this.children.get(n)||new Lp(null)).setTree(uf(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Lp(this.value,i)}}fold(e){return this.fold_(af(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(pf(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,af(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(mf(e))return null;{const r=lf(e),i=this.children.get(r);return i?i.findOnPath_(uf(e),pf(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,af(),t)}foreachOnPath_(e,t,n){if(mf(e))return this;{this.value&&n(t,this.value);const r=lf(e),i=this.children.get(r);return i?i.foreachOnPath_(uf(e),pf(t,r),n):new Lp(null)}}foreach(e){this.foreach_(af(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(pf(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class Mp{constructor(e){this.writeTree_=e}static empty(){return new Mp(new Lp(null))}}function jp(e,t,n){if(mf(t))return new Mp(new Lp(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=gf(i,t);return s=s.updateChild(o,n),new Mp(e.writeTree_.set(i,s))}{const r=new Lp(n),i=e.writeTree_.setTree(t,r);return new Mp(i)}}}function Fp(e,t,n){let r=e;return xd(n,(e,n)=>{r=jp(r,pf(t,e),n)}),r}function Up(e,t){if(mf(t))return Mp.empty();{const n=e.writeTree_.setTree(t,new Lp(null));return new Mp(n)}}function Vp(e,t){return null!=zp(e,t)}function zp(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(gf(n.path,t)):null}function qp(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Bf,(e,n)=>{t.push(new Tf(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new Tf(e,n.value))}),t}function Bp(e,t){if(mf(t))return e;{const n=zp(e,t);return new Mp(null!=n?new Lp(n):e.writeTree_.subtree(t))}}function Wp(e){return e.writeTree_.isEmpty()}function Hp(e,t){return Gp(af(),e.writeTree_,t)}function Gp(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{".priority"===t?(f(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Gp(pf(e,t),i,n)}),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(pf(e,".priority"),r)),n}}function Kp(e,t){return om(t,e)}function Qp(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);f(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&Yp(t,r.path)?i=!1:_f(r.path,t.path)&&(s=!0)),o--}if(i){if(s)return function(e){e.visibleWrites=Jp(e.allWrites,Xp,af()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=Up(e.visibleWrites,r.path);else{xd(r.children,t=>{e.visibleWrites=Up(e.visibleWrites,pf(r.path,t))})}return!0}return!1}function Yp(e,t){if(e.snap)return _f(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&_f(pf(e.path,n),t))return!0;return!1}function Xp(e){return e.visible}function Jp(e,t,n){let r=Mp.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)_f(n,e)?(t=gf(n,e),r=jp(r,t,s.snap)):_f(e,n)&&(t=gf(e,n),r=jp(r,af(),s.snap.getChild(t)));else{if(!s.children)throw p("WriteRecord should have .snap or .children");if(_f(n,e))t=gf(n,e),r=Fp(r,t,s.children);else if(_f(e,n))if(t=gf(e,n),mf(t))r=Fp(r,af(),s.children);else{const e=J(s.children,lf(t));if(e){const n=e.getChild(uf(t));r=jp(r,af(),n)}}}}}return r}function $p(e,t,n,r,i){if(r||i){const s=Bp(e.visibleWrites,t);if(!i&&Wp(s))return n;if(i||null!=n||Vp(s,af())){const s=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(_f(e.path,t)||_f(t,e.path))};return Hp(Jp(e.allWrites,s,t),n||Jf.EMPTY_NODE)}return null}{const r=zp(e.visibleWrites,t);if(null!=r)return r;{const r=Bp(e.visibleWrites,t);if(Wp(r))return n;if(null!=n||Vp(r,af())){return Hp(r,n||Jf.EMPTY_NODE)}return null}}}function Zp(e,t,n,r){return $p(e.writeTree,e.treePath,t,n,r)}function em(e,t){return function(e,t,n){let r=Jf.EMPTY_NODE;const i=zp(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Bf,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const i=Bp(e.visibleWrites,t);return n.forEachChild(Bf,(e,t)=>{const n=Hp(Bp(i,new of(e)),t);r=r.updateImmediateChild(e,n)}),qp(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return qp(Bp(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function tm(e,t,n,r){return function(e,t,n,r,i){f(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=pf(t,n);if(Vp(e.visibleWrites,s))return null;{const t=Bp(e.visibleWrites,s);return Wp(t)?i.getChild(n):Hp(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function nm(e,t){return function(e,t){return zp(e.visibleWrites,t)}(e.writeTree,pf(e.treePath,t))}function rm(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const l=Bp(e.visibleWrites,t),c=zp(l,af());if(null!=c)a=c;else{if(null==n)return[];a=Hp(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let l=n.getNext();for(;l&&e.length<i;)0!==t(l,r)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}function im(e,t,n){return function(e,t,n,r){const i=pf(t,n),s=zp(e.visibleWrites,i);if(null!=s)return s;if(r.isCompleteForChild(n))return Hp(Bp(e.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function sm(e,t){return om(pf(e.treePath,t),e.writeTree)}function om(e,t){return{treePath:e,writeTree:t}}class am{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,sp(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,ip(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,rp(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw p("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,sp(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const lm=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class cm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Tp(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return im(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Dp(this.viewCache_),i=rm(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function um(e,t,n,r,i){const s=new am;let o,a;if(n.type===wp.OVERWRITE){const l=n;l.source.fromUser?o=fm(e,t,l.path,l.snap,r,i,s):(f(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!mf(l.path),o=dm(e,t,l.path,l.snap,r,i,a,s))}else if(n.type===wp.MERGE){const l=n;l.source.fromUser?o=function(e,t,n,r,i,s,o){let a=t;return r.foreach((r,l)=>{const c=pf(n,r);pm(t,lf(c))&&(a=fm(e,a,c,l,i,s,o))}),r.foreach((r,l)=>{const c=pf(n,r);pm(t,lf(c))||(a=fm(e,a,c,l,i,s,o))}),a}(e,t,l.path,l.children,r,i,s):(f(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),o=gm(e,t,l.path,l.children,r,i,a,s))}else if(n.type===wp.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,r,i,s){let o;if(null!=nm(r,n))return t;{const a=new cm(r,t,i),l=t.eventCache.getNode();let c;if(mf(n)||".priority"===lf(n)){let n;if(t.serverCache.isFullyInitialized())n=Zp(r,Dp(t));else{const e=t.serverCache.getNode();f(e instanceof Jf,"serverChildren would be complete if leaf node"),n=em(r,e)}c=e.filter.updateFullNode(l,n,s)}else{const i=lf(n);let u=im(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=l.getImmediateChild(i)),c=null!=u?e.filter.updateChild(l,i,u,uf(n),a,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,Jf.EMPTY_NODE,uf(n),a,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Zp(r,Dp(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=nm(r,af()),Rp(t,c,o,e.filter.filtersNodes())}}(e,t,a.path,r,i,s):function(e,t,n,r,i,s,o){if(null!=nm(i,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value){if(mf(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return dm(e,t,n,l.getNode().getChild(n),i,s,a,o);if(mf(n)){let r=new Lp(null);return l.getNode().forEachChild(Rf,(e,t)=>{r=r.set(new of(e),t)}),gm(e,t,n,r,i,s,a,o)}return t}{let c=new Lp(null);return r.foreach((e,t)=>{const r=pf(n,e);l.isCompleteForPath(r)&&(c=c.set(e,l.getNode().getChild(r)))}),gm(e,t,n,c,i,s,a,o)}}(e,t,a.path,a.affectedTree,r,i,s)}else{if(n.type!==wp.LISTEN_COMPLETE)throw p("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=Pp(t,s.getNode(),s.isFullyInitialized()||mf(n),s.isFiltered());return hm(e,o,n,r,lm,i)}(e,t,n.path,r,s)}const l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Ap(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(np(Ap(t)))}}(t,o,l),{viewCache:o,changes:l}}function hm(e,t,n,r,i,s){const o=t.eventCache;if(null!=nm(r,n))return t;{let a,l;if(mf(n))if(f(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Dp(t),i=em(r,n instanceof Jf?n:Jf.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const n=Zp(r,Dp(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const c=lf(n);if(".priority"===c){f(1===cf(n),"Can't have a priority with additional path components");const i=o.getNode();l=t.serverCache.getNode();const s=tm(r,n,i,l);a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const u=uf(n);let h;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=tm(r,n,o.getNode(),l);h=null!=e?o.getNode().getImmediateChild(c).updateChild(u,e):o.getNode().getImmediateChild(c)}else h=im(r,c,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),c,h,u,i,s):o.getNode()}}return Rp(t,a,o.isFullyInitialized()||mf(n),e.filter.filtersNodes())}}function dm(e,t,n,r,i,s,o,a){const l=t.serverCache;let c;const u=o?e.filter:e.filter.getIndexedFilter();if(mf(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),e,null)}else{const e=lf(n);if(!l.isCompleteForPath(n)&&cf(n)>1)return t;const i=uf(n),s=l.getNode().getImmediateChild(e).updateChild(i,r);c=".priority"===e?u.updatePriority(l.getNode(),s):u.updateChild(l.getNode(),e,s,i,lm,null)}const h=Pp(t,c,l.isFullyInitialized()||mf(n),u.filtersNodes());return hm(e,h,n,i,new cm(i,h,s),a)}function fm(e,t,n,r,i,s,o){const a=t.eventCache;let l,c;const u=new cm(i,t,s);if(mf(n))c=e.filter.updateFullNode(t.eventCache.getNode(),r,o),l=Rp(t,c,!0,e.filter.filtersNodes());else{const i=lf(n);if(".priority"===i)c=e.filter.updatePriority(t.eventCache.getNode(),r),l=Rp(t,c,a.isFullyInitialized(),a.isFiltered());else{const s=uf(n),c=a.getNode().getImmediateChild(i);let h;if(mf(s))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===hf(s)&&e.getChild(ff(s)).isEmpty()?e:e.updateChild(s,r):Jf.EMPTY_NODE}if(c.equals(h))l=t;else{l=Rp(t,e.filter.updateChild(a.getNode(),i,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function pm(e,t){return e.eventCache.isCompleteForChild(t)}function mm(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function gm(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=mf(n)?r:new Lp(null).setTree(n,r);const u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){const l=mm(0,t.serverCache.getNode().getImmediateChild(n),r);c=dm(e,c,new of(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{const l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!l){const l=mm(0,t.serverCache.getNode().getImmediateChild(n),r);c=dm(e,c,new of(n),l,i,s,o,a)}}),c}class ym{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new op(n.getIndex()),i=(s=n).loadsAllData()?new op(s.getIndex()):s.hasLimit()?new lp(s):new ap(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,a=t.eventCache,l=r.updateFullNode(Jf.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(Jf.EMPTY_NODE,a.getNode(),null),u=new Tp(l,o.isFullyInitialized(),r.filtersNodes()),h=new Tp(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Np(h,u),this.eventGenerator_=new Ip(this.query_)}get query(){return this.query_}}function vm(e,t){const n=Dp(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!mf(t)&&!n.getImmediateChild(lf(t)).isEmpty())?n.getChild(t):null}function _m(e){return 0===e.eventRegistrations_.length}function wm(e,t,n){const r=[];if(n){f(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){const i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function bm(e,t,n,r){t.type===wp.MERGE&&null!==t.source.queryId&&(f(Dp(e.viewCache_),"We should always have a full cache before handling merges"),f(Ap(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=um(e.processor_,i,t,n,r);var o,a;return o=e.processor_,a=s.viewCache,f(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),f(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),f(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Cm(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Cm(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){const i=[],s=[];return t.forEach(t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}),xp(e,i,"child_removed",t,r,n),xp(e,i,"child_added",t,r,n),xp(e,i,"child_moved",s,r,n),xp(e,i,"child_changed",t,r,n),xp(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}let Sm,Em;class km{constructor(){this.views=new Map}}function Tm(e,t,n,r){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return f(null!=s,"SyncTree gave us an op for an invalid query."),bm(s,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(bm(s,t,n,r));return i}}function Im(e,t,n,r,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=Zp(n,i?r:null),s=!1;e?s=!0:r instanceof Jf?(e=em(n,r),s=!1):(e=Jf.EMPTY_NODE,s=!1);const o=Np(new Tp(e,s,!1),new Tp(r,i,!1));return new ym(t,o)}return o}function xm(e,t,n,r,i,s){const o=Im(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,r=[];n.getNode().isLeafNode()||n.getNode().forEachChild(Bf,(e,t)=>{r.push(rp(e,t))});return n.isFullyInitialized()&&r.push(np(n.getNode())),Cm(e,r,n.getNode(),t)}(o,n)}function Nm(e,t,n,r){const i=t._queryIdentifier,s=[];let o=[];const a=Om(e);if("default"===i)for(const[l,c]of e.views.entries())o=o.concat(wm(c,n,r)),_m(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const t=e.views.get(i);t&&(o=o.concat(wm(t,n,r)),_m(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!Om(e)&&s.push(new(f(Sm,"Reference.ts has not been loaded"),Sm)(t._repo,t._path)),{removed:s,events:o}}function Rm(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Pm(e,t){let n=null;for(const r of e.views.values())n=n||vm(r,t);return n}function Am(e,t){if(t._queryParams.loadsAllData())return Lm(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Dm(e,t){return null!=Am(e,t)}function Om(e){return null!=Lm(e)}function Lm(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Mm=1;class jm{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Lp(null),this.pendingWriteTree_={visibleWrites:Mp.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Fm(e,t,n,r,i){return function(e,t,n,r,i){f(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=jp(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?Hm(e,new Ep({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Um(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(Qp(e.pendingWriteTree_,t)){let t=new Lp(null);return null!=r.snap?t=t.set(af(),!0):xd(r.children,e=>{t=t.set(new of(e),!0)}),Hm(e,new Cp(r.path,t,n))}return[]}function Vm(e,t,n){return Hm(e,new Ep({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function zm(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||Dm(o,t))){const l=Nm(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const c=l.removed;if(a=l.events,!i){const n=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),i=e.syncPointTree_.findOnPath(s,(e,t)=>Om(t));if(n&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=function(e){return e.fold((e,t,n)=>{if(t&&Om(t)){return[Lm(t)]}{let e=[];return t&&(e=Rm(t)),xd(n,(t,n)=>{e=e.concat(n)}),e}})}(t);for(let t=0;t<n.length;++t){const r=n[t],i=r.query,s=Qm(e,r);e.listenProvider_.startListening(eg(i),Ym(e,i),s.hashFn,s.onComplete)}}}if(!i&&c.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(eg(t),n)}else c.forEach(t=>{const n=e.queryToTagMap.get(Xm(t));e.listenProvider_.stopListening(eg(t),n)})}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=Xm(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,c)}return a}function qm(e,t,n,r){const i=Jm(e,r);if(null!=i){const r=$m(i),s=r.path,o=r.queryId,a=gf(s,t);return Zm(e,s,new Ep(bp(o),a,n))}return[]}function Bm(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{const n=gf(e,i);s=s||Pm(t,n),o=o||Om(t)});let a,l=e.syncPointTree_.get(i);if(l?(o=o||Om(l),s=s||Pm(l,af())):(l=new km,e.syncPointTree_=e.syncPointTree_.set(i,l)),null!=s)a=!0;else{a=!1,s=Jf.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild((e,t)=>{const n=Pm(t,af());n&&(s=s.updateImmediateChild(e,n))})}const c=Dm(l,t);if(!c&&!t._queryParams.loadsAllData()){const n=Xm(t);f(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=Mm++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=xm(l,t,n,Kp(e.pendingWriteTree_,i),s,a);if(!c&&!o&&!r){const n=Am(l,t);u=u.concat(function(e,t,n){const r=t._path,i=Ym(e,t),s=Qm(e,n),o=e.listenProvider_.startListening(eg(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)f(!Om(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold((e,t,n)=>{if(!mf(e)&&t&&Om(t))return[Lm(t).query];{let e=[];return t&&(e=e.concat(Rm(t).map(e=>e.query))),xd(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){const r=t[n];e.listenProvider_.stopListening(eg(r),Ym(e,r))}}return o}(e,t,n))}return u}function Wm(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{const r=Pm(n,gf(e,t));if(r)return r});return $p(r,t,i,n,!0)}function Hm(e,t){return Gm(t,e.syncPointTree_,null,Kp(e.pendingWriteTree_,af()))}function Gm(e,t,n,r){if(mf(e.path))return Km(e,t,n,r);{const i=t.get(af());null==n&&null!=i&&(n=Pm(i,af()));let s=[];const o=lf(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=n?n.getImmediateChild(o):null,t=sm(r,o);s=s.concat(Gm(a,l,e,t))}return i&&(s=s.concat(Tm(i,e,r,n))),s}}function Km(e,t,n,r){const i=t.get(af());null==n&&null!=i&&(n=Pm(i,af()));let s=[];return t.children.inorderTraversal((t,i)=>{const o=n?n.getImmediateChild(t):null,a=sm(r,t),l=e.operationForChild(t);l&&(s=s.concat(Km(l,i,o,a)))}),i&&(s=s.concat(Tm(i,e,r,n))),s}function Qm(e,t){const n=t.query,r=Ym(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Jf.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return r?function(e,t,n){const r=Jm(e,n);if(r){const n=$m(r),i=n.path,s=n.queryId,o=gf(i,t);return Zm(e,i,new Sp(bp(s),o))}return[]}(e,n._path,r):function(e,t){return Hm(e,new Sp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return zm(e,n,null,r)}}}}function Ym(e,t){const n=Xm(t);return e.queryToTagMap.get(n)}function Xm(e){return e._path.toString()+"$"+e._queryIdentifier}function Jm(e,t){return e.tagToQueryMap.get(t)}function $m(e){const t=e.indexOf("$");return f(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new of(e.substr(0,t))}}function Zm(e,t,n){const r=e.syncPointTree_.get(t);f(r,"Missing sync point for query tag that we're tracking");return Tm(r,n,Kp(e.pendingWriteTree_,t),null)}function eg(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(f(Em,"Reference.ts has not been loaded"),Em)(e._repo,e._path):e}class tg{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new tg(t)}node(){return this.node_}}class ng{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=pf(this.path_,e);return new ng(this.syncTree_,t)}node(){return Wm(this.syncTree_,this.path_)}}const rg=function(e,t,n){return e&&"object"===typeof e?(f(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?ig(e[".sv"],t,n):"object"===typeof e[".sv"]?sg(e[".sv"],t):void f(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},ig=function(e,t,n){if("timestamp"===e)return n.timestamp;f(!1,"Unexpected server value: "+e)},sg=function(e,t,n){e.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!==typeof r&&f(!1,"Unexpected increment value: "+r);const i=t.node();if(f(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!==typeof s?r:s+r},og=function(e,t,n,r){return lg(t,new ng(n,e),r)},ag=function(e,t,n){return lg(e,new tg(t),n)};function lg(e,t,n){const r=e.getPriority().val(),i=rg(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=rg(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new qf(s,Zf(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new qf(i))),r.forEachChild(Bf,(e,r)=>{const i=lg(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))}),s}}class cg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};this.name=e,this.parent=t,this.node=n}}function ug(e,t){let n=t instanceof of?t:new of(t),r=e,i=lf(n);for(;null!==i;){const e=J(r.node.children,i)||{children:{},childCount:0};r=new cg(i,r,e),n=uf(n),i=lf(n)}return r}function hg(e){return e.node.value}function dg(e,t){e.node.value=t,yg(e)}function fg(e){return e.node.childCount>0}function pg(e,t){xd(e.node.children,(n,r)=>{t(new cg(n,e,r))})}function mg(e,t,n,r){n&&!r&&t(e),pg(e,e=>{mg(e,t,!0,r)}),n&&r&&t(e)}function gg(e){return new of(null===e.parent?e.name:gg(e.parent)+"/"+e.name)}function yg(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===hg(e)&&!fg(e)}(n),i=X(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,yg(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,yg(e))}(e.parent,e.name,e)}const vg=/[\[\].#$\/\u0000-\u001F\u007F]/,_g=/[\[\].#$\u0000-\u001F\u007F]/,wg=10485760,bg=function(e){return"string"===typeof e&&0!==e.length&&!vg.test(e)},Cg=function(e){return"string"===typeof e&&0!==e.length&&!_g.test(e)},Sg=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!wd(e)||e&&"object"===typeof e&&X(e,".sv")},Eg=function(e,t,n,r){r&&void 0===t||kg(le(e,"value"),t,n)},kg=function(e,t,n){const r=n instanceof of?new wf(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Cf(r));if("function"===typeof t)throw new Error(e+"contains a function "+Cf(r)+" with contents = "+t.toString());if(wd(t))throw new Error(e+"contains "+t.toString()+" "+Cf(r));if("string"===typeof t&&t.length>wg/3&&ce(t)>wg)throw new Error(e+"contains a string greater than "+wg+" utf8 bytes "+Cf(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){let n=!1,i=!1;if(xd(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!bg(t)))throw new Error(e+" contains an invalid key ("+t+") "+Cf(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=ce(t),bf(e)}(r,t),kg(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=ce(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)}),n&&i)throw new Error(e+' contains ".value" child '+Cf(r)+" in addition to actual children.")}},Tg=function(e,t,n,r){if(r&&void 0===t)return;const i=le(e,"values");if(!t||"object"!==typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];xd(t,(e,t)=>{const r=new of(e);if(kg(i,t,pf(n,r)),".priority"===hf(r)&&!Sg(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=df(r);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!bg(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(yf);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&_f(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)},Ig=function(e,t,n){if(!n||void 0!==t){if(wd(t))throw new Error(le(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Sg(t))throw new Error(le(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},xg=function(e,t,n,r){if((!r||void 0!==n)&&!Cg(n))throw new Error(le(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ng=function(e,t){if(".info"===lf(t))throw new Error(e+" failed = Can't modify data under /.info/")},Rg=function(e,t){const n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!bg(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Cg(e)}(n))throw new Error(le(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Pg{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ag(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null===n||vf(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function Dg(e,t,n){Ag(e,n),Lg(e,e=>vf(e,t))}function Og(e,t,n){Ag(e,n),Lg(e,e=>_f(e,t)||_f(t,e))}function Lg(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];if(i){t(i.path)?(Mg(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function Mg(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();dd&&md("event: "+n.toString()),Ad(r)}}}const jg="repo_interrupt";class Fg{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Pg,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=pp(),this.transactionQueueTree_=new cg,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Ug(e,t,n){if(e.stats_=Kd(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new dp(e.repoInfo_,(t,n,r,i)=>{qg(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>Bg(e,!0),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Q(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new kf(e.repoInfo_,t,(t,n,r,i)=>{qg(e,t,n,r,i)},t=>{Bg(e,t)},t=>{!function(e,t){xd(t,(t,n)=>{Wg(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const n=e.toString();return Gd[n]||(Gd[n]=t()),Gd[n]}(e.repoInfo_,()=>new _p(e.stats_,e.server_)),e.infoData_=new fp,e.infoSyncTree_=new jm({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Vm(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),Wg(e,"connected",!1),e.serverSyncTree_=new jm({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{const s=i(n,r);Og(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Vg(e){const t=e.infoData_.getNode(new of(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function zg(e){return(t=(t={timestamp:Vg(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function qg(e,t,n,r,i){e.dataUpdateCount++;const s=new of(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=Z(n,e=>Zf(e));o=function(e,t,n,r){const i=Jm(e,r);if(i){const r=$m(i),s=r.path,o=r.queryId,a=gf(s,t),l=Lp.fromObject(n);return Zm(e,s,new kp(bp(o),a,l))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=Zf(n);o=qm(e.serverSyncTree_,s,t,i)}else if(r){const t=Z(n,e=>Zf(e));o=function(e,t,n){const r=Lp.fromObject(n);return Hm(e,new kp({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=Zf(n);o=Vm(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=ty(e,s)),Og(e.eventQueue_,a,o)}function Bg(e,t){Wg(e,"connected",t),!1===t&&function(e){Jg(e,"onDisconnectEvents");const t=zg(e),n=pp();yp(e.onDisconnect_,af(),(r,i)=>{const s=og(r,i,e.serverSyncTree_,t);mp(n,r,s)});let r=[];yp(n,af(),(t,n)=>{r=r.concat(Vm(e.serverSyncTree_,t,n));const i=oy(e,t);ty(e,i)}),e.onDisconnect_=pp(),Og(e.eventQueue_,af(),r)}(e)}function Wg(e,t,n){const r=new of("/.info/"+t),i=Zf(n);e.infoData_.updateSnapshot(r,i);const s=Vm(e.infoSyncTree_,r,i);Og(e.eventQueue_,r,s)}function Hg(e){return e.nextWriteId_++}function Gg(e,t,n,r,i){Jg(e,"set",{path:t.toString(),value:n,priority:r});const s=zg(e),o=Zf(n,r),a=Wm(e.serverSyncTree_,t),l=ag(o,a,s),c=Hg(e),u=Fm(e.serverSyncTree_,t,l,c,!0);Ag(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,r)=>{const s="ok"===n;s||_d("set at "+t+" failed: "+n);const o=Um(e.serverSyncTree_,c,!s);Og(e.eventQueue_,t,o),$g(e,i,n,r)});const h=oy(e,t);ty(e,h),Og(e.eventQueue_,h,[])}function Kg(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{"ok"===r&&gp(e.onDisconnect_,t),$g(e,n,r,i)})}function Qg(e,t,n,r){const i=Zf(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,s)=>{"ok"===n&&mp(e.onDisconnect_,t,i),$g(e,r,n,s)})}function Yg(e,t,n){let r;r=".info"===lf(t._path)?zm(e.infoSyncTree_,t,n):zm(e.serverSyncTree_,t,n),Dg(e.eventQueue_,t._path,r)}function Xg(e){e.persistentConnection_&&e.persistentConnection_.interrupt(jg)}function Jg(e){let t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":");for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];md(t,...r)}function $g(e,t,n,r){t&&Ad(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}})}function Zg(e,t,n){return Wm(e.serverSyncTree_,t,n)||Jf.EMPTY_NODE}function ey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||sy(e,t),hg(t)){const n=ry(e,t);f(n.length>0,"Sending zero length transaction queue");n.every(e=>0===e.status)&&function(e,t,n){const r=n.map(e=>e.currentWriteId),i=Zg(e,t,r);let s=i;const o=i.hash();for(let c=0;c<n.length;c++){const e=n[c];f(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const r=gf(t,e.path);s=s.updateChild(r,e.currentOutputSnapshotRaw)}const a=s.val(!0),l=t;e.server_.put(l.toString(),a,r=>{Jg(e,"transaction put response",{path:l.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(Um(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();sy(e,ug(e.transactionQueueTree_,t)),ey(e,e.transactionQueueTree_),Og(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)Ad(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{_d("transaction at "+l.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}ty(e,t)}},o)}(e,gg(t),n)}else fg(t)&&pg(t,t=>{ey(e,t)})}function ty(e,t){const n=ny(e,t),r=gg(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const s=t.filter(e=>0===e.status),o=s.map(e=>e.currentWriteId);for(let a=0;a<t.length;a++){const s=t[a],l=gf(n,s.path);let c,u=!1;if(f(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===s.status)u=!0,c=s.abortReason,i=i.concat(Um(e.serverSyncTree_,s.currentWriteId,!0));else if(0===s.status)if(s.retryCount>=25)u=!0,c="maxretry",i=i.concat(Um(e.serverSyncTree_,s.currentWriteId,!0));else{const n=Zg(e,s.path,o);s.currentInputSnapshot=n;const r=t[a].update(n.val());if(void 0!==r){kg("transaction failed: Data returned ",r,s.path);let t=Zf(r);"object"===typeof r&&null!=r&&X(r,".priority")||(t=t.updatePriority(n.getPriority()));const a=s.currentWriteId,l=zg(e),c=ag(t,n,l);s.currentOutputSnapshotRaw=t,s.currentOutputSnapshotResolved=c,s.currentWriteId=Hg(e),o.splice(o.indexOf(a),1),i=i.concat(Fm(e.serverSyncTree_,s.path,c,s.currentWriteId,s.applyLocally)),i=i.concat(Um(e.serverSyncTree_,a,!0))}else u=!0,c="nodata",i=i.concat(Um(e.serverSyncTree_,s.currentWriteId,!0))}Og(e.eventQueue_,n,i),i=[],u&&(t[a].status=2,function(e){setTimeout(e,Math.floor(0))}(t[a].unwatcher),t[a].onComplete&&("nodata"===c?r.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):r.push(()=>t[a].onComplete(new Error(c),!1,null))))}sy(e,e.transactionQueueTree_);for(let a=0;a<r.length;a++)Ad(r[a]);ey(e,e.transactionQueueTree_)}(e,ry(e,n),r),r}function ny(e,t){let n,r=e.transactionQueueTree_;for(n=lf(t);null!==n&&void 0===hg(r);)r=ug(r,n),n=lf(t=uf(t));return r}function ry(e,t){const n=[];return iy(e,t,n),n.sort((e,t)=>e.order-t.order),n}function iy(e,t,n){const r=hg(t);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);pg(t,t=>{iy(e,t,n)})}function sy(e,t){const n=hg(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,dg(t,n.length>0?n:void 0)}pg(t,t=>{sy(e,t)})}function oy(e,t){const n=gg(ny(e,t)),r=ug(e.transactionQueueTree_,t);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(r,t=>{ay(e,t)}),ay(e,r),mg(r,t=>{ay(e,t)}),n}function ay(e,t){const n=hg(t);if(n){const r=[];let i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(f(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(f(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(Um(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?dg(t,void 0):n.length=s+1,Og(e.eventQueue_,gg(t),i);for(let e=0;e<r.length;e++)Ad(r[e])}}const ly=function(e,t){const n=cy(e),r=n.namespace;"firebase.com"===n.domain&&vd(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||vd("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&_d("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new qd(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new of(n.pathString)}},cy=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"===typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let e=n[i];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(r){}t+="/"+e}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):_d("Invalid query segment '".concat(n,"' in query '").concat(e,"'"))}return t}(e.substring(Math.min(e.length,h)));c=t.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const f=t.slice(0,c);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}},uy="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let e=0;const t=[]}();class hy{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Q(this.snapshot.exportVal())}}class dy{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class fy{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class py{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new R;return Kg(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ng("OnDisconnect.remove",this._path);const e=new R;return Qg(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ng("OnDisconnect.set",this._path),Eg("OnDisconnect.set",e,this._path,!1);const t=new R;return Qg(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ng("OnDisconnect.setWithPriority",this._path),Eg("OnDisconnect.setWithPriority",e,this._path,!1),Ig("OnDisconnect.setWithPriority",t,!1);const n=new R;return function(e,t,n,r,i){const s=Zf(n,r);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&mp(e.onDisconnect_,t,s),$g(0,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){Ng("OnDisconnect.update",this._path),Tg("OnDisconnect.update",e,this._path,!1);const t=new R;return function(e,t,n,r){if($(n))return md("onDisconnect().update() called with empty data.  Don't do anything."),void $g(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(i,s)=>{"ok"===i&&xd(n,(n,r)=>{const i=Zf(r);mp(e.onDisconnect_,pf(t,n),i)}),$g(0,r,i,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class my{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return mf(this._path)?null:hf(this._path)}get ref(){return new gy(this._repo,this._path)}get _queryIdentifier(){const e=hp(this._queryParams),t=Td(e);return"{}"===t?"default":t}get _queryObject(){return hp(this._queryParams)}isEqual(e){if(!((e=ue(e))instanceof my))return!1;const t=this._repo===e._repo,n=vf(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class gy extends my{constructor(e,t){super(e,t,new cp,!1)}get parent(){const e=ff(this._path);return null===e?null:new gy(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class yy{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new of(e),n=_y(this.ref,e);return new yy(this._node.getChild(t),n,Bf)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,(t,n)=>e(new yy(n,_y(this.ref,t),Bf)))}hasChild(e){const t=new of(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function vy(e,t){return(e=ue(e))._checkNotDeleted("ref"),void 0!==t?_y(e._root,t):e._root}function _y(e,t){var n,r,i,s;return null===lf((e=ue(e))._path)?(n="child",r="path",s=!1,(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),xg(n,r,i,s)):xg("child","path",t,!1),new gy(e._repo,pf(e._path,t))}function wy(e,t){e=ue(e),Ng("set",e._path),Eg("set",t,e._path,!1);const n=new R;return Gg(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}class by{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new hy("value",this,new yy(e.snapshotNode,new gy(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new dy(this,e,t):null}matches(e){return e instanceof by&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Cy{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new dy(this,e,t):null}createEvent(e,t){f(null!=e.childName,"Child events should have a childName.");const n=_y(new gy(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new hy(e.type,this,new yy(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Cy&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Sy(e,t,n,r,i){let s;if("object"===typeof r&&(s=void 0,i=r),"function"===typeof r&&(s=r),i&&i.onlyOnce){const t=n,r=(n,r)=>{Yg(e._repo,e,a),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}const o=new fy(n,s||void 0),a="value"===t?new by(o):new Cy(t,o);return function(e,t,n){let r;r=".info"===lf(t._path)?Bm(e.infoSyncTree_,t,n):Bm(e.serverSyncTree_,t,n),Dg(e.eventQueue_,t._path,r)}(e._repo,e,a),()=>Yg(e._repo,e,a)}function Ey(e,t,n,r){return Sy(e,"value",t,n,r)}!function(e){f(!Sm,"__referenceConstructor has already been defined"),Sm=e}(gy),function(e){f(!Em,"__referenceConstructor has already been defined"),Em=e}(gy);const ky={};let Ty=!1;function Iy(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||vd("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),md("Using default host for project ",e.options.projectId),s="".concat(e.options.projectId,"-default-rtdb.firebaseio.com"));let o,a,l=ly(s,i),c=l.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",PUBLIC_URL:"/craby",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,s="http://".concat(a,"?ns=").concat(c.namespace),l=ly(s,i),c=l.repoInfo):o=!l.repoInfo.secure;const u=i&&o?new Md(Md.OWNER):new Ld(e.name,e.options,t);Rg("Invalid Firebase Database URL",l),mf(l.path)||vd("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,r){let i=ky[t.name];i||(i={},ky[t.name]=i);let s=i[e.toURLString()];s&&vd("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Fg(e,Ty,n,r),i[e.toURLString()]=s,s}(c,e,u,new Od(e,n));return new xy(h,e)}class xy{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Ug(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new gy(this._repo,af())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=ky[t];n&&n[e.key]===e||vd("Database ".concat(t,"(").concat(e.repoInfo_,") has already been deleted.")),Xg(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&vd("Cannot call "+e+" on a deleted database.")}}const Ny={".sv":"timestamp"};function Ry(){return Ny}kf.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},kf.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};!function(e){nd(kt),wt(new he("database",(e,t)=>{let{instanceIdentifier:n}=t;return Iy(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)},"PUBLIC").setMultipleInstances(!0)),xt(Zh,ed,e),xt(Zh,ed,"esm2020")}();function Py(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}xt("firebase","12.3.0","app");const Ay=["providerId"],Dy=["uid","auth","stsTokenManager"],Oy=["providerId","signInMethod"];function Ly(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const My=Ly,jy=new H("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Fy=new be("@firebase/auth");function Uy(e){if(Fy.logLevel<=ge.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Fy.error("Auth (".concat(kt,"): ").concat(e),...n)}}function Vy(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Wy(e,...n)}function zy(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Wy(e,...n)}function qy(e,t,n){const r=c(c({},My()),{},{[t]:n});return new H("auth","Firebase",r).create(t,{appName:e.name})}function By(e){return qy(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wy(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return jy.create(e,...n)}function Hy(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw Wy(t,...r)}}function Gy(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Uy(t),new Error(t)}function Ky(e,t){e||Gy(t)}function Qy(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Yy(){return"http:"===Xy()||"https:"===Xy()}function Xy(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function Jy(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Yy()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class $y{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ky(t>e,"Short delay should be less than long delay!"),this.isMobile=F()||V()}get(){return Jy()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Zy(e,t){Ky(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class ev{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void Gy("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void Gy("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void Gy("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const tv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},nv=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],rv=new $y(3e4,6e4);function iv(e,t){return e.tenantId&&!t.tenantId?c(c({},t),{},{tenantId:e.tenantId}):t}async function sv(e,t,n,r){return ov(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=ne(c({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const l=c({method:t,headers:a},i);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&P(e.emulatorConfig.host)&&(l.credentials="include"),ev.fetch()(await lv(e,e.config.apiHost,n,o),l)})}async function ov(e,t,n){e._canInitEmulator=!1;const r=c(c({},tv),t);try{const t=new uv(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw hv(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw hv(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw hv(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw hv(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw qy(e,a,o);Vy(e,a)}}catch(i){if(i instanceof W)throw i;Vy(e,"network-request-failed",{message:String(i)})}}async function av(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s=await sv(e,t,n,r,i);return"mfaPendingCredential"in s&&Vy(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function lv(e,t,n,r){const i="".concat(t).concat(n,"?").concat(r),s=e,o=s.config.emulator?Zy(e.config,i):"".concat(e.config.apiScheme,"://").concat(i);if(nv.includes(n)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())){return s._getPersistence()._getFinalTarget(o).toString()}return o}function cv(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class uv{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(zy(this.auth,"network-request-failed")),rv.get())})}}function hv(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=zy(e,t,r);return i.customData._tokenResponse=n,i}function dv(e){return void 0!==e&&void 0!==e.enterprise}class fv{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return cv(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function pv(e,t){return sv(e,"GET","/v2/recaptchaConfig",iv(e,t))}async function mv(e,t){return sv(e,"POST","/v1/accounts:lookup",t)}function gv(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function yv(e){return 1e3*Number(e)}function vv(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Uy("JWT malformed, contained fewer than 3 sections"),null;try{const e=w(n);return e?JSON.parse(e):(Uy("Failed to decode base64 JWT payload"),null)}catch(i){return Uy("Caught error parsing JWT payload as JSON",null===i||void 0===i?void 0:i.toString()),null}}function _v(e){const t=vv(e);return Hy(t,"internal-error"),Hy("undefined"!==typeof t.exp,"internal-error"),Hy("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function wv(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof W&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class bv{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{var t;this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class Cv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=gv(this.lastLoginAt),this.creationTime=gv(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Sv(e){var t;const n=e.auth,r=await e.getIdToken(),i=await wv(e,mv(n,{idToken:r}));Hy(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=null!==(t=s.providerUserInfo)&&void 0!==t&&t.length?Ev(s.providerUserInfo):[],a=(l=e.providerData,c=o,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const u=e.isAnonymous,h=!(e.email&&s.passwordHash)&&!(null!==a&&void 0!==a&&a.length),d=!!u&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Cv(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function Ev(e){return e.map(e=>{let{providerId:t}=e,n=Py(e,Ay);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class kv{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Hy(e.idToken,"internal-error"),Hy("undefined"!==typeof e.idToken,"internal-error"),Hy("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):_v(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Hy(0!==e.length,"internal-error");const t=_v(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(Hy(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await ov(e,{},async()=>{const n=ne({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=await lv(e,r,"/v1/token","key=".concat(i)),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&P(e.emulatorConfig.host)&&(a.credentials="include"),ev.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new kv;return n&&(Hy("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Hy("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Hy("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new kv,this.toJSON())}_performRefresh(){return Gy("not implemented")}}function Tv(e,t){Hy("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Iv{constructor(e){let{uid:t,auth:n,stsTokenManager:r}=e,i=Py(e,Dy);this.providerId="firebase",this.proactiveRefresh=new bv(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Cv(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await wv(this,this.stsTokenManager.getToken(this.auth,e));return Hy(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=ue(e),r=await n.getIdToken(t),i=vv(r);Hy(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"===typeof i.firebase?i.firebase:void 0,o=null===s||void 0===s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:gv(yv(i.auth_time)),issuedAtTime:gv(yv(i.iat)),expirationTime:gv(yv(i.exp)),signInProvider:o||null,signInSecondFactor:(null===s||void 0===s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=ue(e);await Sv(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Hy(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>c({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Iv(c(c({},this),{},{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Hy(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Sv(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ct(this.auth.app))return Promise.reject(By(this.auth));const e=await this.getIdToken();return await wv(this,async function(e,t){return sv(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return c(c({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>c({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{},{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,l,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,f=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,m=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,y=null!==(l=t.createdAt)&&void 0!==l?l:void 0,v=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:_,emailVerified:w,isAnonymous:b,providerData:C,stsTokenManager:S}=t;Hy(_&&S,e,"internal-error");const E=kv.fromJSON(this.name,S);Hy("string"===typeof _,e,"internal-error"),Tv(h,e.name),Tv(d,e.name),Hy("boolean"===typeof w,e,"internal-error"),Hy("boolean"===typeof b,e,"internal-error"),Tv(f,e.name),Tv(p,e.name),Tv(m,e.name),Tv(g,e.name),Tv(y,e.name),Tv(v,e.name);const k=new Iv({uid:_,auth:e,email:d,emailVerified:w,displayName:h,isAnonymous:b,photoURL:p,phoneNumber:f,tenantId:m,stsTokenManager:E,createdAt:y,lastLoginAt:v});return C&&Array.isArray(C)&&(k.providerData=C.map(e=>c({},e))),g&&(k._redirectEventId=g),k}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new kv;r.updateFromServerResponse(t);const i=new Iv({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Sv(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Hy(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?Ev(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null!==i&&void 0!==i&&i.length),o=new kv;o.updateFromIdToken(n);const a=new Iv({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Cv(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null!==i&&void 0!==i&&i.length)};return Object.assign(a,l),a}}const xv=new Map;function Nv(e){Ky(e instanceof Function,"Expected a class definition");let t=xv.get(e);return t?(Ky(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,xv.set(e,t),t)}class Rv{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Rv.type="NONE";const Pv=Rv;function Av(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class Dv{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Av(this.userKey,r.apiKey,i),this.fullPersistenceKey=Av("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await mv(this.auth,{idToken:e}).catch(()=>{});return t?Iv._fromGetAccountInfoResponse(this.auth,t,e):null}return Iv._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new Dv(Nv(Pv),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Nv(Pv);const s=Av(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(s);if(t){let n;if("string"===typeof t){const r=await mv(e,{idToken:t}).catch(()=>{});if(!r)break;n=await Iv._fromGetAccountInfoResponse(e,r,t)}else n=Iv._fromJSON(e,t);c!==i&&(o=n),i=c;break}}catch(l){}const a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(t){}})),new Dv(i,e,n)):new Dv(i,e,n)}}function Ov(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Fv(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Lv(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Vv(t))return"Blackberry";if(zv(t))return"Webos";if(Mv(t))return"Safari";if((t.includes("chrome/")||jv(t))&&!t.includes("edge/"))return"Chrome";if(Uv(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function Lv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j();return/firefox\//i.test(e)}function Mv(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:j()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function jv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j();return/crios\//i.test(e)}function Fv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j();return/iemobile/i.test(e)}function Uv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j();return/android/i.test(e)}function Vv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j();return/blackberry/i.test(e)}function zv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j();return/webos/i.test(e)}function qv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Bv(){return function(){const e=j();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Wv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j();return qv(e)||Uv(e)||zv(e)||Vv(e)||/windows phone/i.test(e)||Fv(e)}function Hv(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Ov(j());break;case"Worker":t="".concat(Ov(j()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(kt,"/").concat(r)}class Gv{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(i){r(i)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class Kv{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Qv{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xv(this),this.idTokenSubscription=new Xv(this),this.beforeStateQueue=new Gv(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jy,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Nv(t)),this._initializationPromise=this.queue(async()=>{var n,r,i;if(!this._deleted&&(this.persistenceManager=await Dv.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null!==(r=this._popupRedirectResolver)&&void 0!==r&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(s){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await mv(this,{idToken:e}),n=await Iv._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ct(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){var i,s;await this.getOrInitRedirectPersistenceManager();const t=null===(i=this.redirectUser)||void 0===i?void 0:i._redirectEventId,o=null===(s=n)||void 0===s?void 0:s._redirectEventId,a=await this.tryRedirectSignIn(e);t&&t!==o||null===a||void 0===a||!a.user||(n=a.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Hy(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Sv(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ct(this.app))return Promise.reject(By(this));const t=e?ue(e):null;return t&&Hy(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&Hy(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ct(this.app)?Promise.reject(By(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ct(this.app)?Promise.reject(By(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Nv(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return sv(e,"GET","/v2/passwordPolicy",iv(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new Kv(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new H("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return sv(e,"POST","/v2/accounts:revokeToken",iv(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Nv(e)||this._popupRedirectResolver;Hy(t,this,"argument-error"),this.redirectPersistenceManager=await Dv.create(this,[Nv(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Hy(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Hy(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Hv(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(Ct(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return null!==t&&void 0!==t&&t.error&&function(e){if(Fy.logLevel<=ge.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Fy.warn("Auth (".concat(kt,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function Yv(e){return ue(e)}class Xv{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new oe(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return Hy(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Jv={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function $v(e){return Jv.loadJS(e)}function Zv(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class e_{constructor(){this.enterprise=new t_}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class t_{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const n_="NO_RECAPTCHA";class r_{constructor(e){this.type="recaptcha-enterprise",this.auth=Yv(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;dv(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(n_)})}):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new e_).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{pv(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new fv(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&dv(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Jv.recaptchaEnterpriseScript;0!==t.length&&(t+=i),$v(t).then(()=>{n(i,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function i_(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=new r_(e);let o;if(i)o=n_;else try{o=await s.verify(n)}catch(yd){o=await s.verify(n,!0)}const a=c({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function s_(e,t,n,r,i){if("EMAIL_PASSWORD_PROVIDER"===i){var s;if(null!==(s=e._getRecaptchaConfig())&&void 0!==s&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await i_(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch(async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await i_(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)})}if("PHONE_PROVIDER"===i){var o;if(null!==(o=e._getRecaptchaConfig())&&void 0!==o&&o.isProviderEnabled("PHONE_PROVIDER")){const i=await i_(e,t,n);return r(e,i).catch(async i=>{var s;if("AUDIT"===(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&(i.code==="auth/".concat("missing-recaptcha-token")||i.code==="auth/".concat("invalid-app-credential"))){console.log("Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ".concat(n," flow."));const i=await i_(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{const i=await i_(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}async function o_(e){const t=Yv(e),n=await pv(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new fv(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new r_(t).verify()}}function a_(e,t,n){const r=Yv(e);Hy(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!(null===n||void 0===n||!n.disableWarnings),s=l_(t),{host:o,port:a}=function(e){const t=l_(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:c_(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:c_(t)}}}(t),l=null===a?"":":".concat(a),c={url:"".concat(s,"//").concat(o).concat(l,"/")},u=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return Hy(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void Hy(ee(c,r.config.emulator)&&ee(u,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=c,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,P(o)?(A("".concat(s,"//").concat(o).concat(l)),M("Auth",!0)):i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function l_(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function c_(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class u_{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Gy("not implemented")}_getIdTokenResponse(e){return Gy("not implemented")}_linkToIdToken(e,t){return Gy("not implemented")}_getReauthenticationResolver(e){return Gy("not implemented")}}async function h_(e,t){return sv(e,"POST","/v1/accounts:signUp",t)}async function d_(e,t){return av(e,"POST","/v1/accounts:signInWithPassword",iv(e,t))}class f_ extends u_{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new f_(e,t,"password")}static _fromEmailAndCode(e,t){return new f_(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if(null!==t&&void 0!==t&&t.email&&null!==t&&void 0!==t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return s_(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",d_,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return av(e,"POST","/v1/accounts:signInWithEmailLink",iv(e,t))}(e,{email:this._email,oobCode:this._password});default:Vy(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return s_(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",h_,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return av(e,"POST","/v1/accounts:signInWithEmailLink",iv(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Vy(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function p_(e,t){return av(e,"POST","/v1/accounts:signInWithIdp",iv(e,t))}class m_ extends u_{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new m_(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Vy("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Py(t,Oy);if(!n||!r)return null;const s=new m_(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return p_(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,p_(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,p_(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ne(t)}return e}}async function g_(e,t){return sv(e,"POST","/v1/accounts:sendVerificationCode",iv(e,t))}const y_={USER_NOT_FOUND:"user-not-found"};class v_ extends u_{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new v_({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new v_({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return av(e,"POST","/v1/accounts:signInWithPhoneNumber",iv(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await av(e,"POST","/v1/accounts:signInWithPhoneNumber",iv(e,t));if(n.temporaryProof)throw hv(e,"account-exists-with-different-credential",n);return n}(e,c({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return av(e,"POST","/v1/accounts:signInWithPhoneNumber",iv(e,c(c({},t),{},{operation:"REAUTH"})),y_)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new v_({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class __{constructor(e){var t,n,r,i,s,o;const a=re(ie(e)),l=null!==(t=a.apiKey)&&void 0!==t?t:null,c=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Hy(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.lang)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=re(ie(e)).link,n=t?re(ie(t)).deep_link_id:null,r=re(ie(e)).deep_link_id;return(r?re(ie(r)).link:null)||r||n||t||e}(e);try{return new __(t)}catch(n){return null}}}class w_{constructor(){this.providerId=w_.PROVIDER_ID}static credential(e,t){return f_._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=__.parseLink(t);return Hy(n,"argument-error"),f_._fromEmailAndCode(e,n.code,n.tenantId)}}w_.PROVIDER_ID="password",w_.EMAIL_PASSWORD_SIGN_IN_METHOD="password",w_.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class b_{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class C_ extends b_{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class S_ extends C_{constructor(){super("facebook.com")}static credential(e){return m_._fromParams({providerId:S_.PROVIDER_ID,signInMethod:S_.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return S_.credentialFromTaggedObject(e)}static credentialFromError(e){return S_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return S_.credential(t.oauthAccessToken)}catch(n){return null}}}S_.FACEBOOK_SIGN_IN_METHOD="facebook.com",S_.PROVIDER_ID="facebook.com";class E_ extends C_{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return m_._fromParams({providerId:E_.PROVIDER_ID,signInMethod:E_.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return E_.credentialFromTaggedObject(e)}static credentialFromError(e){return E_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return E_.credential(n,r)}catch(i){return null}}}E_.GOOGLE_SIGN_IN_METHOD="google.com",E_.PROVIDER_ID="google.com";class k_ extends C_{constructor(){super("github.com")}static credential(e){return m_._fromParams({providerId:k_.PROVIDER_ID,signInMethod:k_.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return k_.credentialFromTaggedObject(e)}static credentialFromError(e){return k_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return k_.credential(t.oauthAccessToken)}catch(n){return null}}}k_.GITHUB_SIGN_IN_METHOD="github.com",k_.PROVIDER_ID="github.com";class T_ extends C_{constructor(){super("twitter.com")}static credential(e,t){return m_._fromParams({providerId:T_.PROVIDER_ID,signInMethod:T_.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return T_.credentialFromTaggedObject(e)}static credentialFromError(e){return T_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return T_.credential(n,r)}catch(i){return null}}}T_.TWITTER_SIGN_IN_METHOD="twitter.com",T_.PROVIDER_ID="twitter.com";class I_{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await Iv._fromIdTokenResponse(e,n,r),s=x_(n);return new I_({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=x_(n);return new I_({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function x_(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class N_ extends W{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,N_.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new N_(e,t,n,r)}}function R_(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw N_._fromErrorAndOperation(e,n,t,r);throw n})}async function P_(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await wv(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return I_._forOperation(e,"link",r)}async function A_(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(Ct(r.app))return Promise.reject(By(r));const i="reauthenticate";try{const s=await wv(e,R_(r,i,t,e),n);Hy(s.idToken,r,"internal-error");const o=vv(s.idToken);Hy(o,r,"internal-error");const{sub:a}=o;return Hy(e.uid===a,r,"user-mismatch"),I_._forOperation(e,i,s)}catch(s){throw(null===s||void 0===s?void 0:s.code)==="auth/".concat("user-not-found")&&Vy(r,"user-mismatch"),s}}async function D_(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ct(e.app))return Promise.reject(By(e));const r="signIn",i=await R_(e,r,t),s=await I_._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}function O_(e,t){return sv(e,"POST","/v2/accounts/mfaEnrollment:start",iv(e,t))}new WeakMap;const L_="__sak";class M_{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(L_,"1"),this.storage.removeItem(L_),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class j_ extends M_{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Wv(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);Bv()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}j_.type="LOCAL";const F_=j_;function U_(e){var t,n;const r=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),i=RegExp("".concat(r,"=([^;]+)"));return null!==(t=null===(n=document.cookie.match(i))||void 0===n?void 0:n[1])&&void 0!==t?t:null}function V_(e){const t="http:"===window.location.protocol;return"".concat(t?"__dev_":"__HOST-","FIREBASE_").concat(e.split(":")[3])}class z_{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL("".concat(window.location.origin,"/__cookies__"));return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=V_(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return null===e||void 0===e?void 0:e.value}return U_(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=V_(e);document.cookie="".concat(t,"=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High"),await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const n=V_(e);if(window.cookieStore){const e=e=>{const r=e.changed.find(e=>e.name===n);r&&t(r.value);e.deleted.find(e=>e.name===n)&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=U_(n);const i=setInterval(()=>{const e=U_(n);e!==r&&(t(e),r=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(i))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}z_.type="COOKIE";class q_ extends M_{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}q_.type="SESSION";const B_=q_;class W_{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new W_(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(null===s||void 0===s||!s.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map(async e=>e(t.origin,i)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function H_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}W_.receivers=[];class G_{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((o,a)=>{const l=H_("",20);r.port1.start();const c=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(c),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function K_(){return window}function Q_(){return"undefined"!==typeof K_().WorkerGlobalScope&&"function"===typeof K_().importScripts}const Y_="firebaseLocalStorageDb",X_="firebaseLocalStorage",J_="fbase_key";class $_{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Z_(e,t){return e.transaction([X_],t?"readwrite":"readonly").objectStore(X_)}function ew(){const e=indexedDB.open(Y_,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(X_,{keyPath:J_})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(X_)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Y_);return new $_(e).toPromise()}(),t(await ew()))})})}async function tw(e,t,n){const r=Z_(e,!0).put({[J_]:t,value:n});return new $_(r).toPromise()}function nw(e,t){const n=Z_(e,!0).delete(t);return new $_(n).toPromise()}class rw{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await ew()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Q_()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=W_._getInstance(Q_()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){var e;if(null===(e=navigator)||void 0===e||!e.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new G_(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=navigator)||void 0===e||null===(e=e.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ew();return await tw(e,L_,"1"),await nw(e,L_),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>tw(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=Z_(e,!1).get(t),r=await new $_(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nw(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Z_(e,!1).getAll();return new $_(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}rw.type="LOCAL";const iw=rw;function sw(e,t){return sv(e,"POST","/v2/accounts/mfaSignIn:start",iv(e,t))}Zv("rcb"),new $y(3e4,6e4);const ow="recaptcha";async function aw(e,t,n){if(!e._getRecaptchaConfig())try{await o_(e)}catch(yd){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){Hy("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=s_(e,r,"mfaSmsEnrollment",async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===n_){Hy((null===n||void 0===n?void 0:n.type)===ow,e,"argument-error");return O_(e,await lw(e,t,n))}return O_(e,t)},"PHONE_PROVIDER"),o=await s.catch(e=>Promise.reject(e));return o.phoneSessionInfo.sessionInfo}{var r;Hy("signin"===t.type,e,"internal-error");const s=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;Hy(s,e,"missing-multi-factor-info");const o={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=s_(e,o,"mfaSmsSignIn",async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===n_){Hy((null===n||void 0===n?void 0:n.type)===ow,e,"argument-error");return sw(e,await lw(e,t,n))}return sw(e,t)},"PHONE_PROVIDER"),l=await a.catch(e=>Promise.reject(e));return l.phoneResponseInfo.sessionInfo}}{const t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=s_(e,t,"sendVerificationCode",async(e,t)=>{if(t.captchaResponse===n_){Hy((null===n||void 0===n?void 0:n.type)===ow,e,"argument-error");return g_(e,await lw(e,t,n))}return g_(e,t)},"PHONE_PROVIDER"),s=await r.catch(e=>Promise.reject(e));return s.sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function lw(e,t,n){Hy(n.type===ow,e,"argument-error");const r=await n.verify();Hy("string"===typeof r,e,"argument-error");const i=c({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class cw{constructor(e){this.providerId=cw.PROVIDER_ID,this.auth=Yv(e)}verifyPhoneNumber(e,t){return aw(this.auth,e,ue(t))}static credential(e,t){return v_._fromVerification(e,t)}static credentialFromResult(e){const t=e;return cw.credentialFromTaggedObject(t)}static credentialFromError(e){return cw.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?v_._fromTokenResponse(n,r):null}}function uw(e,t){return t?Nv(t):(Hy(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}cw.PROVIDER_ID="phone",cw.PHONE_SIGN_IN_METHOD="phone";class hw extends u_{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return p_(e,this._buildIdpRequest())}_linkToIdToken(e,t){return p_(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return p_(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function dw(e){return D_(e.auth,new hw(e),e.bypassAuthState)}function fw(e){const{auth:t,user:n}=e;return Hy(n,t,"internal-error"),A_(n,new hw(e),e.bypassAuthState)}async function pw(e){const{auth:t,user:n}=e;return Hy(n,t,"internal-error"),P_(n,new hw(e),e.bypassAuthState)}class mw{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return dw;case"linkViaPopup":case"linkViaRedirect":return pw;case"reauthViaPopup":case"reauthViaRedirect":return fw;default:Vy(this.auth,"internal-error")}}resolve(e){Ky(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ky(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const gw=new $y(2e3,1e4);class yw extends mw{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,yw.currentPopupAction&&yw.currentPopupAction.cancel(),yw.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Hy(e,this.auth,"internal-error"),e}async onExecution(){Ky(1===this.filter.length,"Popup operations only handle one event");const e=H_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(zy(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(zy(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yw.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t;null!==(t=this.authWindow)&&void 0!==t&&null!==(t=t.window)&&void 0!==t&&t.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(zy(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,gw.get())};e()}}yw.currentPopupAction=null;const vw=new Map;class _w extends mw{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=vw.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Cw(t),r=bw(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}vw.set(this.auth._key(),e)}return this.bypassAuthState||vw.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function ww(e,t){vw.set(e._key(),t)}function bw(e){return Nv(e._redirectPersistence)}function Cw(e){return Av("pendingRedirect",e.config.apiKey,e.name)}async function Sw(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ct(e.app))return Promise.reject(By(e));const r=Yv(e),i=uw(r,t),s=new _w(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Ew{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Tw(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Tw(e)){var n;const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(zy(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(kw(e))}saveEventToCache(e){this.cachedEventUids.add(kw(e)),this.lastProcessedEventTime=Date.now()}}function kw(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Tw(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const Iw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xw=/^https?/;async function Nw(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return sv(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(Rw(r))return}catch(n){}Vy(e,"unauthorized-domain")}function Rw(e){const t=Qy(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!xw.test(n))return!1;if(Iw.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Pw=new $y(3e4,6e4);function Aw(){const e=K_().___jsl;if(null!==e&&void 0!==e&&e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Dw(e){return new Promise((t,n)=>{var r,i;function s(){Aw(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Aw(),n(zy(e,"network-request-failed"))},timeout:Pw.get()})}if(null!==(r=K_().gapi)&&void 0!==r&&null!==(r=r.iframes)&&void 0!==r&&r.Iframe)t(gapi.iframes.getContext());else{if(null===(i=K_().gapi)||void 0===i||!i.load){const t=Zv("iframefcb");return K_()[t]=()=>{gapi.load?s():n(zy(e,"network-request-failed"))},$v("".concat(Jv.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}s()}}).catch(e=>{throw Ow=null,e})}let Ow=null;const Lw=new $y(5e3,15e3),Mw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},jw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Fw(e){const t=e.config;Hy(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Zy(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:kt},i=jw.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),"".concat(n,"?").concat(ne(r).slice(1))}async function Uw(e){const t=await function(e){return Ow=Ow||Dw(e),Ow}(e),n=K_().gapi;return Hy(n,e,"internal-error"),t.open({where:document.body,url:Fw(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Mw,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=zy(e,"network-request-failed"),s=K_().setTimeout(()=>{r(i)},Lw.get());function o(){K_().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}const Vw={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class zw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function qw(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=c(c({},Vw),{},{width:r.toString(),height:i.toString(),top:s,left:o}),u=j().toLowerCase();n&&(a=jv(u)?"_blank":n),Lv(u)&&(t=t||"http://localhost",l.scrollbars="yes");const h=Object.entries(l).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return qv(arguments.length>0&&void 0!==arguments[0]?arguments[0]:j())&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new zw(null);const d=window.open(t||"",a,h);Hy(d,e,"popup-blocked");try{d.focus()}catch(f){}return new zw(d)}const Bw="__/auth/handler",Ww="emulator/auth/handler",Hw=encodeURIComponent("fac");async function Gw(e,t,n,r,i,s){Hy(e.config.authDomain,e,"auth-domain-config-required"),Hy(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:kt,eventId:i};if(t instanceof b_){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",$(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof C_){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const u of Object.keys(a))void 0===a[u]&&delete a[u];const l=await e._getAppCheckToken(),c=l?"#".concat(Hw,"=").concat(encodeURIComponent(l)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Bw);return Zy(t,Ww)}(e),"?").concat(ne(a).slice(1)).concat(c)}const Kw="webStorageSupport";const Qw=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=B_,this._completeRedirectFn=Sw,this._overrideRedirectResult=ww}async _openPopup(e,t,n,r){var i;Ky(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return qw(e,await Gw(e,t,n,Qy(),r),H_())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){K_().location.href=e}(await Gw(e,t,n,Qy(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Ky(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Uw(e),n=new Ew(e);return t.register("authEvent",t=>{Hy(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Kw,{type:Kw},n=>{var r;const i=null===n||void 0===n||null===(r=n[0])||void 0===r?void 0:r[Kw];void 0!==i&&t(!!i),Vy(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Nw(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Wv()||Mv()||qv()}};var Yw="@firebase/auth",Xw="1.11.0";class Jw{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Hy(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const $w=N("authIdTokenMaxAge")||300;let Zw=null;var eb,tb;eb={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=zy("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Jv=eb,tb="Browser",wt(new he("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Hy(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:tb,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Hv(tb)},c=new Qv(r,i,s,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Nv);null!==t&&void 0!==t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),wt(new he("auth-internal",e=>(e=>new Jw(e))(Yv(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),xt(Yw,Xw,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(tb)),xt(Yw,Xw,"esm2020");const nb=Tt({apiKey:"AIzaSyDYQKW0ybh7i493GJPNMWU3rl-v7THNFbg",authDomain:"craby-4838b.firebaseapp.com",projectId:"craby-4838b",storageBucket:"craby-4838b.firebasestorage.app",messagingSenderId:"1027884351051",appId:"1:1027884351051:web:60d3c6102e128296e197ce",databaseURL:"https://craby-4838b-default-rtdb.asia-southeast1.firebasedatabase.app"}),rb=(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:It();const t=bt(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=bt(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(ee(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;Vy(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Qw,persistence:[iw,F_,B_]}),r=N("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>$w)return;const r=null===t||void 0===t?void 0:t.token;Zw!==r&&(Zw=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:"Bearer ".concat(r)}:{}}))});!function(e,t,n){ue(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){ue(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}var i;const s=T("auth");s&&a_(n,"http://".concat(s))}(nb),function(e,t){const n="object"==typeof e?e:It(),r="string"==typeof e?e:t||hi,i=bt(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const e=I("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=Wn(e,xu);const i=P(t),s=e._getSettings(),o=c(c({},s),{},{emulatorOptions:e._getEmulatorOptions()}),a="".concat(t,":").concat(n);i&&(A("https://".concat(a)),M("Firestore",!0)),s.host!==ku&&s.host!==a&&ln("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=c(c({},s),{},{host:a,ssl:i,emulatorOptions:r});if(!ee(l,o)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=tn.MOCK_USER;else{var u;t=D(r.mockUserToken,null===(u=e._app)||void 0===u?void 0:u.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new mn(pn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new tn(i)}e._authCredentials=new _n(new yn(t,n))}}(i,...e)}return i}(nb)),ib=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:It(),t=arguments.length>1?arguments[1]:void 0;const n=bt(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=I("database");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=ue(e),e._checkNotDeleted("useEmulator");const i="".concat(t,":").concat(n),s=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&ee(r,s.repoInfo_.emulatorOptions))return;vd("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&vd('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Md(Md.OWNER);else if(r.mockUserToken){const t="string"===typeof r.mockUserToken?r.mockUserToken:D(r.mockUserToken,e.app.options.projectId);o=new Md(t)}P(t)&&(A(t),M("Database",!0));!function(e,t,n,r){const i=t.lastIndexOf(":"),s=P(t.substring(0,i));e.repoInfo_=new qd(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(e.authTokenProvider_=r)}(s,i,r,o)}(n,...e)}return n}(nb),sb=async e=>{const t=await Vh(Du(rb,"users",e));return t.exists()?t.data():null},ob=async(e,t)=>{const n=await yb(e);await Bh(Du(rb,"waitingPool",e),{uid:e,username:t,blockedUsers:n.map(e=>e.uid),timestamp:Xh()})},ab=async e=>{await Hh(Du(rb,"waitingPool",e))},lb=async(e,t)=>{const n=Sh(Au(rb,"chatRooms"),kh("participants","array-contains",e),kh("active","==",!0)),r=await qh(n);for(const i of r.docs){const e=i.data();if(e.participants.includes(t))return c({id:i.id},e)}return null},cb=async e=>{const t=Sh(Au(rb,"chatRooms"),kh("participants","array-contains",e),kh("active","==",!0));return!(await qh(t)).empty},ub=async e=>{const t=Sh(Au(rb,"chatRooms"),kh("participants","array-contains",e),kh("active","==",!0)),n=await qh(t);return n.empty?null:c({id:n.docs[0].id},n.docs[0].data())},hb=async e=>{await Wh(Du(rb,"chatRooms",e),{active:!1,endedAt:Xh()})},db=async e=>{const t=await Vh(Du(rb,"users",e));if(!t.exists())return[];const n=t.data().friends||[];return(await Promise.all(n.map(async e=>{const t=await Vh(Du(rb,"users",e));return t.exists()?c({id:e},t.data()):null}))).filter(e=>null!==e)},fb=(e,t)=>{const n=vy(ib,"presence/".concat(e));wy(n,{status:t,lastChanged:Ry()}),function(e){return e=ue(e),new py(e._repo,e._path)}(n).set({status:"offline",lastChanged:Ry()})},pb=(e,t)=>Ey(vy(ib,"presence/".concat(e)),e=>{const n=e.val();t(n?n.status:"offline")}),mb=async(e,t,n,r)=>{const i="".concat(e,"_").concat(n);await Bh(Du(rb,"chatRequests",i),{fromUid:e,fromUsername:t,toUid:n,toUsername:r,status:"pending",timestamp:Xh()})},gb=async(e,t,n,r,i)=>{await Wh(Du(rb,"chatRequests",e),{status:"accepted"});return await async function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"random";const s=await lb(e,t);return s?s.id:(await Gh(Au(rb,"chatRooms"),{participants:[e,t],participantNames:{[e]:n,[t]:r},chatType:i,createdAt:Xh(),active:!0})).id}(t,n,r,i,"direct")},yb=async e=>{const t=await Vh(Du(rb,"users",e));return t.exists()&&t.data().blockedUsers||[]},vb=(e,t)=>Kh(Sh(Au(rb,"chatRequests"),kh("toUid","==",e),kh("status","==","pending")),e=>{const n=e.docs.map(e=>c({id:e.id},e.data()));t(n)}),_b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;var n;return Kh(Sh(Au(rb,"groups"),kh("isPublic","==",!0),xh("activityScore","desc"),(Hn("limit",n=t),Nh._create("limit",n,"F"))),t=>{const n=t.docs.map(e=>c({id:e.id},e.data()));e(n)})},wb=async e=>{const t=await Vh(Du(rb,"groups",e));return t.exists()?c({id:t.id},t.data()):null},bb=async e=>{const t=Du(rb,"groups",e),n=await Vh(t);if(n.exists()){var r;const i=(null===(r=n.data().members)||void 0===r?void 0:r.length)||0,s=new Date(Date.now()-864e5),o=Sh(Au(rb,"groups",e,"messages"),kh("timestamp",">=",s)),a=2*(await qh(o)).size+i;await Wh(t,{activityScore:a,lastActivity:Xh()})}},Cb=async e=>{const t=await Vh(Du(rb,"groups",e));if(!t.exists())return[];const n=t.data().members||[];return(await Promise.all(n.map(async e=>{const t=await Vh(Du(rb,"users",e));return t.exists()?c({id:e},t.data()):null}))).filter(e=>null!==e)},Sb=(e,t)=>{const n=/@(\w+)/g,r=[];let i;for(;null!==(i=n.exec(e));){const e=i[1],n=t.find(t=>t.username===e||t.nickname===e);n&&r.push(n.uid||n.id)}return[...new Set(r)]},Eb=async(e,t,n)=>{await Wh(Du(rb,"groupInvites",e),{status:"accepted"}),await(async(e,t)=>{const n=Du(rb,"groups",e);await Wh(n,{members:Jh(t)}),await bb(e)})(t,n)};var kb=n(579);function Tb(e){let{onAuthSuccess:t}=e;const[n,i]=(0,r.useState)(!0),[s,o]=(0,r.useState)(""),[a,l]=(0,r.useState)(""),[c,u]=(0,r.useState)("male"),[h,d]=(0,r.useState)(""),[f,p]=(0,r.useState)(!1);return(0,kb.jsx)("div",{style:Ib.container,children:(0,kb.jsxs)("div",{style:Ib.card,children:[(0,kb.jsx)("h1",{style:Ib.title,children:"CRABY"}),(0,kb.jsx)("p",{style:Ib.subtitle,children:"Random Chat with Friends"}),(0,kb.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),d(""),p(!0);try{if(n){if(!s.trim()||!a.trim())return d("Nickname and password are required"),void p(!1);await(async(e,t)=>{const n=Du(rb,"users",e),r=await Vh(n);if(!r.exists())throw new Error("Invalid nickname or password");if(r.data().password!==t)throw new Error("Invalid nickname or password");return{uid:e,nickname:e}})(s.trim(),a),t(s.trim())}else{if(!s.trim())return d("Nickname is required"),void p(!1);if(r=s.trim(),!/^[a-zA-Z0-9_]+$/.test(r))return d("Nickname can only contain letters, numbers, and underscores"),void p(!1);if(!a.trim())return d("Password is required"),void p(!1);if(await(async e=>(await Vh(Du(rb,"users",e))).exists())(s.trim()))return d("Nickname already taken"),void p(!1);await(async(e,t,n)=>{const r=Du(rb,"users",e);if((await Vh(r)).exists())throw new Error("Nickname already taken");return await Bh(r,{uid:e,nickname:e,username:e,password:t,gender:n,friends:[],blockedUsers:[],createdAt:Xh()}),{uid:e,nickname:e}})(s.trim(),a,c),t(s.trim())}}catch(i){d(i.message||"Something went wrong")}finally{p(!1)}var r},style:Ib.form,children:[(0,kb.jsx)("input",{type:"text",placeholder:"Nickname (letters, numbers, _ only)",value:s,onChange:e=>o(e.target.value),required:!0,style:Ib.input}),(0,kb.jsx)("input",{type:"password",placeholder:"Password",value:a,onChange:e=>l(e.target.value),required:!0,style:Ib.input}),!n&&(0,kb.jsxs)("div",{style:Ib.genderRow,children:[(0,kb.jsx)("label",{style:Ib.genderLabel,children:"Gender:"}),(0,kb.jsxs)("label",{style:Ib.radioLabel,children:[(0,kb.jsx)("input",{type:"radio",name:"gender",value:"male",checked:"male"===c,onChange:()=>u("male")}),(0,kb.jsx)("span",{style:Ib.radioText,children:"Male"})]}),(0,kb.jsxs)("label",{style:Ib.radioLabel,children:[(0,kb.jsx)("input",{type:"radio",name:"gender",value:"female",checked:"female"===c,onChange:()=>u("female")}),(0,kb.jsx)("span",{style:Ib.radioText,children:"Female"})]})]}),h&&(0,kb.jsx)("p",{style:Ib.error,children:h}),(0,kb.jsx)("button",{type:"submit",disabled:f,style:Ib.button,children:f?"Loading...":n?"Login":"Register"})]}),(0,kb.jsxs)("p",{style:Ib.toggle,children:[n?"Don't have an account? ":"Already have an account? ",(0,kb.jsx)("span",{onClick:()=>{i(!n),d("")},style:Ib.link,children:n?"Register":"Login"})]})]})})}const Ib={container:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},card:{background:"white",borderRadius:"12px",padding:"40px",boxShadow:"0 10px 40px rgba(0,0,0,0.1)",width:"100%",maxWidth:"400px"},title:{fontSize:"36px",fontWeight:"bold",textAlign:"center",color:"#667eea",marginBottom:"8px"},subtitle:{textAlign:"center",color:"#666",marginBottom:"32px"},form:{display:"flex",flexDirection:"column",gap:"16px"},input:{padding:"12px 16px",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"16px",outline:"none",transition:"border-color 0.3s"},genderRow:{display:"flex",alignItems:"center",gap:"16px",fontSize:"14px",color:"#333"},genderLabel:{fontWeight:600},radioLabel:{display:"flex",alignItems:"center",gap:"6px"},radioText:{fontSize:"14px"},button:{padding:"12px",background:"#667eea",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"background 0.3s"},error:{color:"#e74c3c",fontSize:"14px",margin:"0"},toggle:{textAlign:"center",marginTop:"24px",color:"#666"},link:{color:"#667eea",cursor:"pointer",fontWeight:"600"}};function xb(e){let{user:t,userProfile:n,onEnterChat:i,onViewFriends:s,onLogout:o,onStartDirectChat:a,onViewGroups:l}=e;const[u,h]=(0,r.useState)([]),[d,f]=(0,r.useState)([]),[p,m]=(0,r.useState)([]),[g,y]=(0,r.useState)([]),[v,_]=(0,r.useState)([]),[w,b]=(0,r.useState)({}),[C,S]=(0,r.useState)("online"),[E,k]=(0,r.useState)(!1),T=async e=>{try{await(async(e,t)=>{const n=Du(rb,"users",e),r=await Vh(n);if(r.exists()){const e=(r.data().blockedUsers||[]).find(e=>e.uid===t);e&&await Wh(n,{blockedUsers:$h(e)})}})(t.uid,e),y(t=>t.filter(t=>t.uid!==e)),alert("User unblocked successfully!")}catch(yd){console.error("Error unblocking user:",yd),alert("Failed to unblock user")}};(0,r.useEffect)(()=>{const e=(e=>Ey(vy(ib,"presence"),t=>{const n=t.val();if(!n)return void e([]);const r=Object.entries(n).filter(e=>{let[t,n]=e;return"offline"!==n.status}).map(e=>{let[t,n]=e;return{uid:t,status:n.status}});e(r)}))(async e=>{const n=e.filter(e=>e.uid!==t.uid);h(n);const r=await Promise.all(n.map(async e=>{const t=await sb(e.uid);return t?c(c({},t),{},{status:e.status}):null}));f(r.filter(e=>null!==e))}),n=vb(t.uid,m);return I(),x(),()=>{e(),n()}},[t.uid]);const I=async()=>{const e=await yb(t.uid);y(e)},x=async()=>{const e=await db(t.uid);_(e),e.forEach(e=>{pb(e.id,t=>{b(n=>c(c({},n),{},{[e.id]:t}))})})},N=async(e,r)=>{try{if(await(async(e,t)=>(await yb(e)).some(e=>e.uid===t))(t.uid,e))return void alert("You have blocked this user");await mb(t.uid,n.username,e,r),alert("Chat request sent to ".concat(r,"! They will be notified."))}catch(yd){console.error("Error sending chat request:",yd),alert("Failed to send chat request")}},R=e=>{switch(e){case"online":return"#2ecc71";case"in-chat":return"#f39c12";default:return"#95a5a6"}},P=e=>{switch(e){case"online":return"Online";case"in-chat":return"In Chat";default:return"Offline"}};return(0,kb.jsxs)("div",{className:"home-container",children:[(0,kb.jsxs)("div",{className:"home-mobile-nav",children:[(0,kb.jsx)("h1",{className:"home-mobile-title",children:"CRABY"}),(0,kb.jsx)("button",{onClick:()=>k(!E),className:"home-mobile-menu-btn",children:"\u2630"})]}),E&&(0,kb.jsxs)("div",{className:"home-mobile-menu",children:[(0,kb.jsx)("button",{onClick:s,className:"home-mobile-menu-item",children:"Friends"}),(0,kb.jsx)("button",{onClick:l,className:"home-mobile-menu-item",children:"Groups"}),(0,kb.jsx)("button",{onClick:o,className:"home-mobile-menu-item",children:"Logout"})]}),(0,kb.jsxs)("div",{className:"home-header",children:[(0,kb.jsxs)("div",{children:[(0,kb.jsx)("h1",{className:"home-title",children:"CRABY"}),(0,kb.jsxs)("p",{className:"home-username",children:["Welcome, ",n.username]})]}),(0,kb.jsxs)("div",{className:"home-header-buttons",children:[(0,kb.jsx)("button",{onClick:s,className:"home-friends-btn",children:"Friends"}),(0,kb.jsx)("button",{onClick:l,className:"home-groups-btn",children:"Groups"}),(0,kb.jsx)("button",{onClick:o,className:"home-logout-btn",children:"Logout"})]})]}),(0,kb.jsxs)("div",{className:"home-content",children:[(0,kb.jsxs)("div",{className:"home-main-section",children:[(0,kb.jsxs)("div",{className:"home-card",children:[(0,kb.jsx)("h2",{className:"home-card-title",children:"Start Random Chat"}),(0,kb.jsx)("p",{className:"home-card-description",children:"Connect with random people around the world"}),(0,kb.jsx)("button",{onClick:i,className:"home-enter-btn",children:"Enter to Chat"})]}),(0,kb.jsx)("div",{className:"home-stats-card",children:(0,kb.jsxs)("div",{className:"home-stat-item",children:[(0,kb.jsx)("div",{className:"home-stat-number",children:u.length}),(0,kb.jsx)("div",{className:"home-stat-label",children:"Users Online"})]})})]}),(0,kb.jsxs)("div",{className:"home-sidebar",children:[(0,kb.jsxs)("div",{className:"home-tabs",children:[(0,kb.jsx)("button",{onClick:()=>S("online"),className:"home-tab ".concat("online"===C?"home-tab-active":""),children:"Online"}),(0,kb.jsx)("button",{onClick:()=>S("friends"),className:"home-tab ".concat("friends"===C?"home-tab-active":""),children:"Friends"}),(0,kb.jsx)("button",{onClick:()=>S("blocked"),className:"home-tab ".concat("blocked"===C?"home-tab-active":""),children:"Blocked"})]}),"online"===C&&(0,kb.jsxs)("div",{className:"home-tab-content",children:[(0,kb.jsx)("h3",{className:"home-sidebar-title",children:"Online Users"}),(0,kb.jsx)("div",{className:"home-user-list",children:0===d.length?(0,kb.jsx)("p",{className:"home-empty-text",children:"No other users online"}):d.map(e=>(0,kb.jsxs)("div",{className:"home-user-item",children:[(0,kb.jsxs)("div",{className:"home-user-info",children:[(0,kb.jsx)("div",{className:"home-status-dot",style:{background:R(e.status)}}),(0,kb.jsx)("span",{className:"home-user-username",children:e.username})]}),(0,kb.jsx)("button",{onClick:()=>N(e.uid,e.username),className:"home-chat-btn",children:"Chat"})]},e.uid))})]}),"friends"===C&&(0,kb.jsxs)("div",{className:"home-tab-content",children:[(0,kb.jsx)("h3",{className:"home-sidebar-title",children:"Friends"}),(0,kb.jsx)("div",{className:"home-user-list",children:0===v.length?(0,kb.jsx)("p",{className:"home-empty-text",children:"No friends yet"}):v.map(e=>(0,kb.jsxs)("div",{className:"home-user-item",children:[(0,kb.jsxs)("div",{className:"home-user-info",children:[(0,kb.jsx)("div",{className:"home-status-dot",style:{background:R(w[e.id])}}),(0,kb.jsxs)("div",{children:[(0,kb.jsx)("div",{className:"home-user-username",children:e.username}),(0,kb.jsx)("div",{className:"home-status-text-small",children:P(w[e.id])})]})]}),(0,kb.jsx)("button",{onClick:()=>(async e=>{try{await mb(t.uid,n.username,e.id,e.username),alert("Chat request sent to ".concat(e.username,"! They will be notified."))}catch(yd){console.error("Error sending chat request to friend:",yd),alert("Failed to send chat request")}})(e),className:"home-chat-btn",children:"Chat"})]},e.id))})]}),"blocked"===C&&(0,kb.jsxs)("div",{className:"home-tab-content",children:[(0,kb.jsx)("h3",{className:"home-sidebar-title",children:"Blocked Users"}),(0,kb.jsx)("div",{className:"home-user-list",children:0===g.length?(0,kb.jsx)("p",{className:"home-empty-text",children:"No blocked users"}):g.map(e=>(0,kb.jsxs)("div",{className:"home-user-item",children:[(0,kb.jsx)("span",{className:"home-user-username",children:e.username}),(0,kb.jsx)("button",{onClick:()=>T(e.uid),className:"home-unblock-btn",children:"Unblock"})]},e.uid))})]})]})]})]})}function Nb(e){let{user:t,userProfile:n,chatRoomId:i,onChatEnded:s,onEndChatPermanently:o}=e;const[a,l]=(0,r.useState)([]),[u,h]=(0,r.useState)(""),[d,f]=(0,r.useState)(null),[p,m]=(0,r.useState)(""),[g,y]=(0,r.useState)(""),[v,_]=(0,r.useState)(!1),[w,b]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),E=(0,r.useRef)(null),k=(0,r.useRef)(!1);(0,r.useEffect)(()=>((async()=>{const e=await ub(t.uid);if(e){f(e);const n=e.participants.find(e=>e!==t.uid);y(n),m(e.participantNames[n])}})(),fb(t.uid,"in-chat"),()=>{k.current||fb(t.uid,"online")}),[i,t.uid]),(0,r.useEffect)(()=>{if(!i)return;const e=((e,t)=>Kh(Du(rb,"chatRooms",e),e=>{e.exists()?t(c({id:e.id},e.data())):t(null)}))(i,e=>{e&&e.active||k.current||(console.log("[v0] Chat room ended, partner left"),b(!0),setTimeout(()=>{s("partner-left")},2e3))});return()=>e()},[i,s]),(0,r.useEffect)(()=>{if(!i)return;const e=((e,t)=>Kh(Sh(Au(rb,"chatRooms",e,"messages"),xh("timestamp")),e=>{const n=e.docs.map(e=>c({id:e.id},e.data()));t(n)}))(i,e=>{l(e)});return()=>e()},[i]),(0,r.useEffect)(()=>{var e;null===(e=E.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[a]);const T=async()=>{console.log("[v0] User clicked Skip, returning to waiting queue"),await hb(i),await fb(t.uid,"online"),s("skip")},I=async()=>{if(g&&!v)try{await(async(e,t,n,r)=>{await Bh(Du(rb,"friendRequests","".concat(e,"_").concat(n)),{fromUid:e,fromUsername:t,toUid:n,toUsername:r,status:"pending",timestamp:Xh()})})(t.uid,n.username,g,p),_(!0),alert("Friend request sent to ".concat(p,"!"))}catch(yd){console.error("Error sending friend request:",yd),alert("Failed to send friend request")}},x=async()=>{if(!g)return;if(window.confirm("Are you sure you want to block ".concat(p,"?")))try{await(async(e,t,n)=>{const r=Du(rb,"users",e),i=await Vh(r);i.exists()&&(i.data().blockedUsers,await Wh(r,{blockedUsers:Jh({uid:t,username:n,blockedAt:(new Date).toISOString()})}))})(t.uid,g,p),await hb(i),alert("".concat(p," has been blocked")),s()}catch(yd){console.error("Error blocking user:",yd),alert("Failed to block user")}},N=async()=>{console.log("[v0] User clicked End Chat, returning to home permanently"),k.current=!0,o(),await hb(i),await fb(t.uid,"online"),s("end")},R=async()=>{if(!g)return;const e=window.prompt("Why are you reporting ".concat(p,"?\n\nPlease provide a reason:"));if(e&&e.trim())try{await(async(e,t,n,r,i,s)=>{await Gh(Au(rb,"reports"),{reporterUid:e,reporterUsername:t,reportedUid:n,reportedUsername:r,reason:i,chatRoomId:s,timestamp:Xh(),status:"pending"})})(t.uid,n.username,g,p,e.trim(),i),alert("".concat(p," has been reported. Thank you for helping keep our community safe."))}catch(yd){console.error("Error reporting user:",yd),alert("Failed to report user. Please try again.")}},P=e=>{var n;return null===(n=e.mentions)||void 0===n?void 0:n.includes(t.uid)};return(0,kb.jsxs)("div",{className:"chat-container",children:[(0,kb.jsxs)("div",{className:"chat-mobile-nav",children:[(0,kb.jsx)("button",{onClick:()=>S(!C),className:"chat-mobile-menu-btn",children:"\u2630"}),(0,kb.jsxs)("h2",{className:"chat-mobile-title",children:[p,w&&(0,kb.jsx)("span",{className:"chat-left-indicator",children:" (Left)"})]})]}),(0,kb.jsxs)("div",{className:"chat-box",children:[(0,kb.jsxs)("div",{className:"chat-header",children:[(0,kb.jsxs)("div",{children:[(0,kb.jsxs)("h2",{className:"chat-title",children:["Chatting with ",p,w&&(0,kb.jsx)("span",{className:"chat-left-indicator",children:" (Left)"})]}),(0,kb.jsx)("p",{className:"chat-subtitle",children:"Be respectful and have fun!"})]}),(0,kb.jsxs)("div",{className:"chat-header-buttons",children:[(0,kb.jsx)("button",{onClick:I,disabled:v||w,className:"chat-friend-btn",children:v?"Request Sent":"Add Friend"}),(0,kb.jsx)("button",{onClick:R,disabled:w,className:"chat-report-btn",children:"Report"}),(0,kb.jsx)("button",{onClick:x,disabled:w,className:"chat-block-btn",children:"Block"}),(0,kb.jsx)("button",{onClick:T,disabled:w,className:"chat-skip-btn",children:"Skip"}),(0,kb.jsx)("button",{onClick:N,className:"chat-end-btn",children:"End Chat"})]})]}),C&&(0,kb.jsxs)("div",{className:"chat-mobile-menu",children:[(0,kb.jsx)("button",{onClick:I,disabled:v||w,className:"chat-mobile-menu-item",children:v?"Request Sent":"Add Friend"}),(0,kb.jsx)("button",{onClick:R,disabled:w,className:"chat-mobile-menu-item",children:"Report"}),(0,kb.jsx)("button",{onClick:x,disabled:w,className:"chat-mobile-menu-item",children:"Block"}),(0,kb.jsx)("button",{onClick:T,disabled:w,className:"chat-mobile-menu-item",children:"Skip"}),(0,kb.jsx)("button",{onClick:N,className:"chat-mobile-menu-item",children:"End Chat"})]}),w&&(0,kb.jsx)("div",{className:"chat-warning-bar",children:"Your chat partner has left the conversation. Returning to waiting queue..."}),(0,kb.jsxs)("div",{className:"chat-messages",children:[0===a.length?(0,kb.jsx)("div",{className:"chat-empty-state",children:(0,kb.jsx)("p",{children:"No messages yet. Say hi!"})}):a.map(e=>{return(0,kb.jsx)("div",{className:"chat-message-wrapper ".concat(e.senderId===t.uid?"chat-message-right":"chat-message-left"),children:(0,kb.jsxs)("div",{className:"chat-message ".concat(e.senderId===t.uid?"chat-message-sent":"chat-message-received"," ").concat(P(e)?"chat-message-mentioned":""),children:[(0,kb.jsx)("div",{className:"chat-message-sender",children:e.senderName}),(0,kb.jsx)("div",{className:"chat-message-text",dangerouslySetInnerHTML:{__html:(n=e.message,n.replace(/@(\w+)/g,'<span class="mention-highlight">@$1</span>'))}})]})},e.id);var n}),(0,kb.jsx)("div",{ref:E})]}),(0,kb.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!u.trim()||w)return;const r=[{uid:t.uid,username:n.username},{uid:g,username:p}],s=Sb(u,r);await async function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];await Gh(Au(rb,"chatRooms",e,"messages"),{senderId:t,senderName:n,message:r,mentions:i,timestamp:Xh()})}(i,t.uid,n.username,u,s),h("")},className:"chat-input-container",children:[(0,kb.jsx)("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:w?"Chat ended":"Type a message...",className:"chat-input",disabled:w}),(0,kb.jsx)("button",{type:"submit",className:"chat-send-btn",disabled:w,children:"Send"})]})]})]})}function Rb(e){let{user:t,userProfile:n,onChatStarted:i,onCancel:s}=e;const[o,a]=(0,r.useState)("Looking for a chat partner..."),[l,u]=(0,r.useState)(0),[h,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=null,r=!0,s=!1,o=!1;return(async()=>{try{console.log("[v0] Initializing waiting for user:",t.uid);if(await cb(t.uid)){console.log("[v0] User is already in an active chat, redirecting...");const e=await ub(t.uid);if(e&&r)return s=!0,void i(e.id)}const l=await ub(t.uid);if(l&&r)return console.log("[v0] Found existing active chat, connecting..."),s=!0,a("Partner found! Connecting..."),void setTimeout(()=>{r&&i(l.id)},300);await fb(t.uid,"online"),await ob(t.uid,n.username),console.log("[v0] Added to waiting pool"),e=(e=>Kh(Sh(Au(rb,"waitingPool"),xh("timestamp")),t=>{const n=t.docs.map(e=>c({id:e.id},e.data()));e(n)}))(async e=>{if(!r||s)return;console.log("[v0] Waiting pool updated:",e.length,"users"),u(e.length);const l=e.find(e=>e.uid===t.uid);if(!l){console.log("[v0] Current user removed from waiting pool, checking for active chat...");const e=await ub(t.uid);return void(e&&r&&!s&&(console.log("[v0] Found active chat room after removal, connecting..."),s=!0,a("Partner found! Connecting..."),setTimeout(()=>{r&&i(e.id)},500)))}const c=l.blockedUsers||[];if(e.length>=2&&!o){const l=e.find(e=>e.uid!==t.uid&&!c.includes(e.uid)&&!(e.blockedUsers||[]).includes(t.uid));if(l){console.log("[v0] Found potential match:",l.username),o=!0,a("Partner found! Connecting...");try{const[e,c]=await Promise.all([cb(t.uid),cb(l.uid)]);if(e||c)return console.log("[v0] One of the users is already in a chat, aborting match"),o=!1,void a("Looking for a chat partner...");const u=await lb(t.uid,l.uid);if(u)return console.log("[v0] Using existing chat room:",u.id),s=!0,await ab(t.uid),void setTimeout(()=>{r&&i(u.id)},300);if(t.uid<l.uid){console.log("[v0] Creating new chat room (I have smaller UID)");const e=await async function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"random";const s=await lb(e,t);if(s)return console.log("[v0] Using existing chat room:",s.id),s.id;const o=[e,t].sort(),a="".concat(o[0],"_").concat(o[1],"_").concat(Date.now());try{const s=await Gh(Au(rb,"chatRooms"),{participants:[e,t],participantNames:{[e]:n,[t]:r},chatType:i,createdAt:Xh(),active:!0,roomKey:a});return console.log("[v0] Created new chat room:",s.id),s.id}catch(yd){console.error("[v0] Error creating chat room:",yd);const r=await lb(e,t);if(r)return r.id;throw yd}}(t.uid,l.uid,n.username,l.username,"random");console.log("[v0] Chat room created:",e),s=!0,await Promise.all([ab(t.uid),ab(l.uid)]),setTimeout(()=>{r&&i(e)},300)}else console.log("[v0] Waiting for other user to create room (they have smaller UID)")}catch(yd){console.error("[v0] Error during matching:",yd),o=!1,a("Error creating chat. Retrying..."),setTimeout(()=>{r&&a("Looking for a chat partner...")},2e3)}}}})}catch(yd){console.error("[v0] Error in waiting:",yd),a("Error joining waiting pool")}})(),()=>{console.log("[v0] Cleaning up waiting component"),r=!1,e&&e(),s||ab(t.uid).catch(console.error)}},[t.uid,n.username,i]);return(0,kb.jsx)("div",{className:"waiting-container",children:(0,kb.jsxs)("div",{className:"waiting-card",children:[(0,kb.jsx)("div",{className:"waiting-spinner"}),(0,kb.jsx)("h2",{className:"waiting-title",children:o}),(0,kb.jsx)("p",{className:"waiting-subtitle",children:l>1?"".concat(l," users in waiting pool"):"Waiting for other users..."}),(0,kb.jsx)("button",{onClick:async()=>{console.log("[v0] User cancelled waiting"),await ab(t.uid),await fb(t.uid,"online"),s()},className:"waiting-cancel-btn",children:"Cancel"})]})})}function Pb(e){let{user:t,userProfile:n,onBack:i}=e;const[s,o]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[u,h]=(0,r.useState)({}),[d,f]=(0,r.useState)("friends");(0,r.useEffect)(()=>{p(),m()},[t.uid]);const p=async()=>{const e=await db(t.uid);o(e),e.forEach(e=>{pb(e.id,t=>{h(n=>c(c({},n),{},{[e.id]:t}))})})},m=async()=>{const e=await(async e=>{const t=Sh(Au(rb,"friendRequests"),kh("toUid","==",e),kh("status","==","pending"));return(await qh(t)).docs.map(e=>c({id:e.id},e.data()))})(t.uid);l(e)},g=async(e,n)=>{try{await(async(e,t,n)=>{await Wh(Du(rb,"friendRequests",e),{status:"accepted"});const r=Du(rb,"users",t),i=Du(rb,"users",n),s=await Vh(r),o=await Vh(i),a=s.data().friends||[],l=o.data().friends||[];await Wh(r,{friends:[...a,n]}),await Wh(i,{friends:[...l,t]})})(e,n,t.uid),alert("Friend request accepted!"),m(),p()}catch(yd){console.error("Error accepting friend request:",yd),alert("Failed to accept friend request")}},y=async(e,n)=>{if(window.confirm("Are you sure you want to remove ".concat(n," from your friends list?")))try{await(async(e,t)=>{const n=Du(rb,"users",e),r=Du(rb,"users",t),i=await Vh(n),s=await Vh(r);if(i.exists()&&s.exists()){const o=i.data().friends||[],a=s.data().friends||[];await Wh(n,{friends:o.filter(e=>e!==t)}),await Wh(r,{friends:a.filter(t=>t!==e)});const l=Sh(Au(rb,"chatRequests"),kh("fromUid","==",e),kh("toUid","==",t)),c=Sh(Au(rb,"chatRequests"),kh("fromUid","==",t),kh("toUid","==",e)),[u,h]=await Promise.all([qh(l),qh(c)]),d=[];u.forEach(e=>d.push(Hh(e.ref))),h.forEach(e=>d.push(Hh(e.ref))),await Promise.all(d)}})(t.uid,e),alert("".concat(n," has been removed from your friends list")),p()}catch(yd){console.error("Error removing friend:",yd),alert("Failed to remove friend")}},v=e=>{switch(e){case"online":return"#2ecc71";case"in-chat":return"#f39c12";default:return"#95a5a6"}},_=e=>{switch(e){case"online":return"Online";case"in-chat":return"In Chat";default:return"Offline"}};return(0,kb.jsx)("div",{style:Ab.container,children:(0,kb.jsxs)("div",{style:Ab.content,children:[(0,kb.jsxs)("div",{style:Ab.header,children:[(0,kb.jsx)("h1",{style:Ab.title,children:"Friends"}),(0,kb.jsx)("button",{onClick:i,style:Ab.backButton,children:"Back to Home"})]}),(0,kb.jsxs)("div",{style:Ab.tabs,children:[(0,kb.jsxs)("button",{onClick:()=>f("friends"),style:c(c({},Ab.tab),"friends"===d?Ab.activeTab:{}),children:["My Friends (",s.length,")"]}),(0,kb.jsxs)("button",{onClick:()=>f("requests"),style:c(c({},Ab.tab),"requests"===d?Ab.activeTab:{}),children:["Friend Requests (",a.length,")"]})]}),(0,kb.jsxs)("div",{style:Ab.listContainer,children:["friends"===d&&(0,kb.jsx)("div",{style:Ab.list,children:0===s.length?(0,kb.jsx)("div",{style:Ab.emptyState,children:(0,kb.jsx)("p",{children:"No friends yet. Start chatting and add some friends!"})}):s.map(e=>(0,kb.jsxs)("div",{style:Ab.friendItem,children:[(0,kb.jsxs)("div",{style:Ab.friendInfo,children:[(0,kb.jsx)("div",{style:c(c({},Ab.statusDot),{},{background:v(u[e.id])})}),(0,kb.jsxs)("div",{children:[(0,kb.jsx)("div",{style:Ab.friendName,children:e.username}),(0,kb.jsx)("div",{style:Ab.friendStatus,children:_(u[e.id])})]})]}),(0,kb.jsx)("button",{onClick:()=>y(e.id,e.username),style:Ab.removeButton,children:"Remove"})]},e.id))}),"requests"===d&&(0,kb.jsx)("div",{style:Ab.list,children:0===a.length?(0,kb.jsx)("div",{style:Ab.emptyState,children:(0,kb.jsx)("p",{children:"No pending friend requests"})}):a.map(e=>(0,kb.jsxs)("div",{style:Ab.requestItem,children:[(0,kb.jsxs)("div",{style:Ab.requestInfo,children:[(0,kb.jsx)("div",{style:Ab.requestName,children:e.fromUsername}),(0,kb.jsx)("div",{style:Ab.requestText,children:"wants to be your friend"})]}),(0,kb.jsx)("button",{onClick:()=>g(e.id,e.fromUid),style:Ab.acceptButton,children:"Accept"})]},e.id))})]})]})})}const Ab={container:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"40px 20px"},content:{maxWidth:"800px",margin:"0 auto"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"32px"},title:{fontSize:"36px",fontWeight:"bold",color:"white",margin:"0"},backButton:{padding:"12px 24px",background:"white",color:"#667eea",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer"},tabs:{display:"flex",gap:"8px",marginBottom:"24px"},tab:{flex:"1",padding:"16px",background:"rgba(255, 255, 255, 0.2)",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"background 0.3s"},activeTab:{background:"white",color:"#667eea"},listContainer:{background:"white",borderRadius:"12px",padding:"24px",minHeight:"400px",boxShadow:"0 10px 40px rgba(0,0,0,0.1)"},list:{display:"flex",flexDirection:"column",gap:"12px"},emptyState:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",color:"#999",textAlign:"center"},friendItem:{padding:"16px",background:"#f8f9fa",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},friendInfo:{display:"flex",alignItems:"center",gap:"16px"},statusDot:{width:"12px",height:"12px",borderRadius:"50%"},friendName:{fontSize:"18px",fontWeight:"600",color:"#333"},friendStatus:{fontSize:"14px",color:"#666",marginTop:"4px"},requestItem:{padding:"16px",background:"#f8f9fa",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},requestInfo:{flex:"1"},requestName:{fontSize:"18px",fontWeight:"600",color:"#333"},requestText:{fontSize:"14px",color:"#666",marginTop:"4px"},acceptButton:{padding:"10px 24px",background:"#2ecc71",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer"},removeButton:{padding:"10px 24px",background:"#e74c3c",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer"}};function Db(e){let{user:t,userProfile:n,onChatAccepted:i}=e;const[s,o]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=vb(t.uid,e=>{e.length>0?o(e[0]):o(null)});return()=>e()},[t.uid]);return s?(0,kb.jsx)("div",{style:Ob.overlay,children:(0,kb.jsxs)("div",{style:Ob.modal,children:[(0,kb.jsx)("div",{style:Ob.icon,children:"\ud83d\udcac"}),(0,kb.jsx)("h2",{style:Ob.title,children:"Chat Request"}),(0,kb.jsxs)("p",{style:Ob.message,children:[(0,kb.jsx)("strong",{children:s.fromUsername})," wants to chat with you"]}),(0,kb.jsxs)("div",{style:Ob.buttons,children:[(0,kb.jsx)("button",{onClick:async()=>{if(s)try{const e=await gb(s.id,s.fromUid,t.uid,s.fromUsername,n.username);o(null),i(e)}catch(yd){console.error("Error accepting chat request:",yd),alert("Failed to accept chat request")}},style:Ob.acceptButton,children:"Accept"}),(0,kb.jsx)("button",{onClick:async()=>{if(s)try{await(async e=>{await Wh(Du(rb,"chatRequests",e),{status:"rejected"})})(s.id),o(null)}catch(yd){console.error("Error rejecting chat request:",yd)}},style:Ob.rejectButton,children:"Decline"})]})]})}):null}const Ob={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modal:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",textAlign:"center",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},icon:{fontSize:"64px",marginBottom:"20px"},title:{fontSize:"28px",fontWeight:"bold",color:"#333",marginBottom:"16px"},message:{fontSize:"16px",color:"#666",marginBottom:"32px",lineHeight:"1.5"},buttons:{display:"flex",gap:"12px",justifyContent:"center"},acceptButton:{padding:"14px 32px",background:"#2ecc71",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"transform 0.2s"},rejectButton:{padding:"14px 32px",background:"#e74c3c",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"transform 0.2s"}};function Lb(e){let{user:t,onSelectGroup:n,onCreateGroup:i,onJoinGroup:s,onBack:o}=e;const[a,l]=(0,r.useState)([]),[u,h]=(0,r.useState)([]),[d,f]=(0,r.useState)("my-groups");(0,r.useEffect)(()=>{p();const e=_b(e=>{h(e)});return()=>e()},[t.uid]);const p=async()=>{const e=await(async e=>{const t=Sh(Au(rb,"groups"),kh("members","array-contains",e));return(await qh(t)).docs.map(e=>c({id:e.id},e.data()))})(t.uid);l(e)},m=e=>{var n;return null===(n=e.members)||void 0===n?void 0:n.includes(t.uid)},g=e=>{var n;return null===(n=e.joinRequests)||void 0===n?void 0:n.some(e=>e.uid===t.uid)};return(0,kb.jsxs)("div",{className:"group-list-container",children:[(0,kb.jsxs)("div",{className:"group-list-header",children:[(0,kb.jsx)("button",{onClick:()=>{o&&"function"===typeof o&&o()},className:"group-list-back-btn",children:"\u2190 Back"}),(0,kb.jsx)("h2",{className:"group-list-title",children:"Groups"}),(0,kb.jsx)("button",{onClick:i,className:"group-create-btn",children:"+ Create Group"})]}),(0,kb.jsxs)("div",{className:"group-tabs",children:[(0,kb.jsxs)("button",{onClick:()=>f("my-groups"),className:"group-tab ".concat("my-groups"===d?"group-tab-active":""),children:["My Groups (",a.length,")"]}),(0,kb.jsx)("button",{onClick:()=>f("trending"),className:"group-tab ".concat("trending"===d?"group-tab-active":""),children:"Trending"})]}),(0,kb.jsxs)("div",{className:"group-list-content",children:["my-groups"===d&&(0,kb.jsx)("div",{className:"group-list",children:0===a.length?(0,kb.jsxs)("div",{className:"group-empty-state",children:[(0,kb.jsx)("p",{children:"You haven't joined any groups yet"}),(0,kb.jsx)("p",{style:{fontSize:"14px",color:"#999",marginTop:"8px"},children:"Create a group or join trending groups!"})]}):a.map(e=>{var r,i;return(0,kb.jsxs)("div",{className:"group-item",onClick:()=>n(e),children:[(0,kb.jsxs)("div",{className:"group-item-info",children:[(0,kb.jsx)("div",{className:"group-item-name",children:e.name}),e.description&&(0,kb.jsx)("div",{className:"group-item-description",children:e.description}),(0,kb.jsxs)("div",{className:"group-item-meta",children:[(null===(r=e.members)||void 0===r?void 0:r.length)||0," members \u2022 ",(null===(i=e.admins)||void 0===i?void 0:i.includes(t.uid))&&"\u2b50 Admin"]})]}),(0,kb.jsx)("div",{className:"group-item-arrow",children:"\u2192"})]},e.id)})}),"trending"===d&&(0,kb.jsx)("div",{className:"group-list",children:0===u.length?(0,kb.jsx)("div",{className:"group-empty-state",children:(0,kb.jsx)("p",{children:"No trending groups yet"})}):u.map(e=>{var t;return(0,kb.jsxs)("div",{className:"group-item",children:[(0,kb.jsxs)("div",{className:"group-item-info",children:[(0,kb.jsxs)("div",{className:"group-item-name",children:[e.name,!e.isPublic&&(0,kb.jsx)("span",{style:{marginLeft:"8px",fontSize:"12px"},children:"\ud83d\udd12"})]}),e.description&&(0,kb.jsx)("div",{className:"group-item-description",children:e.description}),(0,kb.jsxs)("div",{className:"group-item-meta",children:[(null===(t=e.members)||void 0===t?void 0:t.length)||0," members \u2022 Activity: ",e.activityScore||0]})]}),m(e)?(0,kb.jsx)("button",{onClick:()=>n(e),className:"group-join-btn",children:"Open"}):g(e)?(0,kb.jsx)("button",{disabled:!0,className:"group-pending-btn",children:"Pending"}):(0,kb.jsx)("button",{onClick:()=>s(e),className:"group-join-btn",children:"Join"})]},e.id)})})]})]})}function Mb(e){var t;let{group:n,user:i,onClose:s,onGroupDeleted:o,onSettingsUpdated:a}=e;const[l,u]=(0,r.useState)(n.name),[h,d]=(0,r.useState)(n.description||""),[f,p]=(0,r.useState)(n.isPublic),[m,g]=(0,r.useState)(!1),[y,v]=(0,r.useState)(""),_=n.createdBy===i.uid;return(null===(t=n.admins)||void 0===t?void 0:t.includes(i.uid))?(0,kb.jsx)("div",{style:jb.overlay,onClick:s,children:(0,kb.jsxs)("div",{style:jb.modal,onClick:e=>e.stopPropagation(),children:[(0,kb.jsx)("h2",{style:jb.title,children:"Group Settings"}),(0,kb.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),l.trim()){g(!0),v("");try{await(async(e,t)=>{const n=Du(rb,"groups",e);await Wh(n,c(c({},t),{},{updatedAt:Xh()}))})(n.id,{name:l.trim(),description:h.trim(),isPublic:f}),alert("Group settings updated!"),a(),s()}catch(t){console.error("Error updating group settings:",t),v("Failed to update settings")}finally{g(!1)}}else v("Group name is required")},style:jb.form,children:[(0,kb.jsxs)("div",{style:jb.formGroup,children:[(0,kb.jsx)("label",{style:jb.label,children:"Group Name"}),(0,kb.jsx)("input",{type:"text",value:l,onChange:e=>u(e.target.value),required:!0,style:jb.input})]}),(0,kb.jsxs)("div",{style:jb.formGroup,children:[(0,kb.jsx)("label",{style:jb.label,children:"Description"}),(0,kb.jsx)("textarea",{value:h,onChange:e=>d(e.target.value),rows:3,style:jb.textarea,placeholder:"Optional group description"})]}),(0,kb.jsx)("div",{style:jb.checkboxRow,children:(0,kb.jsxs)("label",{style:jb.checkboxLabel,children:[(0,kb.jsx)("input",{type:"checkbox",checked:f,onChange:e=>p(e.target.checked),style:jb.checkbox}),(0,kb.jsx)("span",{style:jb.checkboxText,children:"Public Group (visible in trending)"})]})}),y&&(0,kb.jsx)("p",{style:jb.error,children:y}),(0,kb.jsxs)("div",{style:jb.buttons,children:[(0,kb.jsx)("button",{type:"submit",disabled:m,style:jb.saveButton,children:m?"Saving...":"Save Changes"}),(0,kb.jsx)("button",{type:"button",onClick:s,style:jb.cancelButton,children:"Cancel"})]})]}),_&&(0,kb.jsxs)("div",{style:jb.dangerZone,children:[(0,kb.jsx)("h3",{style:jb.dangerTitle,children:"Danger Zone"}),(0,kb.jsx)("p",{style:jb.dangerText,children:"Deleting the group will permanently remove all messages, members, and settings."}),(0,kb.jsx)("button",{onClick:async()=>{if(window.confirm('Are you sure you want to delete "'.concat(n.name,'"? This action cannot be undone and will remove all messages and members.'))){g(!0);try{await(async e=>{await Hh(Du(rb,"groups",e))})(n.id),alert("Group deleted successfully"),o()}catch(e){console.error("Error deleting group:",e),alert("Failed to delete group"),g(!1)}}},disabled:m,style:jb.deleteButton,children:"Delete Group"})]})]})}):(0,kb.jsx)("div",{style:jb.overlay,onClick:s,children:(0,kb.jsxs)("div",{style:jb.modal,onClick:e=>e.stopPropagation(),children:[(0,kb.jsx)("h2",{style:jb.title,children:"Group Settings"}),(0,kb.jsx)("p",{style:jb.noPermission,children:"Only admins can modify group settings"}),(0,kb.jsx)("button",{onClick:s,style:jb.closeButton,children:"Close"})]})})}const jb={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modal:{background:"white",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},title:{fontSize:"24px",fontWeight:"bold",color:"#333",marginBottom:"24px",textAlign:"center"},form:{display:"flex",flexDirection:"column",gap:"16px"},formGroup:{display:"flex",flexDirection:"column",gap:"8px"},label:{fontSize:"14px",fontWeight:"600",color:"#333"},input:{padding:"12px 16px",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"16px",outline:"none"},textarea:{padding:"12px 16px",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"16px",outline:"none",fontFamily:"inherit",resize:"vertical"},checkboxRow:{display:"flex",alignItems:"center"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},checkbox:{width:"18px",height:"18px",cursor:"pointer"},checkboxText:{fontSize:"14px",color:"#333"},error:{color:"#e74c3c",fontSize:"14px",margin:"0"},buttons:{display:"flex",gap:"12px",marginTop:"8px"},saveButton:{flex:1,padding:"12px",background:"#667eea",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer"},cancelButton:{flex:1,padding:"12px",background:"#e0e0e0",color:"#333",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer"},closeButton:{width:"100%",padding:"12px",background:"#667eea",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer",marginTop:"16px"},noPermission:{textAlign:"center",color:"#666",fontSize:"16px",margin:"24px 0"},dangerZone:{marginTop:"32px",padding:"20px",border:"2px solid #e74c3c",borderRadius:"8px",background:"#fff5f5"},dangerTitle:{fontSize:"18px",fontWeight:"bold",color:"#e74c3c",marginBottom:"8px"},dangerText:{fontSize:"14px",color:"#666",marginBottom:"16px"},deleteButton:{width:"100%",padding:"12px",background:"#e74c3c",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer"}};function Fb(e){let{group:t,user:n,onClose:i}=e;const[s,o]=(0,r.useState)(""),[a,l]=(0,r.useState)([]),[u,h]=(0,r.useState)(!1),[d,f]=(0,r.useState)([]);(0,r.useEffect)(()=>{p()},[t.id]);const p=async()=>{const e=await Cb(t.id);f(e)},m=async e=>{if(o(e),e.trim()){h(!0);try{const t=d.map(e=>e.id),r=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e.trim())return[];const n=Sh(Au(rb,"users"));return(await qh(n)).docs.map(e=>c({id:e.id},e.data())).filter(n=>{var r,i;const s=(null===(r=n.username)||void 0===r?void 0:r.toLowerCase().includes(e.toLowerCase()))||(null===(i=n.nickname)||void 0===i?void 0:i.toLowerCase().includes(e.toLowerCase())),o=!t.includes(n.uid||n.id);return s&&o}).slice(0,10)}(e,[...t,n.uid]);l(r)}catch(yd){console.error("Error searching users:",yd)}finally{h(!1)}}else l([])},g=async e=>{try{await(async(e,t,n,r,i)=>{await Gh(Au(rb,"groupInvites"),{groupId:e,invitedUserId:t,invitedUsername:n,inviterUid:r,inviterUsername:i,status:"pending",timestamp:Xh()})})(t.id,e.uid||e.id,e.username||e.nickname,n.uid,n.nickname),alert("Invitation sent to ".concat(e.username||e.nickname,"!")),o(""),l([])}catch(yd){console.error("Error inviting user:",yd),alert("Failed to send invitation")}};return(0,kb.jsx)("div",{style:Ub.overlay,onClick:i,children:(0,kb.jsxs)("div",{style:Ub.modal,onClick:e=>e.stopPropagation(),children:[(0,kb.jsx)("h2",{style:Ub.title,children:"Invite Members"}),(0,kb.jsxs)("p",{style:Ub.subtitle,children:["Search for users to invite to ",t.name]}),(0,kb.jsx)("div",{style:Ub.searchContainer,children:(0,kb.jsx)("input",{type:"text",value:s,onChange:e=>m(e.target.value),placeholder:"Search by username...",style:Ub.searchInput,autoFocus:!0})}),(0,kb.jsxs)("div",{style:Ub.resultsContainer,children:[u&&(0,kb.jsx)("p",{style:Ub.loadingText,children:"Searching..."}),!u&&s&&0===a.length&&(0,kb.jsx)("p",{style:Ub.noResults,children:"No users found"}),a.map(e=>(0,kb.jsxs)("div",{style:Ub.resultItem,children:[(0,kb.jsxs)("div",{style:Ub.resultInfo,children:[(0,kb.jsx)("span",{style:Ub.resultUsername,children:e.username||e.nickname}),e.gender&&(0,kb.jsxs)("span",{style:Ub.resultGender,children:["(",e.gender,")"]})]}),(0,kb.jsx)("button",{onClick:()=>g(e),style:Ub.inviteButton,children:"Invite"})]},e.id))]}),(0,kb.jsx)("button",{onClick:i,style:Ub.closeButton,children:"Close"})]})})}const Ub={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modal:{background:"white",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},title:{fontSize:"24px",fontWeight:"bold",color:"#333",marginBottom:"8px",textAlign:"center"},subtitle:{fontSize:"14px",color:"#666",marginBottom:"24px",textAlign:"center"},searchContainer:{marginBottom:"16px"},searchInput:{width:"100%",padding:"12px 16px",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"16px",outline:"none",boxSizing:"border-box"},resultsContainer:{minHeight:"200px",maxHeight:"400px",overflowY:"auto",marginBottom:"16px"},loadingText:{textAlign:"center",color:"#666",fontSize:"14px"},noResults:{textAlign:"center",color:"#999",fontSize:"14px",marginTop:"40px"},resultItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",border:"1px solid #e0e0e0",borderRadius:"8px",marginBottom:"8px"},resultInfo:{display:"flex",alignItems:"center",gap:"8px"},resultUsername:{fontSize:"16px",fontWeight:"600",color:"#333"},resultGender:{fontSize:"14px",color:"#999"},inviteButton:{padding:"8px 16px",background:"#667eea",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer"},closeButton:{width:"100%",padding:"12px",background:"#e0e0e0",color:"#333",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer"}};function Vb(e){let{group:t,user:n,isAdmin:i,isCreator:s,onClose:o,onPromoteAdmin:a,onDemoteAdmin:l,onRemoveMember:u}=e;const[h,d]=(0,r.useState)([]),[f,p]=(0,r.useState)({});(0,r.useEffect)(()=>{m()},[t.id]);const m=async()=>{const e=await Cb(t.id);d(e),e.forEach(e=>{pb(e.id,t=>{p(n=>c(c({},n),{},{[e.id]:t}))})})},g=e=>{switch(e){case"online":return"#4caf50";case"in-chat":return"#2196f3";default:return"#999"}},y=e=>{switch(e){case"online":return"Online";case"in-chat":return"In Chat";default:return"Offline"}};return(0,kb.jsx)("div",{className:"members-modal-overlay",onClick:o,children:(0,kb.jsxs)("div",{className:"members-modal-content",onClick:e=>e.stopPropagation(),children:[(0,kb.jsxs)("div",{className:"members-modal-header",children:[(0,kb.jsx)("h2",{className:"members-modal-title",children:"Group Members"}),(0,kb.jsx)("button",{onClick:o,className:"members-modal-close-btn",children:"\u2715"})]}),(0,kb.jsxs)("div",{className:"members-modal-subtitle",children:[h.length," ",1===h.length?"member":"members"," in ",t.name]}),(0,kb.jsx)("div",{className:"members-modal-list",children:h.map(e=>{var r,s;return(0,kb.jsxs)("div",{className:"member-card",children:[(0,kb.jsxs)("div",{className:"member-card-left",children:[(0,kb.jsxs)("div",{className:"member-avatar",children:[(0,kb.jsx)("div",{className:"member-presence-indicator",style:{backgroundColor:g(f[e.id])}}),(0,kb.jsx)("span",{className:"member-avatar-text",children:(e.username||e.nickname||"?").charAt(0).toUpperCase()})]}),(0,kb.jsxs)("div",{className:"member-info",children:[(0,kb.jsxs)("div",{className:"member-name-row",children:[(0,kb.jsx)("span",{className:"member-username",children:e.username||e.nickname}),t.createdBy===e.id&&(0,kb.jsx)("span",{className:"member-badge member-badge-creator",children:"Creator"}),(null===(r=t.admins)||void 0===r?void 0:r.includes(e.id))&&(0,kb.jsx)("span",{className:"member-badge member-badge-admin",children:"Admin"})]}),(0,kb.jsxs)("div",{className:"member-status",children:[(0,kb.jsx)("span",{className:"member-status-text",children:y(f[e.id])}),e.gender&&(0,kb.jsxs)("span",{className:"member-gender",children:[" \u2022 ",e.gender]})]})]})]}),i&&e.id!==n.uid&&e.id!==t.createdBy&&(0,kb.jsxs)("div",{className:"member-actions",children:[null!==(s=t.admins)&&void 0!==s&&s.includes(e.id)?(0,kb.jsx)("button",{onClick:()=>l(e.id,e.username||e.nickname),className:"member-action-btn member-action-demote",children:"Demote"}):(0,kb.jsx)("button",{onClick:()=>a(e.id,e.username||e.nickname),className:"member-action-btn member-action-promote",children:"Promote"}),(0,kb.jsx)("button",{onClick:()=>u(e.id,e.username||e.nickname),className:"member-action-btn member-action-remove",children:"Remove"})]})]},e.id)})}),(0,kb.jsx)("div",{className:"members-modal-footer",children:(0,kb.jsx)("button",{onClick:o,className:"members-modal-back-btn",children:"\u2190 Back to Chat"})})]})})}function zb(e){var t,n,i,s;let{user:o,groupId:a,onBack:l}=e;const[u,h]=(0,r.useState)(null),[d,f]=(0,r.useState)([]),[p,m]=(0,r.useState)(""),[g,y]=(0,r.useState)([]),[v,_]=(0,r.useState)(!1),[w,b]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),[E,k]=(0,r.useState)(!1),[T,I]=(0,r.useState)(!1),[x,N]=(0,r.useState)(null),[R,P]=(0,r.useState)(""),[A,D]=(0,r.useState)(null),[O,L]=(0,r.useState)(null),[M,j]=(0,r.useState)(!1),[F,U]=(0,r.useState)(""),[V,z]=(0,r.useState)(-1),[q,B]=(0,r.useState)([]),[W,H]=(0,r.useState)(0),G=(0,r.useRef)(null),K=(0,r.useRef)(null),Q=["\ud83d\udc4d","\u2764\ufe0f","\ud83d\ude02","\ud83d\ude2e","\ud83d\ude22","\ud83c\udf89","\ud83d\udd25","\ud83d\udc4f"];(0,r.useEffect)(()=>{const e=((e,t)=>Kh(Du(rb,"groups",e),e=>{e.exists()?t(c({id:e.id},e.data())):t(null)}))(a,e=>{h(e)}),t=((e,t)=>Kh(Sh(Au(rb,"groups",e,"messages"),xh("timestamp")),e=>{const n=e.docs.map(e=>c({id:e.id},e.data()));t(n)}))(a,e=>{f(e)});return Y(),()=>{e(),t()}},[a]),(0,r.useEffect)(()=>{var e;null===(e=G.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[d]),(0,r.useEffect)(()=>{var e;const t=p,n=(null===(e=K.current)||void 0===e?void 0:e.selectionStart)||t.length,r=t.substring(0,n),i=r.lastIndexOf("@");if(-1!==i){const e=r.substring(i+1);if(e.includes(" "))j(!1);else{z(i),U(e),j(!0);const t=g.filter(t=>(t.username||t.nickname||"").toLowerCase().includes(e.toLowerCase()));B(t),H(0)}}else j(!1)},[p,g]);const Y=async()=>{const e=await Cb(a);y(e)},X=e=>{var t;const n=e.username||e.nickname,r=p.substring(0,V),i=p.substring(V+F.length+1);m("".concat(r,"@").concat(n," ").concat(i)),j(!1),null===(t=K.current)||void 0===t||t.focus()},J=async e=>{if(R.trim())try{await(async(e,t,n)=>{const r=Du(rb,"groups",e,"messages",t);await Wh(r,{message:n,edited:!0,editedAt:Xh()})})(a,e,R),N(null),P("")}catch(yd){console.error("Error editing message:",yd),alert("Failed to edit message")}},$=async e=>{if(window.confirm("Delete this message?"))try{await(async(e,t)=>{await Hh(Du(rb,"groups",e,"messages",t))})(a,e)}catch(yd){console.error("Error deleting message:",yd),alert("Failed to delete message")}},Z=async(e,t)=>{try{await(async(e,t,n,r)=>{const i=Du(rb,"groups",e,"messages",t),s=await Vh(i);if(s.exists()){const e=s.data().reactions||{};e[r]||(e[r]=[]),e[r].includes(n)?(e[r]=e[r].filter(e=>e!==n),0===e[r].length&&delete e[r]):e[r].push(n),await Wh(i,{reactions:e})}})(a,e,o.uid,t),D(null)}catch(yd){console.error("Error adding reaction:",yd)}},ee=async e=>{try{await(async(e,t)=>{const n=Du(rb,"groups",e),r=await Vh(n);if(r.exists()){const e=r.data().pinnedMessages||[];if(e.includes(t))await Wh(n,{pinnedMessages:$h(t)});else{if(e.length>=5)return void alert("Maximum 5 pinned messages allowed");await Wh(n,{pinnedMessages:Jh(t)})}}})(a,e)}catch(yd){console.error("Error pinning message:",yd)}},te=async()=>{if(window.confirm("Are you sure you want to leave ".concat(null===u||void 0===u?void 0:u.name,"?")))try{await(async(e,t)=>{const n=Du(rb,"groups",e),r=await Vh(n);if(r.exists()){const i=r.data().admins||[];if(await Wh(n,{members:$h(t),admins:$h(t)}),await bb(e),r.data().createdBy===t){const e=r.data().members.filter(e=>e!==t);e.length>0&&1===i.length&&await Wh(n,{admins:[e[0]]})}}})(a,o.uid),alert("You have left the group"),l()}catch(yd){console.error("Error leaving group:",yd),alert("Failed to leave group")}},ne=async e=>{try{const t=u.joinRequests.find(t=>t.uid===e);await(async(e,t)=>{const n=Du(rb,"groups",e),r=await Vh(n);if(r.exists()){const i=(r.data().joinRequests||[]).find(e=>e.uid===t);i&&(await Wh(n,{members:Jh(t),joinRequests:$h(i)}),await bb(e))}})(a,e,t.username),Y()}catch(yd){console.error("Error approving request:",yd)}},re=async e=>{try{await(async(e,t)=>{const n=Du(rb,"groups",e),r=await Vh(n);if(r.exists()){const e=(r.data().joinRequests||[]).find(e=>e.uid===t);e&&await Wh(n,{joinRequests:$h(e)})}})(a,e)}catch(yd){console.error("Error rejecting request:",yd)}},ie=null===u||void 0===u||null===(t=u.admins)||void 0===t?void 0:t.includes(o.uid),se=(null===u||void 0===u?void 0:u.createdBy)===o.uid,oe=e=>{var t;return null===(t=e.mentions)||void 0===t?void 0:t.includes(o.uid)},ae=e=>{var t;return null===u||void 0===u||null===(t=u.pinnedMessages)||void 0===t?void 0:t.includes(e)};return u?(0,kb.jsxs)("div",{className:"group-chat-container",children:[E&&(0,kb.jsx)(Mb,{group:u,user:o,onClose:()=>k(!1),onGroupDeleted:l,onSettingsUpdated:()=>{}}),T&&(0,kb.jsx)(Fb,{group:u,user:o,onClose:()=>I(!1)}),v&&(0,kb.jsx)(Vb,{group:u,user:o,isAdmin:ie,isCreator:se,onClose:()=>_(!1),onPromoteAdmin:async(e,t)=>{try{await(async(e,t)=>{const n=Du(rb,"groups",e);await Wh(n,{admins:Jh(t)})})(a,e),alert("".concat(t," is now an admin")),Y()}catch(yd){console.error("Error promoting admin:",yd)}},onDemoteAdmin:async(e,t)=>{try{await(async(e,t)=>{const n=Du(rb,"groups",e),r=await Vh(n);r.exists()&&r.data().createdBy!==t&&await Wh(n,{admins:$h(t)})})(a,e),alert("".concat(t," is no longer an admin")),Y()}catch(yd){console.error("Error demoting admin:",yd)}},onRemoveMember:async(e,t)=>{if(window.confirm("Remove ".concat(t," from the group?")))try{await(async(e,t)=>{const n=Du(rb,"groups",e);await Wh(n,{members:$h(t),admins:$h(t)}),await bb(e)})(a,e),Y()}catch(yd){console.error("Error removing member:",yd)}}}),(0,kb.jsxs)("div",{className:"group-chat-mobile-nav",children:[(0,kb.jsx)("button",{onClick:()=>S(!C),className:"group-chat-mobile-menu-btn",children:"\u2630"}),(0,kb.jsx)("h2",{className:"group-chat-mobile-title",children:u.name})]}),(0,kb.jsxs)("div",{className:"group-chat-box",children:[(0,kb.jsxs)("div",{className:"group-chat-header",children:[(0,kb.jsxs)("div",{className:"group-chat-header-info",children:[(0,kb.jsx)("h2",{className:"group-chat-title",children:u.name}),(0,kb.jsxs)("p",{className:"group-chat-subtitle",children:[(null===(n=u.members)||void 0===n?void 0:n.length)||0," members ",u.description&&"\u2022 ".concat(u.description)]})]}),(0,kb.jsxs)("div",{className:"group-chat-header-buttons",children:[ie&&(0,kb.jsxs)(kb.Fragment,{children:[(0,kb.jsx)("button",{onClick:()=>I(!0),className:"group-chat-invite-btn",children:"\ud83d\udc65 Invite"}),(0,kb.jsx)("button",{onClick:()=>k(!0),className:"group-chat-settings-btn",children:"\u2699\ufe0f Settings"})]}),(0,kb.jsx)("button",{onClick:()=>_(!0),className:"group-chat-members-btn",children:"\ud83d\udc64 Members"}),ie&&(null===(i=u.joinRequests)||void 0===i?void 0:i.length)>0&&(0,kb.jsxs)("button",{onClick:()=>b(!w),className:"group-chat-requests-btn",children:["\ud83d\udccb Requests (",u.joinRequests.length,")"]}),(0,kb.jsx)("button",{onClick:te,className:"group-chat-leave-btn",children:"\ud83d\udeaa Leave"}),(0,kb.jsx)("button",{onClick:l,className:"group-chat-back-btn",children:"\u2190 Back"})]})]}),C&&(0,kb.jsxs)("div",{className:"group-chat-mobile-menu",children:[ie&&(0,kb.jsx)("button",{onClick:()=>I(!0),className:"group-chat-mobile-menu-item",children:"Invite Members"}),(0,kb.jsx)("button",{onClick:()=>_(!0),className:"group-chat-mobile-menu-item",children:"Members"}),ie&&(null===(s=u.joinRequests)||void 0===s?void 0:s.length)>0&&(0,kb.jsxs)("button",{onClick:()=>b(!w),className:"group-chat-mobile-menu-item",children:["Requests (",u.joinRequests.length,")"]}),ie&&(0,kb.jsx)("button",{onClick:()=>k(!0),className:"group-chat-mobile-menu-item",children:"Group Settings"}),(0,kb.jsx)("button",{onClick:te,className:"group-chat-mobile-menu-item",children:"Leave Group"}),(0,kb.jsx)("button",{onClick:l,className:"group-chat-mobile-menu-item",children:"Back to Groups"})]}),w&&ie&&(0,kb.jsxs)("div",{className:"group-join-requests-panel",children:[(0,kb.jsx)("h3",{className:"group-panel-title",children:"Join Requests"}),u.joinRequests.map(e=>(0,kb.jsxs)("div",{className:"group-request-item",children:[(0,kb.jsx)("span",{className:"group-request-username",children:e.username}),(0,kb.jsxs)("div",{className:"group-request-buttons",children:[(0,kb.jsx)("button",{onClick:()=>ne(e.uid),className:"group-approve-btn",children:"Approve"}),(0,kb.jsx)("button",{onClick:()=>re(e.uid),className:"group-reject-btn",children:"Reject"})]})]},e.uid))]}),(0,kb.jsxs)("div",{className:"group-chat-messages",children:[0===d.length?(0,kb.jsxs)("div",{className:"group-chat-empty-state",children:[(0,kb.jsx)("p",{children:"No messages yet. Start the conversation!"}),(0,kb.jsx)("p",{style:{fontSize:"14px",color:"#999",marginTop:"8px"},children:"Tip: Use @username to mention someone"})]}):d.map(e=>{const{isReply:t,replyToUser:n,actualMessage:r}=(e=>{const t=e.match(/^\[Reply to @(.+?)\] (.+)$/);return t?{isReply:!0,replyToUser:t[1],actualMessage:t[2]}:{isReply:!1,actualMessage:e}})(e.message);return(0,kb.jsx)("div",{className:"group-chat-message-wrapper ".concat(e.senderId===o.uid?"group-chat-message-right":"group-chat-message-left"),children:(0,kb.jsxs)("div",{className:"group-chat-message ".concat(e.senderId===o.uid?"group-chat-message-sent":"group-chat-message-received"," ").concat(oe(e)?"group-chat-message-mentioned":""," ").concat(ae(e.id)?"group-chat-message-pinned":""),children:[ae(e.id)&&(0,kb.jsx)("div",{className:"group-message-pin-indicator",children:"\ud83d\udccc Pinned Message"}),e.senderId!==o.uid&&(0,kb.jsx)("div",{className:"group-chat-message-sender-highlight",children:e.senderName}),t&&(0,kb.jsxs)("div",{className:"group-message-reply-reference",children:[(0,kb.jsx)("div",{className:"group-message-reply-line"}),(0,kb.jsx)("div",{className:"group-message-reply-content",children:(0,kb.jsxs)("span",{className:"group-message-reply-user",children:["@",n]})})]}),x===e.id?(0,kb.jsxs)("div",{className:"group-message-edit-container",children:[(0,kb.jsx)("input",{type:"text",value:R,onChange:e=>P(e.target.value),className:"group-message-edit-input",autoFocus:!0}),(0,kb.jsxs)("div",{className:"group-message-edit-buttons",children:[(0,kb.jsx)("button",{onClick:()=>J(e.id),className:"group-message-save-btn",children:"\u2713 Save"}),(0,kb.jsx)("button",{onClick:()=>{N(null),P("")},className:"group-message-cancel-btn",children:"\u2715 Cancel"})]})]}):(0,kb.jsxs)(kb.Fragment,{children:[(0,kb.jsx)("div",{className:"group-chat-message-text",dangerouslySetInnerHTML:{__html:(i=t?r:e.message,i.replace(/@(\w+)/g,'<span class="mention-highlight">@$1</span>'))}}),e.edited&&(0,kb.jsx)("span",{className:"group-message-edited",children:"(edited)"})]}),e.reactions&&Object.keys(e.reactions).length>0&&(0,kb.jsx)("div",{className:"group-message-reactions",children:Object.entries(e.reactions).map(t=>{let[n,r]=t;return(0,kb.jsxs)("button",{onClick:()=>Z(e.id,n),className:"group-message-reaction ".concat(r.includes(o.uid)?"group-message-reaction-active":""),title:"".concat(r.length," reaction").concat(r.length>1?"s":""),children:[n," ",r.length]},n)})}),(0,kb.jsxs)("div",{className:"group-message-actions",children:[(0,kb.jsx)("button",{onClick:()=>(e=>{var t;L(e),null===(t=K.current)||void 0===t||t.focus()})(e),className:"group-message-action-btn",title:"Reply to message",children:"\u21a9\ufe0f"}),(0,kb.jsx)("button",{onClick:()=>D(A===e.id?null:e.id),className:"group-message-action-btn",title:"Add reaction",children:"\ud83d\ude0a"}),ie&&(0,kb.jsx)("button",{onClick:()=>ee(e.id),className:"group-message-action-btn",title:ae(e.id)?"Unpin message":"Pin message",children:ae(e.id)?"\ud83d\udccd":"\ud83d\udccc"}),e.senderId===o.uid&&(0,kb.jsxs)(kb.Fragment,{children:[(0,kb.jsx)("button",{onClick:()=>{N(e.id),P(t?r:e.message)},className:"group-message-action-btn",title:"Edit message",children:"\u270f\ufe0f"}),(0,kb.jsx)("button",{onClick:()=>$(e.id),className:"group-message-action-btn group-message-action-btn-danger",title:"Delete message",children:"\ud83d\uddd1\ufe0f"})]}),ie&&e.senderId!==o.uid&&(0,kb.jsx)("button",{onClick:()=>$(e.id),className:"group-message-action-btn group-message-action-btn-danger",title:"Delete message (Admin)",children:"\ud83d\uddd1\ufe0f"})]}),A===e.id&&(0,kb.jsx)("div",{className:"group-reaction-picker",children:Q.map(t=>(0,kb.jsx)("button",{onClick:()=>Z(e.id,t),className:"group-reaction-picker-emoji",title:"React with ".concat(t),children:t},t))})]})},e.id);var i}),(0,kb.jsx)("div",{ref:G})]}),O&&(0,kb.jsxs)("div",{className:"group-chat-reply-preview",children:[(0,kb.jsxs)("div",{className:"group-chat-reply-preview-content",children:[(0,kb.jsx)("span",{className:"group-chat-reply-preview-label",children:"Replying to"}),(0,kb.jsxs)("span",{className:"group-chat-reply-preview-user",children:["@",O.senderName]})]}),(0,kb.jsx)("button",{onClick:()=>L(null),className:"group-chat-reply-preview-close",children:"\u2715"})]}),(0,kb.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!p.trim())return;let t=p;O&&(t="[Reply to @".concat(O.senderName,"] ").concat(p));const n=Sb(t,g);await async function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];await Gh(Au(rb,"groups",e,"messages"),{senderId:t,senderName:n,message:r,mentions:i,timestamp:Xh()}),await bb(e)}(a,o.uid,o.nickname,t,n),m(""),L(null)},className:"group-chat-input-container",children:[(0,kb.jsxs)("div",{className:"group-chat-input-wrapper",children:[(0,kb.jsx)("input",{ref:K,type:"text",value:p,onChange:e=>m(e.target.value),onKeyDown:e=>{M&&q.length>0&&("ArrowDown"===e.key?(e.preventDefault(),H(e=>(e+1)%q.length)):"ArrowUp"===e.key?(e.preventDefault(),H(e=>(e-1+q.length)%q.length)):"Enter"===e.key||"Tab"===e.key?(e.preventDefault(),X(q[W])):"Escape"===e.key&&j(!1))},placeholder:"Type a message... (use @username to mention)",className:"group-chat-input"}),M&&q.length>0&&(0,kb.jsx)("div",{className:"mention-dropdown",children:q.map((e,t)=>{var n;return(0,kb.jsxs)("div",{className:"mention-dropdown-item ".concat(t===W?"mention-dropdown-item-selected":""),onClick:()=>X(e),children:[(0,kb.jsx)("div",{className:"mention-dropdown-avatar",children:(e.username||e.nickname||"?").charAt(0).toUpperCase()}),(0,kb.jsxs)("div",{className:"mention-dropdown-info",children:[(0,kb.jsx)("div",{className:"mention-dropdown-name",children:e.username||e.nickname}),(null===(n=u.admins)||void 0===n?void 0:n.includes(e.id))&&(0,kb.jsx)("span",{className:"mention-dropdown-badge",children:"Admin"})]})]},e.id)})})]}),(0,kb.jsx)("button",{type:"submit",className:"group-chat-send-btn",children:"Send"})]})]})]}):(0,kb.jsx)("div",{className:"group-chat-loading",children:(0,kb.jsx)("p",{children:"Loading group..."})})}function qb(e){let{user:t,onClose:n,onGroupCreated:i,joinGroup:s=null}=e;const[o,a]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,h]=(0,r.useState)(!0),[d,f]=(0,r.useState)(!1),[p,m]=(0,r.useState)(""),g=async()=>{if(s){f(!0),m("");try{await(async(e,t,n)=>{const r=Du(rb,"groups",e);await Wh(r,{joinRequests:Jh({uid:t,username:n,requestedAt:(new Date).toISOString()})})})(s.id,t.uid,t.nickname),alert("Join request sent to ".concat(s.name,"!")),n()}catch(e){console.error("Error requesting to join group:",e),m("Failed to send join request")}finally{f(!1)}}};var y;return s?(0,kb.jsx)("div",{style:Bb.overlay,onClick:n,children:(0,kb.jsxs)("div",{style:Bb.modal,onClick:e=>e.stopPropagation(),children:[(0,kb.jsx)("h2",{style:Bb.title,children:"Join Group"}),(0,kb.jsxs)("div",{style:Bb.groupInfo,children:[(0,kb.jsx)("h3",{style:Bb.groupName,children:s.name}),s.description&&(0,kb.jsx)("p",{style:Bb.groupDescription,children:s.description}),(0,kb.jsxs)("p",{style:Bb.memberCount,children:[(null===(y=s.members)||void 0===y?void 0:y.length)||0," members"]})]}),p&&(0,kb.jsx)("p",{style:Bb.error,children:p}),(0,kb.jsxs)("div",{style:Bb.buttons,children:[(0,kb.jsx)("button",{onClick:g,disabled:d,style:Bb.submitButton,children:d?"Sending...":"Request to Join"}),(0,kb.jsx)("button",{onClick:n,style:Bb.cancelButton,children:"Cancel"})]})]})}):(0,kb.jsx)("div",{style:Bb.overlay,onClick:n,children:(0,kb.jsxs)("div",{style:Bb.modal,onClick:e=>e.stopPropagation(),children:[(0,kb.jsx)("h2",{style:Bb.title,children:"Create New Group"}),(0,kb.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),o.trim()){f(!0),m("");try{const e=await async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(await Gh(Au(rb,"groups"),{name:t,description:n,image:r,isPublic:i,createdBy:e,admins:[e],members:[e],joinRequests:[],createdAt:Xh(),activityScore:0,lastActivity:Xh()})).id}(t.uid,o.trim(),l.trim(),"",u);alert("Group created successfully!"),i(e),n()}catch(r){console.error("Error creating group:",r),m("Failed to create group")}finally{f(!1)}}else m("Group name is required")},style:Bb.form,children:[(0,kb.jsx)("input",{type:"text",placeholder:"Group Name",value:o,onChange:e=>a(e.target.value),required:!0,style:Bb.input}),(0,kb.jsx)("textarea",{placeholder:"Description (optional)",value:l,onChange:e=>c(e.target.value),rows:3,style:Bb.textarea}),(0,kb.jsx)("div",{style:Bb.checkboxRow,children:(0,kb.jsxs)("label",{style:Bb.checkboxLabel,children:[(0,kb.jsx)("input",{type:"checkbox",checked:u,onChange:e=>h(e.target.checked),style:Bb.checkbox}),(0,kb.jsx)("span",{style:Bb.checkboxText,children:"Public Group (anyone can request to join)"})]})}),p&&(0,kb.jsx)("p",{style:Bb.error,children:p}),(0,kb.jsxs)("div",{style:Bb.buttons,children:[(0,kb.jsx)("button",{type:"submit",disabled:d,style:Bb.submitButton,children:d?"Creating...":"Create Group"}),(0,kb.jsx)("button",{type:"button",onClick:n,style:Bb.cancelButton,children:"Cancel"})]})]})]})})}const Bb={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},modal:{background:"white",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},title:{fontSize:"24px",fontWeight:"bold",color:"#333",marginBottom:"24px",textAlign:"center"},form:{display:"flex",flexDirection:"column",gap:"16px"},input:{padding:"12px 16px",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"16px",outline:"none"},textarea:{padding:"12px 16px",border:"2px solid #e0e0e0",borderRadius:"8px",fontSize:"16px",outline:"none",fontFamily:"inherit",resize:"vertical"},checkboxRow:{display:"flex",alignItems:"center"},checkboxLabel:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},checkbox:{width:"18px",height:"18px",cursor:"pointer"},checkboxText:{fontSize:"14px",color:"#333"},groupInfo:{marginBottom:"24px"},groupName:{fontSize:"20px",fontWeight:"bold",color:"#333",marginBottom:"8px"},groupDescription:{fontSize:"14px",color:"#666",marginBottom:"12px"},memberCount:{fontSize:"14px",color:"#667eea",fontWeight:"600"},error:{color:"#e74c3c",fontSize:"14px",margin:"0"},buttons:{display:"flex",gap:"12px",marginTop:"8px"},submitButton:{flex:1,padding:"12px",background:"#667eea",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer"},cancelButton:{flex:1,padding:"12px",background:"#e0e0e0",color:"#333",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:"pointer"}};function Wb(e){let{user:t,onGroupJoined:n}=e;const[i,s]=(0,r.useState)([]),[o,a]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!t)return;const e=((e,t)=>Kh(Sh(Au(rb,"groupInvites"),kh("invitedUserId","==",e),kh("status","==","pending")),async e=>{const n=await Promise.all(e.docs.map(async e=>{const t=e.data(),n=await wb(t.groupId);return c(c({id:e.id},t),{},{group:n})}));t(n)}))(t.uid,e=>{s(e),e.length>0&&a(!0)});return()=>e()},[t]);const l=async e=>{try{await(async e=>{await Wh(Du(rb,"groupInvites",e),{status:"rejected"})})(e.id)}catch(yd){console.error("Error rejecting invite:",yd)}};return 0!==i.length&&o?(0,kb.jsxs)("div",{style:Hb.container,children:[(0,kb.jsxs)("div",{style:Hb.header,children:[(0,kb.jsxs)("h3",{style:Hb.title,children:["Group Invitations (",i.length,")"]}),(0,kb.jsx)("button",{onClick:()=>a(!1),style:Hb.closeButton,children:"\xd7"})]}),(0,kb.jsx)("div",{style:Hb.invitesList,children:i.map(e=>{var r,i;return(0,kb.jsxs)("div",{style:Hb.inviteItem,children:[(0,kb.jsxs)("div",{style:Hb.inviteInfo,children:[(0,kb.jsxs)("p",{style:Hb.inviteText,children:[(0,kb.jsx)("strong",{children:e.inviterUsername})," invited you to join ",(0,kb.jsx)("strong",{children:null===(r=e.group)||void 0===r?void 0:r.name})]}),(null===(i=e.group)||void 0===i?void 0:i.description)&&(0,kb.jsx)("p",{style:Hb.groupDescription,children:e.group.description})]}),(0,kb.jsxs)("div",{style:Hb.inviteButtons,children:[(0,kb.jsx)("button",{onClick:()=>(async e=>{try{var r;await Eb(e.id,e.groupId,t.uid),alert("You've joined ".concat(null===(r=e.group)||void 0===r?void 0:r.name,"!")),n&&n(e.group)}catch(yd){console.error("Error accepting invite:",yd),alert("Failed to accept invitation")}})(e),style:Hb.acceptButton,children:"Accept"}),(0,kb.jsx)("button",{onClick:()=>l(e),style:Hb.rejectButton,children:"Decline"})]})]},e.id)})})]}):null}const Hb={container:{position:"fixed",top:"20px",right:"20px",background:"white",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.2)",padding:"16px",maxWidth:"400px",zIndex:999},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},title:{fontSize:"16px",fontWeight:"bold",color:"#333",margin:0},closeButton:{background:"none",border:"none",fontSize:"24px",color:"#999",cursor:"pointer",padding:"0",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},invitesList:{display:"flex",flexDirection:"column",gap:"12px"},inviteItem:{padding:"12px",background:"#f9f9f9",borderRadius:"8px",border:"1px solid #e0e0e0"},inviteInfo:{marginBottom:"12px"},inviteText:{fontSize:"14px",color:"#333",margin:"0 0 4px 0"},groupDescription:{fontSize:"12px",color:"#666",margin:"4px 0 0 0"},inviteButtons:{display:"flex",gap:"8px"},acceptButton:{flex:1,padding:"8px",background:"#667eea",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer"},rejectButton:{flex:1,padding:"8px",background:"#e0e0e0",color:"#333",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer"}};const Gb={app:{minHeight:"100vh",background:"#f5f5f5"},loading:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"#f5f5f5"}},Kb=function(){const[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(null),[s,o]=(0,r.useState)(!0),[a,l]=(0,r.useState)("home"),[c,u]=(0,r.useState)(null),[h,d]=(0,r.useState)(!1),[f,p]=(0,r.useState)(null),[m,g]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{const e=localStorage.getItem("session"),n=e?JSON.parse(e):null;if(null!==n&&void 0!==n&&n.nickname){const e={uid:n.nickname,nickname:n.nickname};t(e);const r=await sb(e.uid);i(r),fb(e.uid,"online")}o(!1)})()},[]),(0,r.useEffect)(()=>{if(!e)return;const t=((e,t)=>Kh(Sh(Au(rb,"chatRequests"),kh("fromUid","==",e),kh("status","==","accepted")),async n=>{for(const r of n.docs){const n=r.data(),i=Sh(Au(rb,"chatRooms"),kh("participants","array-contains",e),kh("active","==",!0)),s=await qh(i);for(const e of s.docs){const i=e.data();if(i.participants.includes(n.toUid)&&"direct"===i.chatType){await Hh(Du(rb,"chatRequests",r.id)),t(e.id);break}}}}))(e.uid,e=>{console.log("[v0] Chat request accepted, starting chat for requester:",e),b(e)});return()=>t()},[e]),(0,r.useEffect)(()=>{const t=()=>{e&&fb(e.uid,"offline")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[e]);const _=async e=>{localStorage.setItem("session",JSON.stringify({nickname:e}));const n={uid:e,nickname:e};t(n);const r=await sb(n.uid);i(r),fb(n.uid,"online"),o(!1)},w=()=>{l("home"),e&&fb(e.uid,"online")},b=t=>{console.log("[v0] Starting direct chat with room:",t),d(!1),u(t),l("chat"),e&&fb(e.uid,"in-chat")},C=e=>{p(e.id),l("group-chat")};return s?(0,kb.jsx)("div",{style:Gb.loading,children:(0,kb.jsx)("h2",{children:"Loading..."})}):e&&n?(0,kb.jsxs)("div",{style:Gb.app,children:[(0,kb.jsx)(Db,{user:e,userProfile:n,onChatAccepted:e=>{console.log("[v0] Chat request accepted, starting chat:",e),b(e)}}),(0,kb.jsx)(Wb,{user:e,onGroupJoined:e=>C(e)}),m&&(0,kb.jsx)(qb,{user:e,onClose:()=>g(!1),onGroupCreated:e=>{p(e),l("group-chat")},joinGroup:y}),"home"===a&&(0,kb.jsx)(xb,{user:e,userProfile:n,onEnterChat:()=>{d(!1),l("waiting")},onViewFriends:()=>l("friends"),onViewGroups:()=>{l("groups")},onLogout:async()=>{e&&fb(e.uid,"offline"),localStorage.removeItem("session"),t(null),i(null),l("home")},onStartDirectChat:b}),"waiting"===a&&(0,kb.jsx)(Rb,{user:e,userProfile:n,onChatStarted:t=>{console.log("[v0] Chat started with room:",t),d(!1),u(t),l("chat"),e&&fb(e.uid,"in-chat")},onCancel:w}),"chat"===a&&c&&(0,kb.jsx)(Nb,{user:e,userProfile:n,chatRoomId:c,onChatEnded:t=>{console.log("[v0] Chat ended with action:",t),u(null),"skip"!==t&&"partner-left"!==t||h?(console.log("[v0] Returning to home (End Chat)"),d(!1),l("home"),e&&fb(e.uid,"online")):(console.log("[v0] Returning to waiting queue"),l("waiting"),e&&fb(e.uid,"online"))},onEndChatPermanently:()=>{console.log("[v0] User clicked End Chat, setting flag to prevent waiting queue"),d(!0)}}),"friends"===a&&(0,kb.jsx)(Pb,{user:e,userProfile:n,onBack:w}),"groups"===a&&(0,kb.jsx)(Lb,{user:e,onSelectGroup:C,onCreateGroup:()=>{v(null),g(!0)},onJoinGroup:e=>{v(e),g(!0)},onBack:w}),"group-chat"===a&&f&&(0,kb.jsx)(zb,{user:e,groupId:f,onBack:()=>{p(null),l("groups")}})]}):(0,kb.jsx)(Tb,{onAuthSuccess:_})};i.createRoot(document.getElementById("root")).render((0,kb.jsx)(r.StrictMode,{children:(0,kb.jsx)(Kb,{})}))})();
//# sourceMappingURL=main.f9d921be.js.map